{"version":3,"file":"TeacherDashboard-BlJddhO8.js","sources":["../../src/pages/TeacherDashboard.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useAuthenticationStatus, useUserId } from '@nhost/react';\nimport { Navigate } from 'react-router-dom';\nimport { graphqlRequest } from '@/lib/graphql';\nimport { User } from '@/api/entities';\nimport GoogleClassroomConnect from '@/components/integration/GoogleClassroomConnect';\nimport { Badge } from '@/components/ui/badge';\n\nexport default function TeacherDashboard() {\n  const { isAuthenticated } = useAuthenticationStatus();\n  const userId = useUserId();\n  const [currentUser, setCurrentUser] = useState(null);\n\n  // Fetch current user details to pass to integration component\n  // This ensures the \"Connected\" status is accurate on load\n  useEffect(() => {\n    if (isAuthenticated) {\n      User.me().then(setCurrentUser).catch(console.error);\n    }\n  }, [isAuthenticated]);\n\n  const { data, isLoading, error, refetch } = useQuery({\n    queryKey: ['teacher-dashboard', userId],\n    enabled: isAuthenticated && Boolean(userId),\n    queryFn: async () => {\n      // Updated query to include assignments and submission aggregates\n      const query = `query TeacherDashboard($eventsLimit: Int, $assignmentsLimit: Int) {\n        classrooms(order_by: { name: asc }) {\n          id\n          name\n        }\n        events(order_by: { starts_at: asc }, limit: $eventsLimit) {\n          id\n          title\n          starts_at\n          classroom {\n            name\n          }\n        }\n        assignments(\n          order_by: { due_at: asc }, \n          limit: $assignmentsLimit, \n          where: { status: { _eq: \"active\" } }\n        ) {\n          id\n          title\n          due_at\n          classroom {\n            name\n          }\n          submissions_aggregate {\n            aggregate {\n              count\n            }\n          }\n        }\n      }`;\n\n      return graphqlRequest({ query, variables: { eventsLimit: 5, assignmentsLimit: 5 } });\n    }\n  });\n\n  const classrooms = data?.classrooms ?? [];\n  const events = data?.events ?? [];\n  const assignments = data?.assignments ?? [];\n\n  // Callback to refresh dashboard data immediately after a sync occurs\n  const handleConnectionUpdate = () => {\n    User.me().then(setCurrentUser); // Refresh sync timestamps\n    refetch(); // Refresh class/assignment lists\n  };\n\n  if (!isAuthenticated) return <Navigate to=\"/\" replace />;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <header>\n        <h1 className=\"text-3xl font-semibold text-gray-900\">Teacher dashboard</h1>\n        <p className=\"text-gray-600\">Manage classrooms, sync assignments, and stay ahead of upcoming events.</p>\n      </header>\n\n      {/* CRITICAL FEATURE FIX: Google Classroom Integration Section */}\n      <section>\n        <GoogleClassroomConnect \n          user={currentUser} \n          onConnectionUpdate={handleConnectionUpdate} \n        />\n      </section>\n\n      {isLoading && <p className=\"text-gray-600\">Loading dashboard data…</p>}\n      {error && (\n        <p className=\"text-red-600\" role=\"alert\">\n          Unable to load teacher data. {error.message}\n        </p>\n      )}\n\n      {!isLoading && !error && (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {/* Classrooms List */}\n          <div className=\"rounded-xl border border-gray-200 bg-white p-5 shadow-sm\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Your Classrooms</h2>\n            <ul className=\"space-y-2 text-sm\">\n              {classrooms.map((classroom) => (\n                <li key={classroom.id} className=\"rounded-lg bg-slate-50 p-3 flex items-center justify-between\">\n                  <p className=\"font-medium text-gray-900\">{classroom.name}</p>\n                </li>\n              ))}\n              {classrooms.length === 0 && (\n                <li className=\"text-sm text-gray-500\">No classrooms assigned. Sync to import.</li>\n              )}\n            </ul>\n          </div>\n\n          {/* NEW: Active Assignments Display */}\n          <div className=\"rounded-xl border border-gray-200 bg-white p-5 shadow-sm\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Active Assignments</h2>\n            <ul className=\"space-y-2 text-sm\">\n              {assignments.map((assignment) => (\n                <li key={assignment.id} className=\"rounded-lg bg-slate-50 p-3\">\n                  <div className=\"flex justify-between items-start mb-1\">\n                    <p className=\"font-medium text-gray-900 line-clamp-1\">{assignment.title}</p>\n                    <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0\">\n                      {assignment.submissions_aggregate?.aggregate?.count || 0} Subs\n                    </Badge>\n                  </div>\n                  <div className=\"flex justify-between text-xs text-gray-500\">\n                    <span>{assignment.classroom?.name}</span>\n                    <span>Due {new Date(assignment.due_at).toLocaleDateString()}</span>\n                  </div>\n                </li>\n              ))}\n              {assignments.length === 0 && (\n                <li className=\"text-sm text-gray-500\">\n                  No active assignments. Click \"Sync Assignments\" above to update.\n                </li>\n              )}\n            </ul>\n          </div>\n\n          {/* Upcoming Events */}\n          <div className=\"rounded-xl border border-gray-200 bg-white p-5 shadow-sm\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Upcoming Events</h2>\n            <ul className=\"space-y-2 text-sm\">\n              {events.map((event) => (\n                <li key={event.id} className=\"rounded-lg bg-slate-50 p-3\">\n                  <p className=\"font-medium text-gray-900\">{event.title}</p>\n                  <p className=\"text-xs text-gray-600\">\n                    {event.classroom?.name ? `${event.classroom.name} · ` : ''}\n                    {new Date(event.starts_at).toLocaleString(undefined, {\n                      dateStyle: 'short',\n                      timeStyle: 'short',\n                    })}\n                  </p>\n                </li>\n              ))}\n              {events.length === 0 && (\n                <li className=\"text-sm text-gray-500\">No upcoming events found.</li>\n              )}\n            </ul>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["TeacherDashboard","isAuthenticated","useAuthenticationStatus","userId","useUserId","currentUser","setCurrentUser","useState","useEffect","User","data","isLoading","error","refetch","useQuery","graphqlRequest","classrooms","events","assignments","handleConnectionUpdate","jsxs","jsx","GoogleClassroomConnect","classroom","assignment","Badge","_b","_a","_c","event","Navigate"],"mappings":"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"}