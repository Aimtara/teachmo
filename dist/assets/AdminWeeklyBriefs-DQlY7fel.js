import{r as a,j as e,L as k,n as x}from"./index-BPP-_OMN.js";function S(r=new Date){const n=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())),i=n.getUTCDay()||7;return i!==1&&n.setUTCDate(n.getUTCDate()-(i-1)),n.toISOString().slice(0,10)}function D(){const r=a.useMemo(()=>S(new Date),[]),[n,i]=a.useState(r),[h,p]=a.useState(!0),[l,d]=a.useState(!1),[m,c]=a.useState(null),[g,o]=a.useState(""),[t,j]=a.useState([]),[w,f]=a.useState(!1),y=async()=>{var s;f(!0);try{const u=await x.functions.call("weekly-brief-runs-get",{limit:10});if(u.error)throw u.error;j(((s=u.data)==null?void 0:s.runs)||[])}catch{}finally{f(!1)}};a.useEffect(()=>{y()},[]);const N=async()=>{d(!0),o(""),c(null);try{const s=await x.functions.call("generate-weekly-briefs",{weekStart:n,dryRun:h});if(s.error)throw s.error;c(s.data),y()}catch(s){o((s==null?void 0:s.message)||"Failed to run generator")}finally{d(!1)}},b=async()=>{d(!0),o(""),c(null);try{const s=await x.functions.call("insights-weekly",{weekStart:n});if(s.error)throw s.error;c(s.data)}catch(s){o((s==null?void 0:s.message)||"Failed to load insights")}finally{d(!1)}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Weekly Briefs"}),e.jsx(k,{to:"/admin",className:"text-sm text-blue-700 hover:underline",children:"Back to admin"})]}),e.jsx("p",{className:"text-gray-600",children:"Pilot tool: generate weekly briefs on demand (dry-run first), then publish."})]}),t.length>0&&e.jsxs("section",{className:"bg-white rounded shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-medium",children:"Last generation run"}),e.jsx("span",{className:"text-xs text-gray-500",children:w?"Refreshing…":""})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",t[0].status,t[0].dry_run?" (dry run)":""]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Week:"})," ",String(t[0].week_start_date)," →"," ",String(t[0].week_end_date)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Generated:"})," ",t[0].generated_count]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Started:"})," ",new Date(t[0].started_at).toLocaleString()]}),t[0].finished_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Finished:"})," ",new Date(t[0].finished_at).toLocaleString()]}),t[0].error&&e.jsxs("div",{className:"text-red-700",children:[e.jsx("span",{className:"font-medium",children:"Error:"})," ",t[0].error]})]})]}),e.jsxs("section",{className:"bg-white rounded shadow p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("label",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Week start (Mon)"}),e.jsx("input",{type:"date",value:n,onChange:s=>i(s.target.value),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("label",{className:"flex items-center gap-2 mt-6",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>p(s.target.checked)}),e.jsx("span",{className:"text-sm text-gray-700",children:"Dry run (do not write to DB)"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:N,disabled:l,className:"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-60",children:l?"Running…":h?"Run dry run":"Generate & publish"}),e.jsx("button",{onClick:b,disabled:l,className:"bg-gray-900 text-white px-4 py-2 rounded disabled:opacity-60",children:l?"Loading…":"Load weekly insights"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Tip: Start with dry run to verify output, then uncheck dry run to publish. In production, schedule",e.jsx("code",{className:"px-1",children:"generate-weekly-briefs"})," via a cron."]})]}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded p-3 text-sm",children:g}),m&&e.jsxs("section",{className:"bg-white rounded shadow p-4",children:[e.jsx("h2",{className:"font-medium mb-3",children:"Result"}),e.jsx("pre",{className:"text-xs bg-gray-50 border rounded p-3 overflow-auto",children:JSON.stringify(m,null,2)})]})]})}export{D as default};
//# sourceMappingURL=AdminWeeklyBriefs-DQlY7fel.js.map
