import{c as N,r as o,h as U,j as e,B as j,C as f,o as y,ah as I,P as z,i as V,k as $,Q as H,z as S}from"./index-CXW08ga6.js";import{P as _,b as O}from"./entities-CLCXHT4z.js";import"./messaging-cshogndc.js";import{I as l}from"./input-DQ0nv64R.js";import{L as i}from"./label-C454ix-G.js";import{T as P}from"./textarea-MrBTA2MH.js";import{S as F,a as D,b as T,c as k,d as n}from"./select-CevpuT8Q.js";import{B as E}from"./badge-Dl3t65au.js";import"./checkbox-e0BWYLYy.js";import{D as G,e as Y,a as Q,b as W,c as J}from"./dialog-DNeHJfP_.js";import{L as K}from"./loader-circle-fFoU9KsL.js";import{T as L,a as X}from"./trash-2-B9NohyIN.js";import{E as Z}from"./eye-BSla1LWL.js";import{b as ee}from"./LoadingStates-vF0mXKmr.js";import"./skeleton-Tb_I7mPl.js";import"./alert-KdgI_V-I.js";import"./circle-alert-CzGZOM4y.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],te=N("MousePointer",ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],re=N("Plus",se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ne=N("SquarePen",ie);function le({partner:p,offers:g=[],onUpdate:c}){const[b,m]=o.useState(!1),[u,v]=o.useState(null),[h,x]=o.useState(!1),{toast:d}=U(),[s,r]=o.useState({title:"",description:"",offer_type:"",discount_value:"",original_price:"",discounted_price:"",promo_code:"",redemption_url:"",terms_conditions:"",start_date:"",end_date:"",max_redemptions:"",category:"",min_age:"",max_age:"",image_url:"",tags:[]}),C=()=>{r({title:"",description:"",offer_type:"",discount_value:"",original_price:"",discounted_price:"",promo_code:"",redemption_url:"",terms_conditions:"",start_date:"",end_date:"",max_redemptions:"",category:"",min_age:"",max_age:"",image_url:"",tags:[]}),v(null)},B=a=>{var t,w;r({...a,start_date:a.start_date?new Date(a.start_date).toISOString().slice(0,16):"",end_date:a.end_date?new Date(a.end_date).toISOString().slice(0,16):"",min_age:((t=a.age_range)==null?void 0:t.min_age)||"",max_age:((w=a.age_range)==null?void 0:w.max_age)||"",max_redemptions:a.max_redemptions||"",tags:a.tags||[]}),v(a),m(!0)},q=async a=>{a.preventDefault(),x(!0);try{const t={partner_id:p.id,...s,age_range:s.min_age&&s.max_age?{min_age:parseInt(s.min_age),max_age:parseInt(s.max_age)}:null,max_redemptions:s.max_redemptions?parseInt(s.max_redemptions):null,status:"pending_review"};u?(await _.update(u.id,t),d({title:"Offer Updated",description:"Your offer has been updated and is pending review."})):(await _.create(t),d({title:"Offer Submitted",description:"Your offer has been submitted for review."})),m(!1),C(),c()}catch(t){console.error("Failed to save offer:",t),d({variant:"destructive",title:"Error",description:"Failed to save offer. Please try again."})}finally{x(!1)}},A=async a=>{if(confirm("Are you sure you want to delete this offer?"))try{await _.delete(a),d({title:"Offer Deleted",description:"Offer has been removed."}),c()}catch{d({variant:"destructive",title:"Error",description:"Failed to delete offer."})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Deals & Offers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create special deals and discounts for families"})]}),e.jsxs(G,{open:b,onOpenChange:m,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(j,{disabled:p.status!=="approved",onClick:()=>{C(),m(!0)},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Create Offer"]})}),e.jsxs(Q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsx(J,{children:u?"Edit Offer":"Create New Offer"})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"title",children:"Offer Title *"}),e.jsx(l,{id:"title",value:s.title,onChange:a=>r(t=>({...t,title:a.target.value})),placeholder:"e.g., 20% off Summer Camp Registration",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"description",children:"Description *"}),e.jsx(P,{id:"description",value:s.description,onChange:a=>r(t=>({...t,description:a.target.value})),rows:3,placeholder:"Describe what makes this offer special...",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Offer Type *"}),e.jsxs(F,{value:s.offer_type,onValueChange:a=>r(t=>({...t,offer_type:a})),children:[e.jsx(D,{children:e.jsx(T,{placeholder:"Select offer type"})}),e.jsxs(k,{children:[e.jsx(n,{value:"percentage_discount",children:"Percentage Discount"}),e.jsx(n,{value:"fixed_amount",children:"Fixed Amount Off"}),e.jsx(n,{value:"bogo",children:"Buy One Get One"}),e.jsx(n,{value:"free_trial",children:"Free Trial"}),e.jsx(n,{value:"bundle_deal",children:"Bundle Deal"}),e.jsx(n,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"discount_value",children:"Discount Value *"}),e.jsx(l,{id:"discount_value",value:s.discount_value,onChange:a=>r(t=>({...t,discount_value:a.target.value})),placeholder:"e.g., 20%, $10 off, BOGO",required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"original_price",children:"Original Price"}),e.jsx(l,{id:"original_price",value:s.original_price,onChange:a=>r(t=>({...t,original_price:a.target.value})),placeholder:"e.g., $50"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"discounted_price",children:"Discounted Price"}),e.jsx(l,{id:"discounted_price",value:s.discounted_price,onChange:a=>r(t=>({...t,discounted_price:a.target.value})),placeholder:"e.g., $40"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"promo_code",children:"Promo Code"}),e.jsx(l,{id:"promo_code",value:s.promo_code,onChange:a=>r(t=>({...t,promo_code:a.target.value})),placeholder:"e.g., SAVE20"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Category *"}),e.jsxs(F,{value:s.category,onValueChange:a=>r(t=>({...t,category:a})),children:[e.jsx(D,{children:e.jsx(T,{placeholder:"Select category"})}),e.jsxs(k,{children:[e.jsx(n,{value:"educational",children:"Educational"}),e.jsx(n,{value:"recreational",children:"Recreational"}),e.jsx(n,{value:"health",children:"Health & Wellness"}),e.jsx(n,{value:"arts",children:"Arts & Crafts"}),e.jsx(n,{value:"sports",children:"Sports"}),e.jsx(n,{value:"community",children:"Community"}),e.jsx(n,{value:"products",children:"Products"}),e.jsx(n,{value:"services",children:"Services"}),e.jsx(n,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"start_date",children:"Start Date"}),e.jsx(l,{id:"start_date",type:"datetime-local",value:s.start_date,onChange:a=>r(t=>({...t,start_date:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"end_date",children:"End Date *"}),e.jsx(l,{id:"end_date",type:"datetime-local",value:s.end_date,onChange:a=>r(t=>({...t,end_date:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"min_age",children:"Min Age"}),e.jsx(l,{id:"min_age",type:"number",min:"0",max:"18",value:s.min_age,onChange:a=>r(t=>({...t,min_age:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"max_age",children:"Max Age"}),e.jsx(l,{id:"max_age",type:"number",min:"0",max:"18",value:s.max_age,onChange:a=>r(t=>({...t,max_age:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"max_redemptions",children:"Max Redemptions"}),e.jsx(l,{id:"max_redemptions",type:"number",min:"1",value:s.max_redemptions,onChange:a=>r(t=>({...t,max_redemptions:a.target.value})),placeholder:"Leave blank for unlimited"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"redemption_url",children:"Redemption URL"}),e.jsx(l,{id:"redemption_url",type:"url",value:s.redemption_url,onChange:a=>r(t=>({...t,redemption_url:a.target.value})),placeholder:"https://yoursite.com/offer"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"image_url",children:"Promotional Image URL"}),e.jsx(l,{id:"image_url",type:"url",value:s.image_url,onChange:a=>r(t=>({...t,image_url:a.target.value})),placeholder:"https://..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"terms_conditions",children:"Terms & Conditions"}),e.jsx(P,{id:"terms_conditions",value:s.terms_conditions,onChange:a=>r(t=>({...t,terms_conditions:a.target.value})),rows:3,placeholder:"Enter any terms, restrictions, or conditions..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(j,{type:"submit",disabled:h,children:[h&&e.jsx(K,{className:"w-4 h-4 animate-spin mr-2"}),u?"Update Offer":"Submit Offer"]})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[g.map(a=>e.jsx(f,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.title}),e.jsx(E,{className:a.status==="published"?"bg-green-100 text-green-800":a.status==="approved"?"bg-blue-100 text-blue-800":a.status==="pending_review"?"bg-yellow-100 text-yellow-800":a.status==="rejected"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:a.status.replace("_"," ")}),e.jsxs(E,{variant:"outline",className:"bg-purple-50 text-purple-700",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),a.discount_value]})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:a.description}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:["Category: ",a.category]}),e.jsxs("div",{children:["Expires: ",new Date(a.end_date).toLocaleDateString()]}),a.impressions>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),a.impressions," views"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),a.clicks," clicks • ",a.saves," saves"]})]})]}),a.status==="rejected"&&a.rejection_reason&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",a.rejection_reason]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:()=>B(a),children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>A(a.id),children:e.jsx(X,{className:"w-4 h-4"})})]})]})})},a.id)),g.length===0&&e.jsx(f,{children:e.jsxs(y,{className:"pt-6 text-center",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No offers yet. Create your first deal to get started!"})]})})]})]})}I.number;function R({label:p="Loading…"}){return e.jsx("div",{className:"min-h-[40vh] flex items-center justify-center",children:e.jsx(ee,{message:p})})}R.propTypes={label:I.string};const M=H("partner-offers");function de(){const[p,g]=o.useState(!0),[c,b]=o.useState(null),[m,u]=o.useState([]);o.useEffect(()=>{(async()=>{try{g(!0);const x=await O.auth.me(),d=await O.entities.Partner.filter({}),s=(d||[]).find(r=>r.owner_id?r.owner_id===x.id:r.user_id===x.id)||(d||[])[0];if(b(s||null),s){const r=await _.filter({partner_id:s.id});u(r||[])}}catch(x){M.error("Failed to load offers data",x),S.error("Failed to load offers")}finally{g(!1)}})()},[]);const v=async()=>{if(c)try{const h=await _.filter({partner_id:c.id});u(h||[])}catch(h){M.error("Failed to refresh offers",h),S.error("Failed to refresh offers")}};return p?e.jsx(R,{label:"Loading offers..."}):c?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Manage Your Offers"}),e.jsx("p",{className:"text-gray-600",children:"Create, edit and manage special offers, discounts and promotions for Teachmo families. Use clear descriptions and appropriate terms to attract the right audience."})]}),e.jsx(f,{children:e.jsx(y,{className:"p-6",children:e.jsx(le,{partner:c,offers:m,onUpdate:v})})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-6",children:e.jsxs(f,{className:"max-w-md text-center",children:[e.jsx(V,{children:e.jsx($,{className:"text-xl font-semibold",children:"Become a Teachmo Partner"})}),e.jsxs(y,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"To manage offers and discounts, you'll need to submit a partner application and be approved by an administrator. Please visit the Partner Portal to start your submission."}),e.jsx("a",{href:"/partners",className:"inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Go to Partner Portal"})]})]})})}function Se(){return e.jsx(z,{allowedRoles:["partner","admin","system_admin"],requireAuth:!0,children:e.jsx(de,{})})}export{Se as default};
//# sourceMappingURL=PartnerOffers-i0pWLLMf.js.map
