import{c as A,r as l,j as e,C as E,i as I,k as $,o as B,B as f,a8 as _,a9 as L,aa as F,J as q,ab as R,A as U,w as z,G as T,N as H,f as M}from"./index-BPP-_OMN.js";import{U as C}from"./entities-B5ABfrWT.js";import"./messaging-Dnlm8q3H.js";import{B as D}from"./badge-BdaYTYbY.js";import{A as O,a as P}from"./alert-h_kpxECZ.js";import{B as k}from"./book-open-BvSkT0ax.js";import{C as J}from"./circle-alert-BmD3VFMm.js";import{E as K}from"./external-link-B--24W3a.js";import{U as Q}from"./users-gkI5qxSk.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],y=A("CircleCheckBig",Y),v=q("GoogleClassroomConnect");function V({user:o,onConnectionUpdate:c}){const[p,m]=l.useState(!1),[a,j]=l.useState(!1),[i,n]=l.useState(null),[g,x]=l.useState("disconnected"),[h,u]=l.useState(null),s=l.useRef(null),r=l.useRef(null);l.useEffect(()=>{o!=null&&o.google_classroom_connected&&(x("connected"),u(o.last_integration_sync))},[o]);const N=async()=>{m(!0),n(null);try{const{data:t}=await F({action:"authorize"});if(t.authUrl){const d=window.open(t.authUrl,"google-auth","width=500,height=600,scrollbars=yes,resizable=yes");s.current=setInterval(()=>{d.closed&&(s.current&&clearInterval(s.current),m(!1),b())},1e3),r.current=w=>{w.origin===window.location.origin&&(w.data.type==="google-auth-success"?(s.current&&clearInterval(s.current),d.close(),x("connected"),m(!1),n({type:"success",message:"Connected to Google Classroom successfully!"}),c&&c(),r.current&&window.removeEventListener("message",r.current)):w.data.type==="google-auth-error"&&(s.current&&clearInterval(s.current),d.close(),m(!1),n({type:"error",message:w.data.error||"Failed to connect to Google Classroom"}),r.current&&window.removeEventListener("message",r.current)))},window.addEventListener("message",r.current)}}catch(t){v.error("Connection error:",t),m(!1),n({type:"error",message:"Failed to initiate Google Classroom connection"})}},b=async()=>{try{const t=await C.me();t!=null&&t.google_classroom_connected&&(x("connected"),u(t.last_integration_sync),c&&c())}catch(t){v.error("Error checking connection status:",t)}},S=async(t="courses")=>{j(!0),n(null);try{const{data:d}=await R({action:`sync_${t}`,courseId:t==="assignments"?"all":void 0});d.success?(n({type:"success",message:`Successfully synced ${d.totalSynced||0} ${t}`}),u(new Date().toISOString()),c&&c()):n({type:"error",message:d.error||`Failed to sync ${t}`})}catch(d){v.error("Sync error:",d),n({type:"error",message:`Failed to sync ${t}. Please try again.`})}finally{j(!1)}},G=async()=>{if(window.confirm("Are you sure you want to disconnect Google Classroom? This will stop syncing your classes and assignments."))try{await C.updateMyUserData({google_classroom_connected:!1,google_classroom_token:null,google_classroom_refresh_token:null}),x("disconnected"),u(null),n({type:"success",message:"Disconnected from Google Classroom"}),c&&c()}catch(t){v.error("Disconnect error:",t),n({type:"error",message:"Failed to disconnect from Google Classroom"})}};return l.useEffect(()=>()=>{s.current&&clearInterval(s.current),r.current&&window.removeEventListener("message",r.current)},[]),e.jsxs(E,{className:"border-0 shadow-lg bg-white/90 backdrop-blur-sm",children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx($,{className:"text-lg",children:"Google Classroom"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sync your classes, assignments, and student data"})]})]}),e.jsx(D,{className:g==="connected"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:g==="connected"?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Connected"]}):"Not Connected"})]})}),e.jsxs(B,{className:"space-y-4",children:[i&&e.jsxs(O,{className:i.type==="error"?"border-red-200 bg-red-50":"border-green-200 bg-green-50",children:[i.type==="error"?e.jsx(J,{className:"h-4 w-4 text-red-600"}):e.jsx(y,{className:"h-4 w-4 text-green-600"}),e.jsx(P,{className:i.type==="error"?"text-red-800":"text-green-800",children:i.message})]}),g==="disconnected"?e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Connect Google Classroom"}),e.jsx("p",{className:"text-gray-600 text-sm max-w-md mx-auto",children:"Connect your Google Classroom account to automatically sync your classes, assignments, and communicate with parents through Teachmo."})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-700",children:[e.jsx(y,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Sync classes and coursework"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-700",children:[e.jsx(y,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Connect with student parents"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-700",children:[e.jsx(y,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Automatic assignment updates"})]})]}),e.jsx(f,{onClick:N,disabled:p,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Connect Google Classroom"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Google Classroom Connected"}),h&&e.jsxs("p",{className:"text-sm text-green-700",children:["Last synced: ",new Date(h).toLocaleDateString()," at ",new Date(h).toLocaleTimeString()]})]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:G,children:"Disconnect"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(L.div,{whileHover:{scale:1.02},children:e.jsxs(f,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-center gap-2",onClick:()=>S("courses"),disabled:a,children:[e.jsx(k,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Sync Classes"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Update course list"})]})]})}),e.jsx(L.div,{whileHover:{scale:1.02},children:e.jsxs(f,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-center gap-2",onClick:()=>S("assignments"),disabled:a,children:[e.jsx(_,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Sync Assignments"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Update coursework"})]})]})}),e.jsx(L.div,{whileHover:{scale:1.02},children:e.jsxs(f,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-center gap-2",onClick:()=>S("guardians"),disabled:a,children:[e.jsx(Q,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Link Parents"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Connect guardians"})]})]})})]}),a&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 py-2",children:[e.jsx(_,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Syncing data from Google Classroom..."})]})]})]})]})}function ce(){const{isAuthenticated:o}=U(),c=z(),[p,m]=l.useState(null);l.useEffect(()=>{o&&C.me().then(m).catch(console.error)},[o]);const{data:a,isLoading:j,error:i,refetch:n}=T({queryKey:["teacher-dashboard",c],enabled:o&&!!c,queryFn:async()=>M({query:`query TeacherDashboard($eventsLimit: Int, $assignmentsLimit: Int) {
        classrooms(order_by: { name: asc }) {
          id
          name
        }
        events(order_by: { starts_at: asc }, limit: $eventsLimit) {
          id
          title
          starts_at
          classroom {
            name
          }
        }
        assignments(
          order_by: { due_at: asc }, 
          limit: $assignmentsLimit, 
          where: { status: { _eq: "active" } }
        ) {
          id
          title
          due_at
          classroom {
            name
          }
          submissions_aggregate {
            aggregate {
              count
            }
          }
        }
      }`,variables:{eventsLimit:5,assignmentsLimit:5}})}),g=(a==null?void 0:a.classrooms)??[],x=(a==null?void 0:a.events)??[],h=(a==null?void 0:a.assignments)??[],u=()=>{C.me().then(m),n()};return o?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Teacher dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Manage classrooms, sync assignments, and stay ahead of upcoming events."})]}),e.jsx("section",{children:e.jsx(V,{user:p,onConnectionUpdate:u})}),j&&e.jsx("p",{className:"text-gray-600",children:"Loading dashboard data…"}),i&&e.jsxs("p",{className:"text-red-600",role:"alert",children:["Unable to load teacher data. ",i.message]}),!j&&!i&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Your Classrooms"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[g.map(s=>e.jsx("li",{className:"rounded-lg bg-slate-50 p-3 flex items-center justify-between",children:e.jsx("p",{className:"font-medium text-gray-900",children:s.name})},s.id)),g.length===0&&e.jsx("li",{className:"text-sm text-gray-500",children:"No classrooms assigned. Sync to import."})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Active Assignments"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[h.map(s=>{var r,N,b;return e.jsxs("li",{className:"rounded-lg bg-slate-50 p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900 line-clamp-1",children:s.title}),e.jsxs(D,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[((N=(r=s.submissions_aggregate)==null?void 0:r.aggregate)==null?void 0:N.count)||0," Subs"]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:(b=s.classroom)==null?void 0:b.name}),e.jsxs("span",{children:["Due ",new Date(s.due_at).toLocaleDateString()]})]})]},s.id)}),h.length===0&&e.jsx("li",{className:"text-sm text-gray-500",children:'No active assignments. Click "Sync Assignments" above to update.'})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Upcoming Events"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[x.map(s=>{var r;return e.jsxs("li",{className:"rounded-lg bg-slate-50 p-3",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-600",children:[(r=s.classroom)!=null&&r.name?`${s.classroom.name} · `:"",new Date(s.starts_at).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})]})]},s.id)}),x.length===0&&e.jsx("li",{className:"text-sm text-gray-500",children:"No upcoming events found."})]})]})]})]}):e.jsx(H,{to:"/",replace:!0})}export{ce as default};
//# sourceMappingURL=TeacherDashboard-CeklBxKS.js.map
