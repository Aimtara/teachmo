import{b as I,r as h,G as T,j as e,C as f,i as y,k as _,o as b,B as v,n as N,y as q}from"./index-BPP-_OMN.js";import{I as u}from"./input-DXyqFpUo.js";import{T as z,a as R,b as x,c,d as w,e as n}from"./table-C5y0xJGn.js";function U(){const{data:r}=I(),a=(r==null?void 0:r.organizationId)??null,l=(r==null?void 0:r.schoolId)??null,[o,m]=h.useState(null),[j,g]=h.useState("users"),[p,S]=h.useState("csv"),i=T({queryKey:["sis-import-jobs",a,l],enabled:!!a,queryFn:async()=>{const d=await q(`query SisImportJobs($where: sis_import_jobs_bool_exp!) {
        sis_import_jobs(where: $where, order_by: { created_at: desc }, limit: 50) {
          id
          roster_type
          source
          status
          created_at
        }
      }`,{where:l?{school_id:{_eq:l}}:{organization_id:{_eq:a}}});return(d==null?void 0:d.sis_import_jobs)??[]}}),C=async()=>{if(!o||!a)return;const s=await o.text(),{error:t}=await N.functions.call("sis-roster-import",{csvText:s,rosterType:j,source:p,schoolId:l,fileName:o.name,fileSize:o.size});if(t){console.error(t);return}m(null),i.refetch()};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"SIS Roster Import"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload OneRoster-formatted CSV data to synchronize read-only roster records."})]}),e.jsxs(f,{children:[e.jsx(y,{children:e.jsx(_,{children:"Import CSV"})}),e.jsxs(b,{className:"grid gap-4 md:grid-cols-[1fr,1fr,1fr,auto]",children:[e.jsx(u,{value:j,onChange:s=>g(s.target.value),placeholder:"users | classes | enrollments"}),e.jsx(u,{value:p,onChange:s=>S(s.target.value),placeholder:"csv | clever | classlink"}),e.jsx(u,{type:"file",accept:".csv",onChange:s=>{var t;return m(((t=s.target.files)==null?void 0:t[0])??null)}}),e.jsx(v,{onClick:C,disabled:!o||!a,children:"Upload"})]})]}),e.jsxs(f,{children:[e.jsx(y,{children:e.jsx(_,{children:"Recent Imports"})}),e.jsx(b,{children:e.jsxs(z,{children:[e.jsx(R,{children:e.jsxs(x,{children:[e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Source"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Imported"})]})}),e.jsx(w,{children:(i.data??[]).length===0?e.jsx(x,{children:e.jsx(n,{colSpan:4,className:"text-sm text-muted-foreground",children:"No roster records found."})}):(i.data??[]).map(s=>e.jsxs(x,{children:[e.jsx(n,{className:"font-mono text-xs",children:s.roster_type}),e.jsx(n,{children:s.source}),e.jsx(n,{className:"capitalize",children:s.status}),e.jsx(n,{children:s.created_at?new Date(s.created_at).toLocaleString():"â€”"})]},s.id))})]})})]})]})}export{U as default};
//# sourceMappingURL=AdminSISRoster-DeBKMvTA.js.map
