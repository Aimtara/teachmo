import{T as _,u as I,h as C,r as v,j as e,C as w,i as P,k as T,m as S,o as E,B as F,n as m,p as q,s as a,q as L}from"./index-CXW08ga6.js";import{u as R,s as $}from"./zod-CULlEe1G.js";import{I as n}from"./input-DQ0nv64R.js";import{L as i}from"./label-C454ix-G.js";import{T as k}from"./textarea-MrBTA2MH.js";const A=q({firstName:a().min(2,"First name is required"),lastName:a().min(2,"Last name is required"),phone:a().min(7,"Enter a valid phone number").regex(/^[0-9+\-() ]+$/,"Phone number can only include digits and basic symbols"),city:a().min(2,"City is required"),schoolId:a().min(2,"School ID is required"),childrenCount:L.number().int().min(1,"At least one child is required"),notes:a().optional()}),O=`
  mutation CreateParentProfile($input: user_profiles_insert_input!) {
    insert_user_profiles_one(object: $input) {
      user_id
    }
  }
`,W=`
  mutation LinkParentSchool($parentId: uuid!, $schoolId: uuid!) {
    insert_parent_school_links_one(object: { parent_id: $parentId, school_id: $schoolId }) {
      id
    }
  }
`,D=`
  mutation AssignParentRole($userId: uuid!) {
    insert_user_roles_one(object: { user_id: $userId, role: "parent" }) {
      id
      role
    }
  }
`;function G(){const t=_(),j=I(),{toast:l}=C(),N=v.useMemo(()=>{var r,d;return{firstName:((r=t==null?void 0:t.displayName)==null?void 0:r.split(" ")[0])||"",lastName:((d=t==null?void 0:t.displayName)==null?void 0:d.split(" ").slice(1).join(" "))||"",phone:"",city:"",schoolId:"",childrenCount:1,notes:""}},[t]),{register:o,handleSubmit:f,formState:{errors:s,isSubmitting:h}}=R({resolver:$(A),defaultValues:N}),y=async r=>{var g;if(!(t!=null&&t.id)){l({variant:"destructive",title:"You need to be signed in to continue",description:"Please log in again and restart onboarding."});return}const d={user_id:t.id,first_name:r.firstName,last_name:r.lastName,phone:r.phone,city:r.city,role:"parent",notes:r.notes,children_count:r.childrenCount,school_id:r.schoolId},{error:u,data:c}=await m.graphql.request(O,{input:d});if(u||!((g=c==null?void 0:c.insert_user_profiles_one)!=null&&g.user_id)){console.error("Failed to create parent profile",u),l({variant:"destructive",title:"Could not save your profile",description:"Please check your details and try again."});return}const b=c.insert_user_profiles_one.user_id,{error:p}=await m.graphql.request(W,{parentId:b,schoolId:r.schoolId});if(p){console.error("Failed to link school",p),l({variant:"destructive",title:"School connection failed",description:"We saved your profile, but could not connect your school. Please try again."});return}const{error:x}=await m.graphql.request(D,{userId:t.id});if(x){console.error("Failed to assign parent role",x),l({variant:"destructive",title:"Role assignment failed",description:"Your profile is saved but we could not finalize your access. Contact support if this continues."});return}l({title:"Welcome to Teachmo!",description:"Your profile is set up and connected to your school."}),j("/dashboard")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-white",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Parent onboarding"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mt-2",children:"Tell us about your family"}),e.jsx("p",{className:"text-slate-600 mt-3 max-w-2xl mx-auto",children:"We use these details to personalize recommendations, connect you with your school, and set up the right parent experience."})]}),e.jsxs(w,{className:"shadow-lg border-slate-200",children:[e.jsxs(P,{children:[e.jsx(T,{children:"Parent details"}),e.jsx(S,{children:"Share a few details so we can tailor Teachmo to your family."})]}),e.jsx(E,{children:e.jsxs("form",{className:"space-y-6",onSubmit:f(y),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"firstName",children:"First name"}),e.jsx(n,{id:"firstName",autoComplete:"given-name",...o("firstName")}),s.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:s.firstName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lastName",children:"Last name"}),e.jsx(n,{id:"lastName",autoComplete:"family-name",...o("lastName")}),s.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:s.lastName.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Mobile number"}),e.jsx(n,{id:"phone",placeholder:"(555) 123-4567",...o("phone")}),s.phone&&e.jsx("p",{className:"text-sm text-red-600",children:s.phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"city",children:"City"}),e.jsx(n,{id:"city",autoComplete:"address-level2",placeholder:"City",...o("city")}),s.city&&e.jsx("p",{className:"text-sm text-red-600",children:s.city.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"schoolId",children:"School ID"}),e.jsx(n,{id:"schoolId",placeholder:"Enter your school's ID",...o("schoolId")}),s.schoolId&&e.jsx("p",{className:"text-sm text-red-600",children:s.schoolId.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"childrenCount",children:"Number of children"}),e.jsx(n,{id:"childrenCount",type:"number",min:1,...o("childrenCount")}),s.childrenCount&&e.jsx("p",{className:"text-sm text-red-600",children:s.childrenCount.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:"What should we know?"}),e.jsx(k,{id:"notes",placeholder:"Tell us about your child's interests, learning goals, or support needs",rows:4,...o("notes")}),s.notes&&e.jsx("p",{className:"text-sm text-red-600",children:s.notes.message})]}),e.jsx(F,{className:"w-full md:w-auto",type:"submit",disabled:h,children:h?"Saving...":"Complete setup"})]})})]})]})})}export{G as default};
//# sourceMappingURL=parent-D9Iv8LO-.js.map
