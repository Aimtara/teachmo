import{A as E,T as F,u as P,a as R,b as q,r,g as O,j as e,t as h,n as A}from"./index-CXW08ga6.js";import{b as U,c as W}from"./onboarding-CMIFl9S6.js";function G(){var y,j;const{isAuthenticated:m,isLoading:c}=E(),t=F(),u=P(),{role:n,loading:g,needsOnboarding:p}=R(),o=q(),i=!!(r.useMemo(()=>n==="system_admin"||n==="admin",[n])&&(!((y=o.data)!=null&&y.organizationId)||!((j=o.data)!=null&&j.schoolId))),[s,B]=r.useState({fullName:"",organizationName:"Demo District",schoolName:"Demo School"}),[N,l]=r.useState(""),[b,f]=r.useState("");if(r.useEffect(()=>{m&&(c||g||o.isLoading||p||u(O(n),{replace:!0}))},[m,c,g,o.isLoading,p,n,u]),c||g||o.isLoading)return e.jsx("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"Loading…"});if(!m)return e.jsx("p",{className:"p-6",children:"Please sign in to start onboarding."});const x=d=>{B({...s,[d.target.name]:d.target.value})},C=async d=>{var v,z,w,I,S,T,k,D,L;d.preventDefault(),l(i?"Setting up your organization…":"Saving your profile…"),f(""),h({eventName:"onboarding.started",entityType:"user",entityId:t==null?void 0:t.id,metadata:i?{role:n,organizationName:s.organizationName,schoolName:s.schoolName}:{role:n}});try{let a=null;i&&(a=await U({organizationName:s.organizationName,schoolName:s.schoolName})),l("Updating your profile…"),await W({userId:t==null?void 0:t.id,fullName:s.fullName,organizationId:((v=a==null?void 0:a.organization)==null?void 0:v.id)??((z=o.data)==null?void 0:z.organizationId)??null,schoolId:((w=a==null?void 0:a.school)==null?void 0:w.id)??((I=o.data)==null?void 0:I.schoolId)??null,allowTenantWrite:!!(i&&((S=a==null?void 0:a.organization)!=null&&S.id))}),await A.auth.refreshSession(),h({eventName:"onboarding.completed",entityType:"user",entityId:t==null?void 0:t.id,metadata:{role:n,organizationId:((T=a==null?void 0:a.organization)==null?void 0:T.id)??((k=o.data)==null?void 0:k.organizationId)??null,schoolId:((D=a==null?void 0:a.school)==null?void 0:D.id)??((L=o.data)==null?void 0:L.schoolId)??null}}),l("Onboarding complete! Redirecting…"),u(O(n),{replace:!0})}catch(a){console.error(a),f(a.message),l(""),h({eventName:"onboarding.failed",entityType:"user",entityId:t==null?void 0:t.id,metadata:{message:(a==null?void 0:a.message)||"unknown"}})}};return e.jsxs("div",{className:"max-w-2xl mx-auto p-8",children:[e.jsx("h1",{className:"text-3xl font-semibold mb-4",children:"Welcome to Teachmo"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tell us about yourself so we can set up your workspace."}),e.jsxs("form",{onSubmit:C,className:"space-y-4 bg-white shadow rounded p-6",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Full name"}),e.jsx("input",{name:"fullName",value:s.fullName,onChange:x,className:"mt-1 w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"rounded border bg-gray-50 p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-medium",children:"Detected role"}),e.jsx("div",{className:"mt-1",children:n}),!i&&e.jsx("p",{className:"mt-2 text-xs text-gray-600",children:"Your organization and school are assigned by your invitation/tenant configuration."})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Organization"}),e.jsx("input",{name:"organizationName",value:s.organizationName,onChange:x,className:"mt-1 w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"School"}),e.jsx("input",{name:"schoolName",value:s.schoolName,onChange:x,className:"mt-1 w-full border rounded px-3 py-2",required:!0})]})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Complete onboarding"}),N&&e.jsx("p",{className:"text-sm text-green-700",children:N}),b&&e.jsx("p",{className:"text-sm text-red-700",children:b})]})]})}export{G as default};
//# sourceMappingURL=Onboarding-CM_-pwVy.js.map
