{"version":3,"file":"AuthCallback-C6kzu_Wj.js","sources":["../../src/pages/AuthCallback.jsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { useAuthenticationStatus, useUserData } from '@nhost/react';\nimport { Navigate } from 'react-router-dom';\nimport { getDefaultPathForRole, useUserRoleState } from '@/hooks/useUserRole';\nimport { nhost } from '@/lib/nhostClient';\nimport { logAnalyticsEvent } from '@/observability/telemetry';\n\nexport default function AuthCallback() {\n  const { isAuthenticated, isLoading, error } = useAuthenticationStatus();\n  const user = useUserData();\n  const { role, loading: roleLoading, needsOnboarding, tenantScope } = useUserRoleState();\n  const loggedRef = useRef(false);\n\n  useEffect(() => {\n    nhost.auth.refreshSession();\n  }, []);\n\n  useEffect(() => {\n    if (loggedRef.current) return;\n    if (!isAuthenticated || isLoading || roleLoading || !user?.id) return;\n\n    // Best-effort: we may not have tenant claims yet if the user still needs onboarding.\n    loggedRef.current = true;\n    logAnalyticsEvent(\n      {\n        organizationId: tenantScope?.organizationId ?? undefined,\n        schoolId: tenantScope?.schoolId ?? undefined\n      },\n      { eventName: 'auth_login', actorId: user.id, actorRole: role || undefined }\n    ).catch(() => {});\n  }, [isAuthenticated, isLoading, roleLoading, tenantScope?.organizationId, tenantScope?.schoolId, user?.id, role]);\n\n  if (isAuthenticated && !isLoading && !roleLoading) {\n    if (needsOnboarding) return <Navigate to=\"/onboarding\" replace />;\n    return <Navigate to={getDefaultPathForRole(role)} replace />;\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center\">\n      <div className=\"space-y-2 text-center\">\n        <p className=\"text-lg font-semibold text-gray-900\">Completing sign-inâ€¦</p>\n        {isLoading && <p className=\"text-gray-600\">We are finalizing your Nhost session.</p>}\n        {error && <p className=\"text-red-600\">{error.message}</p>}\n      </div>\n    </div>\n  );\n}\n"],"names":["AuthCallback","isAuthenticated","isLoading","error","useAuthenticationStatus","user","useUserData","role","roleLoading","needsOnboarding","tenantScope","useUserRoleState","loggedRef","useRef","useEffect","nhost","logAnalyticsEvent","jsx","Navigate","getDefaultPathForRole","jsxs"],"mappings":"gGAOA,SAAwBA,GAAe,CACrC,KAAM,CAAE,gBAAAC,EAAiB,UAAAC,EAAW,MAAAC,CAAA,EAAUC,EAAA,EACxCC,EAAOC,EAAA,EACP,CAAE,KAAAC,EAAM,QAASC,EAAa,gBAAAC,EAAiB,YAAAC,CAAA,EAAgBC,EAAA,EAC/DC,EAAYC,EAAAA,OAAO,EAAK,EAqB9B,OAnBAC,EAAAA,UAAU,IAAM,CACdC,EAAM,KAAK,eAAA,CACb,EAAG,CAAA,CAAE,EAELD,EAAAA,UAAU,IAAM,CACVF,EAAU,SACV,CAACX,GAAmBC,GAAaM,GAAe,EAACH,GAAA,MAAAA,EAAM,MAG3DO,EAAU,QAAU,GACpBI,EACE,CACE,gBAAgBN,GAAA,YAAAA,EAAa,iBAAkB,OAC/C,UAAUA,GAAA,YAAAA,EAAa,WAAY,MAAA,EAErC,CAAE,UAAW,aAAc,QAASL,EAAK,GAAI,UAAWE,GAAQ,MAAA,CAAU,EAC1E,MAAM,IAAM,CAAC,CAAC,EAClB,EAAG,CAACN,EAAiBC,EAAWM,EAAaE,GAAA,YAAAA,EAAa,eAAgBA,GAAA,YAAAA,EAAa,SAAUL,GAAA,YAAAA,EAAM,GAAIE,CAAI,CAAC,EAE5GN,GAAmB,CAACC,GAAa,CAACM,EAChCC,EAAwBQ,EAAAA,IAACC,GAAS,GAAG,cAAc,QAAO,GAAC,QACvDA,EAAA,CAAS,GAAIC,EAAsBZ,CAAI,EAAG,QAAO,GAAC,QAIzD,MAAA,CAAI,UAAU,gDACb,SAAAa,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACb,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAE,UAAU,sCAAsC,SAAA,sBAAmB,EACrEf,GAAae,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,wCAAqC,EAC/Ed,GAASc,EAAAA,IAAC,IAAA,CAAE,UAAU,eAAgB,WAAM,OAAA,CAAQ,CAAA,CAAA,CACvD,CAAA,CACF,CAEJ"}