import{T as _,u as v,h as I,r as C,j as e,C as T,i as S,k as E,m as w,o as F,B as q,n as m,p as P,s as o}from"./index-CXW08ga6.js";import{u as R,s as $}from"./zod-CULlEe1G.js";import{I as c}from"./input-DQ0nv64R.js";import{L as i}from"./label-C454ix-G.js";import{T as L}from"./textarea-MrBTA2MH.js";const A=P({firstName:o().min(2,"First name is required"),lastName:o().min(2,"Last name is required"),phone:o().min(7,"Enter a valid phone number").regex(/^[0-9+\-() ]+$/,"Phone number can only include digits and basic symbols"),schoolId:o().min(2,"School ID is required"),subjects:o().min(2,"Please tell us what you teach"),grades:o().min(1,"List at least one grade level"),teachingFocus:o().optional()}),O=`
  mutation CreateTeacherProfile($input: user_profiles_insert_input!) {
    insert_user_profiles_one(object: $input) {
      user_id
    }
  }
`,H=`
  mutation AssignTeacherRole($userId: uuid!) {
    insert_user_roles_one(object: { user_id: $userId, role: "teacher" }) {
      id
      role
    }
  }
`,Y=`
  mutation ConnectTeacherSchool($teacherId: uuid!, $schoolId: uuid!) {
    insert_teacher_school_links_one(object: { teacher_id: $teacherId, school_id: $schoolId }) {
      id
    }
  }
`;function G(){const r=_(),j=v(),{toast:l}=I(),b=C.useMemo(()=>{var t,n;return{firstName:((t=r==null?void 0:r.displayName)==null?void 0:t.split(" ")[0])||"",lastName:((n=r==null?void 0:r.displayName)==null?void 0:n.split(" ").slice(1).join(" "))||"",phone:"",schoolId:"",subjects:"",grades:"",bio:""}},[r]),{register:a,handleSubmit:f,formState:{errors:s,isSubmitting:h}}=R({resolver:$(A),defaultValues:b}),N=async t=>{var g;if(!(r!=null&&r.id)){l({variant:"destructive",title:"You need to be signed in to continue",description:"Please log in again and restart onboarding."});return}const n={user_id:r.id,first_name:t.firstName,last_name:t.lastName,phone:t.phone,school_id:t.schoolId,subjects:t.subjects,grades:t.grades,bio:t.bio,role:"teacher"},{error:u,data:d}=await m.graphql.request(O,{input:n});if(u||!((g=d==null?void 0:d.insert_user_profiles_one)!=null&&g.user_id)){console.error("Failed to create teacher profile",u),l({variant:"destructive",title:"Could not save your profile",description:"Please verify the details and try again."});return}const y=d.insert_user_profiles_one.user_id,{error:p}=await m.graphql.request(Y,{teacherId:y,schoolId:t.schoolId});if(p){console.error("Failed to connect teacher to school",p),l({variant:"destructive",title:"School connection failed",description:"Your profile is saved but we could not connect to your school. Please try again."});return}const{error:x}=await m.graphql.request(H,{userId:r.id});if(x){console.error("Failed to assign teacher role",x),l({variant:"destructive",title:"Role assignment failed",description:"Your profile is saved but we could not finalize your access. Contact support if this continues."});return}l({title:"Welcome to Teachmo!",description:"Your classroom profile is ready. We connected you to your school and saved your teaching details."}),j("/teacher/dashboard")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-indigo-50 to-white",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-indigo-600",children:"Teacher onboarding"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mt-2",children:"Set up your classroom profile"}),e.jsx("p",{className:"text-slate-600 mt-3 max-w-2xl mx-auto",children:"Add your teaching details so we can personalize resources, connect you with parents, and assign the right role."})]}),e.jsxs(T,{className:"shadow-lg border-slate-200",children:[e.jsxs(S,{children:[e.jsx(E,{children:"Teacher details"}),e.jsx(w,{children:"Share the basics of your classroom so we can get everything ready."})]}),e.jsx(F,{children:e.jsxs("form",{className:"space-y-6",onSubmit:f(N),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"firstName",children:"First name"}),e.jsx(c,{id:"firstName",autoComplete:"given-name",...a("firstName")}),s.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:s.firstName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lastName",children:"Last name"}),e.jsx(c,{id:"lastName",autoComplete:"family-name",...a("lastName")}),s.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:s.lastName.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Mobile number"}),e.jsx(c,{id:"phone",placeholder:"(555) 123-4567",...a("phone")}),s.phone&&e.jsx("p",{className:"text-sm text-red-600",children:s.phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"schoolId",children:"School ID"}),e.jsx(c,{id:"schoolId",placeholder:"Enter your school's ID",...a("schoolId")}),s.schoolId&&e.jsx("p",{className:"text-sm text-red-600",children:s.schoolId.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"subjects",children:"Subjects"}),e.jsx(c,{id:"subjects",placeholder:"e.g., Math, Science",...a("subjects")}),s.subjects&&e.jsx("p",{className:"text-sm text-red-600",children:s.subjects.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"grades",children:"Grade levels"}),e.jsx(c,{id:"grades",placeholder:"e.g., 3rd-5th",...a("grades")}),s.grades&&e.jsx("p",{className:"text-sm text-red-600",children:s.grades.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"bio",children:"Teaching focus"}),e.jsx(L,{id:"bio",placeholder:"Share your teaching philosophy, classroom goals, or experience",rows:4,...a("bio")}),s.bio&&e.jsx("p",{className:"text-sm text-red-600",children:s.bio.message})]}),e.jsx(q,{className:"w-full md:w-auto",type:"submit",disabled:h,children:h?"Saving...":"Complete setup"})]})})]})]})})}export{G as default};
//# sourceMappingURL=teacher-DNhnlv8p.js.map
