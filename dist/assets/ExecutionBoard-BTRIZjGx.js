import{A as M,F as P,r as c,j as e,N as U,L as w,e as W}from"./index-BPP-_OMN.js";function j(i){return i?Array.isArray(i)?i.filter(Boolean):typeof i=="string"?i.split(",").map(x=>x.trim()).filter(Boolean):[]:[]}function q(i){return i?String(i).split(/\r?\n/).map(x=>x.trim()).filter(Boolean).map(x=>{const m=x.startsWith("☑"),h=x.replace(/^☐\s*/,"").replace(/^☑\s*/,"").trim();return{checked:m,text:h}}):[]}function G(){const{isAuthenticated:i}=M(),[x]=P(),[m,h]=c.useState(!0),[l,D]=c.useState(null),[b,v]=c.useState(null),[g,A]=c.useState("All"),[u,I]=c.useState("All"),[y,$]=c.useState("All"),[N,S]=c.useState("");c.useEffect(()=>{if(!i)return;const s=x.get("q");s&&S(s),(async()=>{h(!0);try{const a=await fetch(`${W}/execution-board`);if(!a.ok)throw new Error(`HTTP ${a.status}`);const r=await a.json();D(r),v(null)}catch(a){v(a)}finally{h(!1)}})()},[i,x]);const o=(l==null?void 0:l.epics)||[],R=(l==null?void 0:l.gates)||[],C=(l==null?void 0:l.slices)||[],B=c.useMemo(()=>{const s=new Set(o.map(t=>t.Tag).filter(Boolean));return["All",...Array.from(s).sort()]},[o]),O=c.useMemo(()=>{const s=new Set(o.map(t=>t.Status).filter(Boolean));return["All",...Array.from(s).sort()]},[o]),T=c.useMemo(()=>{const s=new Set(o.map(t=>t["Rail Segment"]).filter(Boolean));return["All",...Array.from(s).sort()]},[o]),k=c.useMemo(()=>{const s=N.trim().toLowerCase();return o.filter(t=>g==="All"?!0:t.Tag===g).filter(t=>u==="All"?!0:t.Status===u).filter(t=>y==="All"?!0:t["Rail Segment"]===y).filter(t=>s?[t["Epic ID"],t.Workstream,t["Owner (Role)"],t.Notes,t["Rail Segment"]].filter(Boolean).join(" ").toLowerCase().includes(s):!0).sort((t,a)=>String(t["Epic ID"]).localeCompare(String(a["Epic ID"])))},[o,g,u,y,N]),E=c.useMemo(()=>{const s=new Map;return o.forEach(t=>{t["Epic ID"]&&s.set(t["Epic ID"],t)}),s},[o]);return i?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Single execution board"}),e.jsxs("p",{className:"text-gray-600",children:["One place to see gates → epics → slices → dependencies. Source:"," ",e.jsx("span",{className:"font-medium",children:(l==null?void 0:l.source)||"executionBoard.json"})]})]}),m&&e.jsx("p",{className:"text-gray-600",children:"Loading board…"}),b&&e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-red-800",role:"alert",children:[e.jsx("p",{className:"font-semibold",children:"Couldn’t load the execution board."}),e.jsx("p",{className:"text-sm opacity-90",children:b.message}),e.jsxs("p",{className:"mt-2 text-sm",children:["Make sure the backend is running and"," ",e.jsx("code",{className:"rounded bg-red-100 px-1 py-0.5",children:"/api/execution-board"})," is reachable."]})]}),!m&&!b&&l&&e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:R.map(s=>{const t=q(s["Exit criteria checklist (tick when done)"]),a=t.filter(d=>d.checked).length,r=t.length?Math.round(a/t.length*100):null;return e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[s.Gate,": ",s.Purpose]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["Owner: ",s["Owner (Role)"]||"—"]})]}),e.jsx("span",{className:"rounded-full border border-gray-200 px-2 py-1 text-xs text-gray-700",children:s.Status||"—"})]}),r!==null&&e.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:["Checklist: ",a,"/",t.length," (",r,"%)"]}),t.length>0&&e.jsxs("ul",{className:"mt-3 space-y-2",children:[t.slice(0,6).map(d=>e.jsxs("li",{className:"flex gap-2 text-xs text-gray-700",children:[e.jsx("span",{"aria-hidden":"true",children:d.checked?"☑":"☐"}),e.jsx("span",{children:d.text})]},d.text)),t.length>6&&e.jsxs("li",{className:"text-xs text-gray-500",children:["+ ",t.length-6," more"]})]})]},s.Gate)})}),e.jsxs("section",{className:"space-y-4 rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end lg:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Epics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Filter by tag (MVP shipping / Pilot hardening / Enterprise scale / R&D), segment, and status."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Tag"}),e.jsx("select",{className:"mt-1 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:g,onChange:s=>A(s.target.value),children:B.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Segment"}),e.jsx("select",{className:"mt-1 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:y,onChange:s=>$(s.target.value),children:T.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Status"}),e.jsx("select",{className:"mt-1 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:u,onChange:s=>I(s.target.value),children:O.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("label",{className:"text-sm text-gray-700 sm:min-w-[240px]",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Search"}),e.jsx("input",{className:"mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:N,onChange:s=>S(s.target.value),placeholder:"Workstream, owner, notes…"})]})]})]}),e.jsxs("div",{className:"overflow-auto",children:[e.jsxs("table",{className:"min-w-full border-separate border-spacing-y-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs font-semibold text-gray-600",children:[e.jsx("th",{className:"px-3 py-2",children:"Epic"}),e.jsx("th",{className:"px-3 py-2",children:"Workstream"}),e.jsx("th",{className:"px-3 py-2",children:"Tag"}),e.jsx("th",{className:"px-3 py-2",children:"Segment"}),e.jsx("th",{className:"px-3 py-2",children:"Status"}),e.jsx("th",{className:"px-3 py-2",children:"Depends on"}),e.jsx("th",{className:"px-3 py-2",children:"Unlocks"}),e.jsx("th",{className:"px-3 py-2",children:"Commands"})]})}),e.jsx("tbody",{children:k.map(s=>{const t=j(s["Upstream Dependencies (IDs)"]),a=j(s["Downstream Dependencies (IDs)"]),r=s["Epic ID"],d=s.Workstream||"",f=(n,p,L)=>{const F=encodeURIComponent(JSON.stringify(L??{},null,2));return`/internal/command-center?type=${encodeURIComponent(n)}&title=${encodeURIComponent(p)}&payload=${F}`};return e.jsxs("tr",{id:`epic-${s["Epic ID"]}`,className:"rounded-lg bg-slate-50 text-sm text-gray-800",children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-3 align-top font-semibold text-gray-900",children:s["Epic ID"]}),e.jsxs("td",{className:"px-3 py-3 align-top",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.Workstream}),s["Next milestone"]&&e.jsx("div",{className:"mt-1 text-xs text-gray-600",children:s["Next milestone"]})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-3 align-top",children:e.jsx("span",{className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-xs",children:s.Tag||"—"})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-3 align-top text-xs text-gray-700",children:s["Rail Segment"]||"—"}),e.jsx("td",{className:"whitespace-nowrap px-3 py-3 align-top",children:e.jsx("span",{className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-xs",children:s.Status||"—"})}),e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.length===0&&e.jsx("span",{className:"text-xs text-gray-500",children:"—"}),t.map(n=>{var p;return e.jsx("a",{href:`#epic-${n}`,className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-xs hover:bg-slate-100",title:((p=E.get(n))==null?void 0:p.Workstream)||n,children:n},n)})]})}),e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.length===0&&e.jsx("span",{className:"text-xs text-gray-500",children:"—"}),a.map(n=>{var p;return e.jsx("a",{href:`#epic-${n}`,className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-xs hover:bg-slate-100",title:((p=E.get(n))==null?void 0:p.Workstream)||n,children:n},n)})]})}),e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(w,{className:"text-xs rounded-lg border border-gray-200 bg-white px-2 py-1 hover:bg-slate-100",to:f("RUNBOOK_CREATE",`${r}: ${d}`,{incident:`Execution Board epic ${r}`,service:d,severity:"warn",upstream:t,downstream:a,anchor:`/internal/execution-board#epic-${r}`}),children:"Runbook"}),e.jsx(w,{className:"text-xs rounded-lg border border-gray-200 bg-white px-2 py-1 hover:bg-slate-100",to:f("ESCALATE",`${r}: Decision / escalation`,{severity:"warn",target:"slack",message:`Need a decision/escalation on ${r} (${d}).`,anchor:`/internal/execution-board#epic-${r}`}),children:"Escalate"}),e.jsx(w,{className:"text-xs rounded-lg border border-gray-200 bg-white px-2 py-1 hover:bg-slate-100",to:f("ROLLBACK",`${r}: Rollback`,{deployment:"",reason:`Rollback request linked to epic ${r} (${d}).`,anchor:`/internal/execution-board#epic-${r}`}),children:"Rollback"})]})})]},s["Epic ID"])})})]}),k.length===0&&e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"No epics match the current filters."})]})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Slices"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Thin end-to-end slices that prove each epic works in reality (and not just in Jira fanfic)."}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:C.map(s=>e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[s["Slice ID"]," · ",s["Primary Epic"]]}),e.jsx("p",{className:"mt-1 text-xs text-gray-600",children:s["Outcome (end-to-end)"]})]}),e.jsx("span",{className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-xs",children:s.Status||"—"})]}),e.jsxs("div",{className:"mt-3 space-y-1 text-xs text-gray-700",children:[s.Deliverables&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Deliverables:"})," ",s.Deliverables]}),s["Acceptance tests"]&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Tests:"})," ",s["Acceptance tests"]]}),j(s["Depends on slice IDs"]).length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Depends on:"})," ",j(s["Depends on slice IDs"]).join(", ")]})]})]},s["Slice ID"]))})]})]})]}):e.jsx(U,{to:"/",replace:!0})}export{G as default};
//# sourceMappingURL=ExecutionBoard-BTRIZjGx.js.map
