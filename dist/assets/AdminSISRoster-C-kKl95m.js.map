{"version":3,"file":"AdminSISRoster-C-kKl95m.js","sources":["../../src/pages/AdminSISRoster.jsx"],"sourcesContent":["import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { nhost } from '@/lib/nhostClient';\nimport { graphql } from '@/lib/graphql';\nimport { useTenantScope } from '@/hooks/useTenantScope';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\n\nexport default function AdminSISRoster() {\n  const { data: scope } = useTenantScope();\n  const organizationId = scope?.organizationId ?? null;\n  const schoolId = scope?.schoolId ?? null;\n  const [file, setFile] = useState(null);\n  const [rosterType, setRosterType] = useState('users');\n  const [source, setSource] = useState('csv');\n\n  const rosterQuery = useQuery({\n    queryKey: ['sis-import-jobs', organizationId, schoolId],\n    enabled: Boolean(organizationId),\n    queryFn: async () => {\n      const query = `query SisImportJobs($where: sis_import_jobs_bool_exp!) {\n        sis_import_jobs(where: $where, order_by: { created_at: desc }, limit: 50) {\n          id\n          roster_type\n          source\n          status\n          created_at\n        }\n      }`;\n\n      const where = schoolId\n        ? { school_id: { _eq: schoolId } }\n        : { organization_id: { _eq: organizationId } };\n\n      const res = await graphql(query, { where });\n      return res?.sis_import_jobs ?? [];\n    },\n  });\n\n  const handleUpload = async () => {\n    if (!file || !organizationId) return;\n    const csvText = await file.text();\n    const { error } = await nhost.functions.call('sis-roster-import', {\n      csvText,\n      rosterType,\n      source,\n      schoolId,\n      fileName: file.name,\n      fileSize: file.size,\n    });\n    if (error) {\n      console.error(error);\n      return;\n    }\n    setFile(null);\n    rosterQuery.refetch();\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-semibold\">SIS Roster Import</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Upload OneRoster-formatted CSV data to synchronize read-only roster records.\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Import CSV</CardTitle>\n        </CardHeader>\n        <CardContent className=\"grid gap-4 md:grid-cols-[1fr,1fr,1fr,auto]\">\n          <Input\n            value={rosterType}\n            onChange={(event) => setRosterType(event.target.value)}\n            placeholder=\"users | classes | enrollments\"\n          />\n          <Input\n            value={source}\n            onChange={(event) => setSource(event.target.value)}\n            placeholder=\"csv | clever | classlink\"\n          />\n          <Input\n            type=\"file\"\n            accept=\".csv\"\n            onChange={(event) => setFile(event.target.files?.[0] ?? null)}\n          />\n          <Button onClick={handleUpload} disabled={!file || !organizationId}>\n            Upload\n          </Button>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Imports</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Type</TableHead>\n                <TableHead>Source</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>Imported</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {(rosterQuery.data ?? []).length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={4} className=\"text-sm text-muted-foreground\">\n                    No roster records found.\n                  </TableCell>\n                </TableRow>\n              ) : (\n                (rosterQuery.data ?? []).map((row) => (\n                  <TableRow key={row.id}>\n                    <TableCell className=\"font-mono text-xs\">{row.roster_type}</TableCell>\n                    <TableCell>{row.source}</TableCell>\n                    <TableCell className=\"capitalize\">{row.status}</TableCell>\n                    <TableCell>{row.created_at ? new Date(row.created_at).toLocaleString() : 'â€”'}</TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":["AdminSISRoster","scope","useTenantScope","organizationId","schoolId","file","setFile","useState","rosterType","setRosterType","source","setSource","rosterQuery","useQuery","res","graphql","handleUpload","csvText","error","nhost","jsxs","jsx","Card","CardHeader","CardTitle","CardContent","Input","event","_a","Button","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","row"],"mappings":"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"}