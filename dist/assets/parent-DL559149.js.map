{"version":3,"file":"parent-DL559149.js","sources":["../../src/pages/onboarding/parent.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { z } from 'zod';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { useUserData } from '@nhost/react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { nhost } from '@/lib/nhostClient';\n\nconst parentOnboardingSchema = z.object({\n  firstName: z.string().min(2, 'First name is required'),\n  lastName: z.string().min(2, 'Last name is required'),\n  phone: z\n    .string()\n    .min(7, 'Enter a valid phone number')\n    .regex(/^[0-9+\\-() ]+$/, 'Phone number can only include digits and basic symbols'),\n  city: z.string().min(2, 'City is required'),\n  schoolId: z.string().min(2, 'School ID is required'),\n  childrenCount: z\n    .coerce.number().int().min(1, 'At least one child is required'),\n  notes: z.string().optional()\n});\n\nconst CREATE_PARENT_PROFILE = `\n  mutation CreateParentProfile($input: user_profiles_insert_input!) {\n    insert_user_profiles_one(object: $input) {\n      user_id\n    }\n  }\n`;\n\nconst LINK_PARENT_SCHOOL = `\n  mutation LinkParentSchool($parentId: uuid!, $schoolId: uuid!) {\n    insert_parent_school_links_one(object: { parent_id: $parentId, school_id: $schoolId }) {\n      id\n    }\n  }\n`;\n\nconst ASSIGN_PARENT_ROLE = `\n  mutation AssignParentRole($userId: uuid!) {\n    insert_user_roles_one(object: { user_id: $userId, role: \"parent\" }) {\n      id\n      role\n    }\n  }\n`;\n\ntype ParentFormValues = z.infer<typeof parentOnboardingSchema>;\n\nexport default function ParentOnboardingPage() {\n  const user = useUserData();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  const defaultValues = useMemo(\n    () => ({\n      firstName: user?.displayName?.split(' ')[0] || '',\n      lastName: user?.displayName?.split(' ').slice(1).join(' ') || '',\n      phone: '',\n      city: '',\n      schoolId: '',\n      childrenCount: 1,\n      notes: ''\n    }),\n    [user]\n  );\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors, isSubmitting }\n  } = useForm<ParentFormValues>({\n    resolver: zodResolver(parentOnboardingSchema),\n    defaultValues\n  });\n\n  const onSubmit = async (values: ParentFormValues) => {\n    if (!user?.id) {\n      toast({\n        variant: 'destructive',\n        title: 'You need to be signed in to continue',\n        description: 'Please log in again and restart onboarding.'\n      });\n      return;\n    }\n\n    const profileInput = {\n      user_id: user.id,\n      first_name: values.firstName,\n      last_name: values.lastName,\n      phone: values.phone,\n      city: values.city,\n      role: 'parent',\n      notes: values.notes,\n      children_count: values.childrenCount,\n      school_id: values.schoolId\n    };\n\n    const { error: profileError, data: profileData } = await nhost.graphql.request(CREATE_PARENT_PROFILE, {\n      input: profileInput\n    });\n\n    if (profileError || !profileData?.insert_user_profiles_one?.user_id) {\n      console.error('Failed to create parent profile', profileError);\n      toast({\n        variant: 'destructive',\n        title: 'Could not save your profile',\n        description: 'Please check your details and try again.'\n      });\n      return;\n    }\n\n    const profileId = profileData.insert_user_profiles_one.user_id;\n\n    const { error: linkError } = await nhost.graphql.request(LINK_PARENT_SCHOOL, {\n      parentId: profileId,\n      schoolId: values.schoolId\n    });\n\n    if (linkError) {\n      console.error('Failed to link school', linkError);\n      toast({\n        variant: 'destructive',\n        title: 'School connection failed',\n        description: 'We saved your profile, but could not connect your school. Please try again.'\n      });\n      return;\n    }\n\n    const { error: roleError } = await nhost.graphql.request(ASSIGN_PARENT_ROLE, {\n      userId: user.id\n    });\n\n    if (roleError) {\n      console.error('Failed to assign parent role', roleError);\n      toast({\n        variant: 'destructive',\n        title: 'Role assignment failed',\n        description: 'Your profile is saved but we could not finalize your access. Contact support if this continues.'\n      });\n      return;\n    }\n\n    toast({\n      title: 'Welcome to Teachmo!',\n      description: 'Your profile is set up and connected to your school.'\n    });\n\n    navigate('/dashboard');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-white\">\n      <div className=\"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8 text-center\">\n          <p className=\"text-sm font-medium text-blue-600\">Parent onboarding</p>\n          <h1 className=\"text-3xl font-bold text-slate-900 mt-2\">Tell us about your family</h1>\n          <p className=\"text-slate-600 mt-3 max-w-2xl mx-auto\">\n            We use these details to personalize recommendations, connect you with your school, and set up the right parent\n            experience.\n          </p>\n        </div>\n\n        <Card className=\"shadow-lg border-slate-200\">\n          <CardHeader>\n            <CardTitle>Parent details</CardTitle>\n            <CardDescription>Share a few details so we can tailor Teachmo to your family.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form className=\"space-y-6\" onSubmit={handleSubmit(onSubmit)}>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"firstName\">First name</Label>\n                  <Input id=\"firstName\" autoComplete=\"given-name\" {...register('firstName')} />\n                  {errors.firstName && <p className=\"text-sm text-red-600\">{errors.firstName.message}</p>}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"lastName\">Last name</Label>\n                  <Input id=\"lastName\" autoComplete=\"family-name\" {...register('lastName')} />\n                  {errors.lastName && <p className=\"text-sm text-red-600\">{errors.lastName.message}</p>}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone\">Mobile number</Label>\n                  <Input id=\"phone\" placeholder=\"(555) 123-4567\" {...register('phone')} />\n                  {errors.phone && <p className=\"text-sm text-red-600\">{errors.phone.message}</p>}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"city\">City</Label>\n                  <Input id=\"city\" autoComplete=\"address-level2\" placeholder=\"City\" {...register('city')} />\n                  {errors.city && <p className=\"text-sm text-red-600\">{errors.city.message}</p>}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"schoolId\">School ID</Label>\n                  <Input id=\"schoolId\" placeholder=\"Enter your school's ID\" {...register('schoolId')} />\n                  {errors.schoolId && <p className=\"text-sm text-red-600\">{errors.schoolId.message}</p>}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"childrenCount\">Number of children</Label>\n                  <Input id=\"childrenCount\" type=\"number\" min={1} {...register('childrenCount')} />\n                  {errors.childrenCount && <p className=\"text-sm text-red-600\">{errors.childrenCount.message}</p>}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"notes\">What should we know?</Label>\n                <Textarea\n                  id=\"notes\"\n                  placeholder=\"Tell us about your child's interests, learning goals, or support needs\"\n                  rows={4}\n                  {...register('notes')}\n                />\n                {errors.notes && <p className=\"text-sm text-red-600\">{errors.notes.message}</p>}\n              </div>\n\n              <Button className=\"w-full md:w-auto\" type=\"submit\" disabled={isSubmitting}>\n                {isSubmitting ? 'Saving...' : 'Complete setup'}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"],"names":["parentOnboardingSchema","z.object","z.string","z.coerce","CREATE_PARENT_PROFILE","LINK_PARENT_SCHOOL","ASSIGN_PARENT_ROLE","ParentOnboardingPage","user","useUserData","navigate","useNavigate","toast","useToast","defaultValues","useMemo","_a","_b","register","handleSubmit","errors","isSubmitting","useForm","zodResolver","onSubmit","values","profileInput","profileError","profileData","nhost","profileId","linkError","roleError","jsxs","jsx","Card","CardHeader","CardTitle","CardDescription","CardContent","Label","Input","Textarea","Button"],"mappings":"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"}