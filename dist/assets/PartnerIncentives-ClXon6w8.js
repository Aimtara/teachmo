import{j as e,P,r as d,w as S,b as A,C as $,i as w,k as B,o as E,B as v,e as h,z as x}from"./index-BPP-_OMN.js";import{B as R}from"./badge-BdaYTYbY.js";import{T as O,a as k,b as y,c as l,d as H,e as c}from"./table-C5y0xJGn.js";function U(){const[u,j]=d.useState([]),[b,p]=d.useState([]),o=S(),{data:s}=A(),n=o,i=d.useMemo(()=>{const t={};return o&&(t["x-user-id"]=o),s!=null&&s.districtId&&(t["x-district-id"]=s.districtId),s!=null&&s.schoolId&&(t["x-school-id"]=s.schoolId),t},[o,s==null?void 0:s.districtId,s==null?void 0:s.schoolId]),m=async()=>{try{const[t,a]=await Promise.all([fetch(`${h}/incentives`,{headers:i}).then(r=>r.json()),n?fetch(`${h}/incentives/applications/${n}`,{headers:i}).then(r=>r.json()):Promise.resolve([])]);j(t||[]),p(a||[])}catch(t){console.error("Failed to load incentives:",t),x.error("Unable to load incentives."),j([]),p([])}};d.useEffect(()=>{m()},[i,n]);const g=async t=>{try{await fetch(`${h}/incentives/${t}/apply`,{method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify({partnerId:n})}),m()}catch(a){console.error("Failed to apply for incentive:",a),x.error("Unable to apply for this incentive.")}},N=async t=>{try{await fetch(`${h}/incentives/${t}/claim`,{method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify({partnerId:n})}),m()}catch(a){console.error("Failed to claim incentive:",a),x.error("Unable to claim this incentive.")}},T=Object.fromEntries(b.map(t=>[t.incentive_id,t])),C=t=>t?t.status==="earned"?{label:"Earned",variant:"default"}:t.status==="approved"?{label:"Approved",variant:"default"}:t.status==="rejected"?{label:"Rejected",variant:"destructive"}:{label:t.status||"Pending",variant:"secondary"}:{label:"Not Applied",variant:"secondary"};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Incentives"}),e.jsx("p",{className:"text-gray-600",children:"Track incentive programs, claim earned rewards, and monitor payout status."})]}),e.jsxs($,{children:[e.jsx(w,{children:e.jsx(B,{className:"text-xl",children:"Available programs"})}),e.jsx(E,{children:u.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No incentive programs available yet."}):e.jsxs(O,{children:[e.jsx(k,{children:e.jsxs(y,{children:[e.jsx(l,{children:"Program"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Value"}),e.jsx(l,{children:"Status"}),e.jsx(l,{className:"text-right",children:"Action"})]})}),e.jsx(H,{children:u.map(t=>{const a=T[t.id],r=C(a),I=t.value?`$${t.value}`:"—",f=(a==null?void 0:a.status)==="earned";return e.jsxs(y,{children:[e.jsx(c,{className:"font-medium",children:t.title}),e.jsx(c,{className:"text-muted-foreground",children:t.description}),e.jsx(c,{children:I}),e.jsx(c,{children:e.jsx(R,{variant:r.variant,children:r.label})}),e.jsxs(c,{className:"text-right",children:[!a&&e.jsx(v,{size:"sm",onClick:()=>g(t.id),children:"Apply"}),f&&e.jsx(v,{size:"sm",onClick:()=>N(t.id),children:"Claim"}),a&&!f&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})]})]},t.id)})})]})})]})]})})}function M(){return e.jsx(P,{allowedRoles:["partner","admin","system_admin"],requireAuth:!0,children:e.jsx(U,{})})}export{M as default};
//# sourceMappingURL=PartnerIncentives-ClXon6w8.js.map
