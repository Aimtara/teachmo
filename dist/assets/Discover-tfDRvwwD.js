import{c as j,j as e,C as d,i as g,k as f,o as m,ao as z,B as x,ap as N,an as i,T as C,G as T,r as B,a8 as k,f as q,aq as A,L as v,ar as O,as as $,at as E,g as D,u as P}from"./index-BPP-_OMN.js";import{B as u}from"./badge-BdaYTYbY.js";import{S as b}from"./sparkles-D1zPXSma.js";import{C as S}from"./chevron-right-n03ogy4e.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],H=j("ArrowLeft",U);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],F=j("ArrowRight",M);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],V=j("BookmarkPlus",G);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],W=j("Compass",Q);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],R=j("Search",Y);function _({recommendation:s}){const{title:a,summary:n,tags:r=[],subject:l,gradeLevel:c,ctaLabel:h="View details",ctaHref:p}=s||{},t=()=>{N("Saved to your list",{description:a||"Recommendation saved"})},o=()=>{p?window.open(p,"_blank","noopener,noreferrer"):N("More details coming soon",{description:a||"This card is a preview."})};return e.jsxs(d,{className:"h-full border border-gray-200",children:[e.jsxs(g,{className:"flex flex-row items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(f,{className:"text-lg font-semibold text-gray-900",children:a||"Untitled"}),e.jsx("p",{className:"text-sm text-gray-600",children:n||"A curated learning experience awaits."})]}),e.jsx(b,{className:"h-5 w-5 text-primary shrink-0"})]}),e.jsx(m,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l?e.jsx(u,{variant:"secondary",children:l}):null,c?e.jsxs(u,{variant:"secondary",children:["Grade ",c]}):null,r==null?void 0:r.map(w=>e.jsx(u,{variant:"outline",children:w},w))]})}),e.jsxs(z,{className:"flex items-center justify-between gap-2",children:[e.jsxs(x,{variant:"ghost",size:"sm",className:"gap-2",onClick:t,children:[e.jsx(V,{className:"h-4 w-4"}),"Save"]}),e.jsxs(x,{variant:"outline",size:"sm",className:"gap-2",onClick:o,children:[h,e.jsx(F,{className:"h-4 w-4"})]})]})]})}_.propTypes={recommendation:i.shape({title:i.string,summary:i.string,tags:i.arrayOf(i.string),subject:i.string,gradeLevel:i.oneOfType([i.string,i.number]),ctaLabel:i.string,ctaHref:i.string})};const I=`query DiscoverRecommendations($limit: Int) {
  activities(order_by: { created_at: desc }, limit: $limit) {
    id
    title
    description
    subject
    grade_level
    category
    library_items(limit: 1) {
      id
      url
      format
    }
  }
}`,K=s=>{var r;const a=((r=s==null?void 0:s.library_items)==null?void 0:r[0])??null,n=[s==null?void 0:s.category,a==null?void 0:a.format].filter(Boolean);return{id:s==null?void 0:s.id,title:s==null?void 0:s.title,summary:s==null?void 0:s.description,subject:s==null?void 0:s.subject,gradeLevel:s==null?void 0:s.grade_level,tags:n,ctaLabel:a!=null&&a.url?"Open resource":"View details",ctaHref:(a==null?void 0:a.url)??void 0}},J=async s=>{if(!s)return{items:[],unavailable:!0};try{const a=await q({query:I,variables:{limit:6}});return{items:((a==null?void 0:a.activities)??[]).map(K),unavailable:!1}}catch(a){return{items:[],unavailable:!1,error:a}}};function X(){const s=C(),{data:a,isLoading:n,isFetching:r,refetch:l}=T({queryKey:["personalized-discover-feed",s==null?void 0:s.id],enabled:!!(s!=null&&s.id),queryFn:()=>J(s==null?void 0:s.id),staleTime:1e3*60*5}),c=B.useMemo(()=>(a==null?void 0:a.items)||[],[a]),h=a==null?void 0:a.unavailable,p=async()=>{var o;const t=await l();t!=null&&t.error&&!((o=t==null?void 0:t.data)!=null&&o.unavailable)&&N("Unable to generate recommendations",{description:t.error.message||"Please try again shortly."})};return s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Personalized for you"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Recommendations generated from your saved interests and classroom activity."})]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"gap-2",onClick:p,disabled:r,children:[e.jsx(k,{className:`h-4 w-4 ${r?"animate-spin":""}`}),r?"Refreshing":"Generate Recommendations"]})]}),n?e.jsx(d,{children:e.jsxs(m,{className:"p-6 space-y-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded bg-gray-100"}),e.jsx("div",{className:"h-3 w-3/4 rounded bg-gray-100"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-gray-100"})]})}):null,!n&&c.length===0?e.jsxs(d,{className:"border-dashed",children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center gap-2 text-gray-800",children:[e.jsx(b,{className:"h-4 w-4"}),"No Recommendations Yet"]})}),e.jsxs(m,{className:"space-y-3 text-sm text-gray-600",children:[e.jsx("p",{children:"We’ll surface personalized ideas as soon as your activity and library data are available."}),e.jsx("div",{children:e.jsxs(x,{variant:"outline",size:"sm",className:"gap-2",onClick:p,disabled:r,children:[e.jsx(k,{className:`h-4 w-4 ${r?"animate-spin":""}`}),r?"Checking again...":"Generate Recommendations"]})})]})]}):null,e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:c.map((t,o)=>e.jsx(_,{recommendation:t},(t==null?void 0:t.id)||(t==null?void 0:t.title)||o))}),a!=null&&a.error&&h?e.jsx("p",{className:"text-sm text-amber-600",children:"Recommendation service is not available yet. We’ll enable it as soon as it ships."}):null]}):null}const Z=Object.entries($||{}).map(([s,a])=>({name:s,path:a,normalizedName:s==null?void 0:s.toLowerCase(),normalizedPath:a==null?void 0:a.toLowerCase()})),y=(s="")=>s.replace(/^\//,"").replace(/-/g," ").replace(/\b\w/g,a=>a.toUpperCase()),ee=(s="")=>{const a=s.toLowerCase(),n=Z.find(({normalizedName:r,normalizedPath:l})=>r===a||l===a||l===`/${a}`);return n?{label:y(n.name),href:n.path}:{label:y(s),href:`/${s.replace(/^\//,"")}`}},se=(s,a,n)=>{if(Array.isArray(s)&&s.length>0)return s;if(Array.isArray(a)&&a.length>0)return a.map(l=>typeof l=="string"?ee(l):l);if(n==="/")return[];const r=n.split("/").filter(Boolean);return r.map((l,c)=>({label:y(l),href:`/${r.slice(0,c+1).join("/")}`}))};function L({items:s=[],segments:a=[]}){const n=A(),r=se(s,a,n.pathname);return e.jsx("nav",{"aria-label":"Breadcrumb",className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("ol",{className:"flex items-center gap-1",children:[e.jsx("li",{className:"flex items-center gap-1",children:e.jsxs(v,{to:"/",className:"flex items-center gap-1 text-gray-700 hover:text-gray-900",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Home"})]})}),r.map((l,c)=>{const h=c===r.length-1;return e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3 text-gray-400"}),h?e.jsx("span",{className:"text-gray-500",children:l.label}):e.jsx(v,{to:l.href||"#",className:"text-gray-700 hover:text-gray-900",children:l.label})]},l.href||l.label)})]})})}L.propTypes={items:i.arrayOf(i.shape({label:i.string.isRequired,href:i.string})),segments:i.arrayOf(i.string)};function ae(s,a){var l;if(typeof a!="function")return;const n=E((s==null?void 0:s.preferred_active_role)||(s==null?void 0:s.role)||((l=s==null?void 0:s.metadata)==null?void 0:l.role)||(s==null?void 0:s.defaultRole)),r=D(n);a(s?r:"/login",{replace:!0})}function ie(){const s=P(),a=C();return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{segments:["UnifiedDiscover"]}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Discover"}),e.jsx("p",{className:"text-gray-600",children:"Personalized recommendations for families and classrooms, powered by the Nhost stack."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",className:"gap-2",onClick:()=>ae(a,s),children:[e.jsx(H,{className:"h-4 w-4"}),"Back to dashboard"]}),e.jsxs(x,{variant:"outline",className:"gap-2",onClick:()=>s("/library"),children:[e.jsx(R,{className:"h-4 w-4"}),"Search library"]})]})]}),e.jsx(X,{}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(d,{children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Always available"]})}),e.jsx(m,{className:"text-sm text-gray-600",children:"Discover gracefully handles missing backend functions so migration work never blocks the UI."})]}),e.jsxs(d,{children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Explore by topic"]})}),e.jsx(m,{className:"text-sm text-gray-600",children:"Browse by subject, grade, and interest tags to build a classroom-ready learning path."})]}),e.jsxs(d,{children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Resource deep links"]})}),e.jsx(m,{className:"text-sm text-gray-600",children:"The route map keeps breadcrumbs synced with GitHub so content can be traced and tested quickly."})]})]})]})}export{ie as default};
//# sourceMappingURL=Discover-tfDRvwwD.js.map
