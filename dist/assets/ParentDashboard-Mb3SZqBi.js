import{f as $,j as e,r as x,w as D,b as T}from"./index-BPP-_OMN.js";import{l as M}from"./events-Bqt3UKl2.js";const P=`
  id
  title
  description
  subject
  grade_level
  category
  status
  duration
  materials_needed
  why_it_matters
  teachmo_tip
  learning_objectives
  created_at
`;function E(s={}){if(!s||typeof s!="object")return{where:void 0,limit:void 0,offset:void 0,order_by:[{created_at:"desc"}]};const{where:t,filter:a,order_by:i,orderBy:r,limit:u,offset:m}=s,c={...s};return delete c.where,delete c.filter,delete c.order_by,delete c.orderBy,delete c.limit,delete c.offset,{where:t??a??(Object.keys(c).length?c:void 0),limit:typeof u=="number"?u:void 0,offset:typeof m=="number"?m:void 0,order_by:F(i??r)??[{created_at:"desc"}]}}function F(s){if(s){if(Array.isArray(s))return s;if(typeof s=="string"){const t=s.trim();if(!t)return;const a=t.startsWith("-"),i=a?t.slice(1):t;return i?[{[i]:a?"desc":"asc"}]:void 0}if(typeof s=="object")return[s]}}async function O(s={}){const{where:t,limit:a,offset:i,order_by:r}=E(s),u=`query Activities($where: activities_bool_exp, $limit: Int, $offset: Int, $order_by: [activities_order_by!]) {
    activities(where: $where, limit: $limit, offset: $offset, order_by: $order_by) {
      ${P}
    }
  }`,m={where:t&&Object.keys(t).length?t:void 0,limit:a,offset:i,order_by:r},c=await $({query:u,variables:m});return(c==null?void 0:c.activities)||[]}async function R(s){var i;const a=await $({query:`query Threads($profileId: uuid!) {
    thread_participants(where: { profile_id: { _eq: $profileId } }) {
      thread {
        id
        subject
        updated_at
        messages(order_by: { sent_at: desc }, limit: 1) {
          content
          sent_at
        }
      }
    }
  }`,variables:{profileId:s}});return((i=a==null?void 0:a.thread_participants)==null?void 0:i.map(r=>r.thread))||[]}function Z({open:s,onClose:t,brief:a}){var y,j,b,p;if(!s||!a)return null;const i=((y=a.zoneSummary)==null?void 0:y.currentZone)||"green",r=Math.round((((j=a.zoneSummary)==null?void 0:j.tension)||0)*100),u=Math.round((((b=a.zoneSummary)==null?void 0:b.slack)||0)*100),m=a.signalCounts||{},c=Object.entries(m).sort((d,n)=>(n[1]||0)-(d[1]||0)).slice(0,8);return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("button",{className:"absolute inset-0 bg-black/40","aria-label":"Close",onClick:t}),e.jsxs("div",{className:"relative w-[min(900px,92vw)] max-h-[85vh] overflow-auto rounded bg-white shadow-lg",children:[e.jsxs("div",{className:"p-4 border-b flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Weekly Family Brief"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Zone: ",e.jsx("span",{className:"font-semibold",children:i})," · Tension ",r,"% · Slack ",u,"%",(p=a.zoneSummary)!=null&&p.cooldownActive?" · Cooldown active":""]}),a.whyNow&&e.jsxs("p",{className:"mt-2 text-sm text-gray-800",children:[e.jsx("span",{className:"font-semibold",children:"Why now:"})," ",a.whyNow]})]}),e.jsx("button",{className:"px-3 py-2 rounded border text-sm",onClick:t,children:"Close"})]}),e.jsxs("div",{className:"p-4 grid md:grid-cols-2 gap-6",children:[e.jsxs("section",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Highlights"}),e.jsx("ul",{className:"space-y-1 text-sm text-gray-800",children:(a.highlights||[]).map((d,n)=>e.jsxs("li",{children:["• ",d]},`h-${n}`))}),e.jsx("h4",{className:"font-semibold mt-5 mb-2",children:"Watch-outs"}),e.jsx("ul",{className:"space-y-1 text-sm text-gray-800",children:(a.risks||[]).map((d,n)=>e.jsxs("li",{children:["• ",d]},`r-${n}`))})]}),e.jsxs("section",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recommended next steps"}),e.jsx("ol",{className:"list-decimal ml-5 space-y-1 text-sm text-gray-800",children:(a.recommendedNextSteps||[]).map((d,n)=>e.jsx("li",{children:d},`s-${n}`))}),e.jsx("h4",{className:"font-semibold mt-5 mb-2",children:"Signals (top)"}),e.jsxs("div",{className:"text-sm text-gray-800 space-y-1",children:[c.length===0&&e.jsx("p",{className:"text-gray-500",children:"No signal counts available."}),c.map(([d,n])=>e.jsxs("div",{className:"flex justify-between border-b py-1 last:border-0",children:[e.jsx("span",{className:"text-gray-600",children:d.replaceAll("_"," ")}),e.jsx("span",{className:"font-semibold",children:n})]},d))]}),a.setpointAdjustments&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold mt-5 mb-2",children:"System tuning"}),e.jsx("pre",{className:"text-xs bg-gray-50 border rounded p-2 overflow-auto",children:JSON.stringify(a.setpointAdjustments,null,2)})]})]})]})]})]})}function G({brief:s,onGenerate:t,loading:a}){var b,p,d;const[i,r]=x.useState(!1),[u,m]=x.useState(!1),c=x.useMemo(()=>{const n=(s==null?void 0:s.recommendedNextSteps)||[];return i?n.slice(0,5):n.slice(0,2)},[s,i]);if(!s)return e.jsx("div",{className:"bg-white shadow rounded p-4 md:col-span-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium",children:"Weekly Family Brief"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No brief yet. Generate one to get a calm, balanced plan for home + school."})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-black text-white text-sm disabled:opacity-60",onClick:t,disabled:a,children:a?"Generating…":"Generate brief"})]})});const y=((b=s.zoneSummary)==null?void 0:b.currentZone)||"green",j=Math.round((((p=s.zoneSummary)==null?void 0:p.tension)||0)*100);return e.jsxs("div",{className:"bg-white shadow rounded p-4 md:col-span-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium",children:"Weekly Family Brief"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Zone: ",e.jsx("span",{className:"font-semibold",children:y})," · Tension: ",j,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded border text-sm",onClick:()=>m(!0),children:"View full brief"}),e.jsx("button",{className:"px-3 py-2 rounded border text-sm disabled:opacity-60",onClick:t,disabled:a,title:"Refresh with the latest signals",children:a?"Refreshing…":"Refresh"})]})]}),e.jsxs("div",{className:"mt-3 grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Next steps (keep it tiny)"}),s.whyNow&&e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Why now:"})," ",s.whyNow]}),e.jsx("ol",{className:"list-decimal ml-5 space-y-1 text-sm",children:c.map((n,g)=>e.jsx("li",{children:n},`${g}-${n}`))}),(((d=s.recommendedNextSteps)==null?void 0:d.length)||0)>2&&e.jsx("button",{className:"mt-2 text-sm text-blue-600 hover:underline",onClick:()=>r(n=>!n),children:i?"Show fewer steps":"Show more"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"What stood out"}),e.jsx("ul",{className:"space-y-1 text-sm text-gray-700",children:(s.highlights||[]).slice(0,2).map((n,g)=>e.jsxs("li",{children:["• ",n]},`${g}-${n}`))}),e.jsx("p",{className:"text-sm font-semibold mt-3 mb-2",children:"Watch-outs"}),e.jsx("ul",{className:"space-y-1 text-sm text-gray-700",children:(s.risks||[]).slice(0,2).map((n,g)=>e.jsxs("li",{children:["• ",n]},`${g}-${n}`))})]})]}),e.jsx(Z,{open:u,onClose:()=>m(!1),brief:s})]})}function V({items:s,onComplete:t,onDismiss:a,loading:i}){return e.jsxs("div",{className:"bg-white shadow rounded p-4",children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium",children:"Today’s actions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Small, high-impact steps. Stop after one if you’re cooked."})]})}),i&&e.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Loading…"}),!i&&(!s||s.length===0)&&e.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"No queued actions right now."}),e.jsx("ul",{className:"mt-3 space-y-3",children:(s||[]).map(r=>e.jsxs("li",{className:"border rounded p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:r.action.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.action.summary}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded bg-black text-white text-sm disabled:opacity-60",onClick:()=>t(r.action.id),disabled:i,children:"Mark done"}),e.jsx("button",{className:"px-3 py-1.5 rounded border text-sm disabled:opacity-60",onClick:()=>a(r.action.id),disabled:i,children:"Dismiss"})]})]},r.action.id))})]})}async function H(s){return null}async function J(s){return null}async function k(s,{status:t="queued",limit:a=10}={}){return{actions:[]}}async function K(s,t){return null}async function U(s,t){return null}function X(){var w,v;const s=D(),t=T(),[a,i]=x.useState([]),[r,u]=x.useState([]),[m,c]=x.useState([]),[y,j]=x.useState(null),[b,p]=x.useState(!1),[d,n]=x.useState([]),[g,f]=x.useState(!1);x.useEffect(()=>{(async()=>{var _,I,S;if(!s||t.isLoading)return;const o=((_=t.data)==null?void 0:_.profileId)||s,[h,W,q,L]=await Promise.all([M(((I=t.data)==null?void 0:I.schoolId)||null).catch(()=>[]),O().catch(()=>[]),(S=t.data)!=null&&S.profileId?R(t.data.profileId).catch(()=>[]):Promise.resolve([]),H().catch(()=>null)]);i(h),u(W),c(q),j(L),f(!0),k(o,{status:"queued",limit:3}).then(z=>n(z.actions||[])).catch(()=>n([])).finally(()=>f(!1))})()},[s,t.isLoading,(w=t.data)==null?void 0:w.profileId,(v=t.data)==null?void 0:v.schoolId]);const A=async()=>{var o;if(!s)return;const l=((o=t.data)==null?void 0:o.profileId)||s;p(!0);try{const h=await J(l);j(h)}finally{p(!1)}},N=async()=>{var o;if(!s)return;const l=((o=t.data)==null?void 0:o.profileId)||s;f(!0);try{const h=await k(l,{status:"queued",limit:3});n(h.actions||[])}finally{f(!1)}},C=async l=>{var h;if(!s)return;const o=((h=t.data)==null?void 0:h.profileId)||s;f(!0);try{await K(o,l),await N()}finally{f(!1)}},B=async l=>{var h;if(!s)return;const o=((h=t.data)==null?void 0:h.profileId)||s;f(!0);try{await U(o,l),await N()}finally{f(!1)}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Parent dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Keep up with events, activities, and conversations."})]}),e.jsxs("section",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(G,{brief:y,onGenerate:A,loading:b}),e.jsx(V,{items:d,onComplete:C,onDismiss:B,loading:g}),e.jsxs("div",{className:"bg-white shadow rounded p-4",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Upcoming events"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[a.map(l=>e.jsxs("li",{className:"border-b pb-2 last:border-0",children:[e.jsx("p",{className:"font-semibold",children:l.title}),e.jsx("p",{className:"text-gray-500",children:new Date(l.starts_at).toLocaleString()})]},l.id)),a.length===0&&e.jsx("p",{className:"text-gray-500",children:"No events scheduled."})]})]}),e.jsxs("div",{className:"bg-white shadow rounded p-4",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Activities & library"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[r.map(l=>e.jsxs("li",{className:"border-b pb-2 last:border-0",children:[e.jsx("p",{className:"font-semibold",children:l.title}),e.jsxs("p",{className:"text-gray-500",children:[l.subject," · ",l.grade_level]})]},l.id)),r.length===0&&e.jsx("p",{className:"text-gray-500",children:"Browse curated activities once your library is loaded."})]})]}),e.jsxs("div",{className:"bg-white shadow rounded p-4",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Messages"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[m.map(l=>{var o;return e.jsxs("li",{className:"border-b pb-2 last:border-0",children:[e.jsx("p",{className:"font-semibold",children:l.subject||"Conversation"}),((o=l.messages)==null?void 0:o[0])&&e.jsx("p",{className:"text-gray-500 truncate",children:l.messages[0].content})]},l.id)}),m.length===0&&e.jsx("p",{className:"text-gray-500",children:"Start a message thread from the Messages section."})]})]})]})]})}export{X as default};
//# sourceMappingURL=ParentDashboard-Mb3SZqBi.js.map
