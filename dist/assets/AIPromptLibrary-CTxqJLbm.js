import{r as c,w as y,j as e,P as q,C as N,i as b,k as P,o as C,B as S,e as l,n as B}from"./index-CXW08ga6.js";import{u as A}from"./useMutation-mXVxaFfD.js";import{I as p}from"./input-DQ0nv64R.js";import{T}from"./textarea-MrBTA2MH.js";async function m(r,x={}){const n=await fetch(r,x);if(!n.ok){const a=await n.text();throw new Error(a||"Request failed")}return n.json()}function O(){var _,$;const[r,x]=c.useState(null),[n,a]=c.useState({name:"",description:"",content:""}),[v,w]=c.useState(""),[o,u]=c.useState({name:"",description:"",isArchived:!1}),i=y({queryKey:["ai-prompts-token"],queryFn:async()=>{const s=await B.auth.getAccessToken();return{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}}}),d=y({queryKey:["ai-prompts-admin"],enabled:!!i.data,queryFn:async()=>m(`${l}/admin/ai/prompts`,{headers:i.data})}),h=y({queryKey:["ai-prompts-versions",r],enabled:!!(i.data&&r),queryFn:async()=>m(`${l}/admin/ai/prompts/${r}/versions`,{headers:i.data}),onSuccess:s=>{s!=null&&s.prompt&&u({name:s.prompt.name||"",description:s.prompt.description||"",isArchived:!!s.prompt.is_archived});const t=((s==null?void 0:s.versions)||[]).find(I=>I.is_active);w((t==null?void 0:t.content)||"")}}),j=A({mutationFn:async()=>m(`${l}/admin/ai/prompts`,{method:"POST",headers:i.data,body:JSON.stringify({name:n.name,description:n.description,content:n.content})}),onSuccess:s=>{d.refetch(),x((s==null?void 0:s.id)||null),a({name:"",description:"",content:""})}}),g=A({mutationFn:async()=>m(`${l}/admin/ai/prompts/${r}`,{method:"PUT",headers:i.data,body:JSON.stringify({name:o.name,description:o.description,isArchived:o.isArchived})}),onSuccess:()=>{d.refetch(),h.refetch()}}),f=A({mutationFn:async()=>m(`${l}/admin/ai/prompts/${r}/versions`,{method:"POST",headers:i.data,body:JSON.stringify({content:v,setActive:!0})}),onSuccess:()=>{h.refetch(),d.refetch()}}),k=c.useMemo(()=>{var s;return((s=d.data)==null?void 0:s.prompts)||[]},[d.data]);return e.jsx(q,{allowedRoles:["system_admin","admin"],children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"AI Prompt Library"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create, version, and manage prompts used across Teachmo's AI features. Active versions can be promoted instantly for tenant-safe rollouts."})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr_2fr]",children:[e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(P,{children:"Prompt Catalog"})}),e.jsx(C,{className:"space-y-3",children:k.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No prompts yet. Create the first prompt to get started."}):e.jsx("ul",{className:"space-y-2",children:k.map(s=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>x(s.id),className:`w-full text-left border rounded-lg p-3 transition ${r===s.id?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description||"No description"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["v",s.version??"—"," ",s.is_archived?"• Archived":""]})]})})},s.id))})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(P,{children:"Create New Prompt"})}),e.jsxs(C,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Name"}),e.jsx(p,{value:n.name,onChange:s=>a(t=>({...t,name:s.target.value})),placeholder:"e.g., Attendance summary"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Description"}),e.jsx(p,{value:n.description,onChange:s=>a(t=>({...t,description:s.target.value})),placeholder:"Short description for admins"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Prompt content"}),e.jsx(T,{value:n.content,onChange:s=>a(t=>({...t,content:s.target.value})),rows:6,placeholder:"You are a helpful assistant..."})]}),e.jsx(S,{onClick:()=>j.mutate(),disabled:!n.name||!n.content||j.isPending,children:j.isPending?"Creating…":"Create prompt"})]})]}),e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(P,{children:"Selected Prompt"})}),e.jsx(C,{className:"space-y-4",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Name"}),e.jsx(p,{value:o.name,onChange:s=>u(t=>({...t,name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Description"}),e.jsx(p,{value:o.description,onChange:s=>u(t=>({...t,description:s.target.value}))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o.isArchived,onChange:s=>u(t=>({...t,isArchived:s.target.checked}))}),"Archive prompt"]}),e.jsx(S,{variant:"secondary",onClick:()=>g.mutate(),disabled:g.isPending,children:g.isPending?"Saving…":"Save details"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"New version content"}),e.jsx(T,{value:v,onChange:s=>w(s.target.value),rows:8}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(S,{onClick:()=>f.mutate(),disabled:!v||f.isPending,children:f.isPending?"Publishing…":"Publish new version"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Version history"}),($=(_=h.data)==null?void 0:_.versions)!=null&&$.length?e.jsx("ul",{className:"space-y-2 text-sm",children:h.data.versions.map(s=>e.jsx("li",{className:"border rounded-lg p-2",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:["v",s.version]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.is_active?"Active":"Archived"," ·"," ",s.created_at?new Date(s.created_at).toLocaleString():"—"]})]})},s.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No versions recorded yet."})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a prompt to edit or add versions."})})]})]})]})]})})}export{O as default};
//# sourceMappingURL=AIPromptLibrary-CTxqJLbm.js.map
