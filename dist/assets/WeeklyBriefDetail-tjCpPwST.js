import{d as g,u as f,r as m,j as e,L as j}from"./index-BPP-_OMN.js";import{W as y}from"./entities-B5ABfrWT.js";const N={WeeklyBrief:y},{WeeklyBrief:t}=N;function b({weekStart:a}={}){return a?{week_start:a}:{}}const x={entity:t,async list({weekStart:a}={}){const l=b({weekStart:a}),i=Object.keys(l).length>0;return!(t!=null&&t.filter)||!(t!=null&&t.list)?[]:i?t.filter(l,"-published_at"):t.list("-published_at")},async get(a){return t!=null&&t.get?t.get(a):null},async logView(a,l="dashboard"){if(!(t!=null&&t.update)||!(t!=null&&t.get))return null;const i=await t.get(a),h=Number((i==null?void 0:i.open_count)||0)+1,c=(i==null?void 0:i.opened_at)||new Date().toISOString();return t.update(a,{open_count:h,opened_at:c,last_opened_at:new Date().toISOString(),last_opened_source:l})}};function w(a){try{return new Date(a).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}catch{return a}}function S(){const{id:a}=g(),l=f(),[i,h]=m.useState(!0),[c,u]=m.useState(""),[n,p]=m.useState(null);m.useEffect(()=>{let r=!0;return(async()=>{if(!a){l("/parent/dashboard",{replace:!0});return}h(!0),u("");try{const d=await x.get(a);if(!r)return;p(d),x.logView(a,"dashboard").catch(()=>{})}catch(d){if(!r)return;u((d==null?void 0:d.message)||"Unable to load weekly brief")}finally{if(!r)return;h(!1)}})(),()=>{r=!1}},[a,l]);const s=n==null?void 0:n.brief_content;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:(s==null?void 0:s.title)||"This Week at School"}),e.jsx("p",{className:"text-gray-600",children:s!=null&&s.weekOf?`Week of ${w(s.weekOf)}`:""})]}),e.jsx(j,{to:"/parent/dashboard",className:"text-sm font-medium text-indigo-600 hover:text-indigo-700",children:"Back to dashboard"})]}),i&&e.jsx("p",{className:"text-gray-600",children:"Loading…"}),!i&&c&&e.jsx("p",{className:"text-red-600",children:c}),!i&&!c&&n&&e.jsxs("div",{className:"bg-white shadow rounded p-6 space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"What matters most"}),e.jsxs("ul",{className:"mt-3 space-y-3",children:[((s==null?void 0:s.whatMattersMost)||[]).map((r,o)=>e.jsxs("li",{className:"border-b pb-3 last:border-0 last:pb-0",children:[e.jsx("p",{className:"font-semibold",children:r.text}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.etaMinutes?`~${r.etaMinutes} min`:null,r.etaMinutes&&r.why?" · ":null,r.why||null]})]},`${n.id}-core-${o}`)),((s==null?void 0:s.whatMattersMost)||[]).length===0&&e.jsx("li",{className:"text-gray-500",children:"No core items detected for this week."})]})]}),((s==null?void 0:s.goodToKnow)||[]).length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Good to know"}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-gray-700",children:(s.goodToKnow||[]).map((r,o)=>e.jsxs("li",{children:["• ",r.text]},`${n.id}-gtk-${o}`))})]}),n.mediation_level!=="HIGH"&&((s==null?void 0:s.optionalIfYouHaveTime)||[]).length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Optional if you have time"}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-gray-700",children:(s.optionalIfYouHaveTime||[]).map((r,o)=>e.jsxs("li",{children:["• ",r.text]},`${n.id}-opt-${o}`))})]}),s!=null&&s.teachmoNote?e.jsx("section",{className:"bg-gray-50 rounded p-4",children:e.jsx("p",{className:"text-sm text-gray-700 italic",children:s.teachmoNote})}):null,e.jsx("section",{className:"pt-2 border-t",children:e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700",children:"Technical details (for debugging)"}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Mediation: ",e.jsx("span",{className:"font-mono",children:n.mediation_level})]}),e.jsxs("p",{children:["SLS / HCS / TI:"," ",e.jsxs("span",{className:"font-mono",children:[n.school_load_score," / ",n.home_capacity_score," / ",n.tension_index]})]}),e.jsxs("p",{children:["Views: ",e.jsx("span",{className:"font-mono",children:n.view_count})]})]})]})})]})]})}export{S as default};
//# sourceMappingURL=WeeklyBriefDetail-tjCpPwST.js.map
