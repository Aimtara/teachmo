{"version":3,"file":"MessagingRequests-B_p45ZOt.js","sources":["../../src/utils/cn.ts","../../src/pages/MessagingRequests.jsx"],"sourcesContent":["export function cn(...classes: (string | undefined | null | false)[]) {\n  return classes.filter(Boolean).join(' ');\n}\n","import { useCallback, useEffect, useMemo, useState } from 'react';\nimport { formatDistanceToNow } from 'date-fns';\nimport { useUserData } from '@nhost/react';\nimport { MessagingAPI } from '@/api/adapters';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { cn } from '@/utils';\nimport { createLogger } from '@/utils/logger';\n\nconst logger = createLogger('MessagingRequests');\n\nfunction RequestRow({ request, onApprove, onDeny, onReasonChange, isProcessing, reasonValue }) {\n  const created = useMemo(() => {\n    if (!request?.created_at) return 'just now';\n    try {\n      return formatDistanceToNow(new Date(request.created_at), { addSuffix: true });\n    } catch (error) {\n      logger.error('Invalid date in messaging request', error);\n      return request.created_at;\n    }\n  }, [request?.created_at]);\n\n  return (\n    <div className=\"rounded-lg border bg-white p-4 shadow-sm space-y-3\">\n      <div className=\"flex flex-wrap items-center justify-between gap-2\">\n        <div>\n          <p className=\"text-sm text-gray-500\">Requester</p>\n          <p className=\"font-semibold text-gray-900\">{request.requester_user_id}</p>\n        </div>\n        <div className=\"text-right\">\n          <p className=\"text-sm text-gray-500\">Target</p>\n          <p className=\"font-semibold text-gray-900\">{request.target_user_id}</p>\n        </div>\n      </div>\n\n      {request.metadata?.note && (\n        <div className=\"rounded-md bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-900\">\n          <p className=\"font-semibold\">Note from requester</p>\n          <p className=\"whitespace-pre-wrap\">{request.metadata.note}</p>\n        </div>\n      )}\n\n      <div className=\"space-y-2\">\n        <Textarea\n          placeholder=\"Optional reason (shared when denying)\"\n          value={reasonValue}\n          onChange={(event) => onReasonChange(request.id, event.target.value)}\n          className=\"min-h-[80px]\"\n        />\n        <div className=\"flex flex-wrap gap-2 justify-end\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            disabled={isProcessing}\n            onClick={() => onDeny(request.id)}\n          >\n            {isProcessing ? 'Saving…' : 'Deny'}\n          </Button>\n          <Button\n            size=\"sm\"\n            disabled={isProcessing}\n            onClick={() => onApprove(request.id)}\n          >\n            {isProcessing ? 'Saving…' : 'Approve'}\n          </Button>\n        </div>\n        <p className=\"text-xs text-gray-500\">Requested {created}</p>\n      </div>\n    </div>\n  );\n}\n\nexport default function MessagingRequests() {\n  const user = useUserData();\n  const [requests, setRequests] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [processing, setProcessing] = useState({});\n  const [reasons, setReasons] = useState({});\n  const load = useCallback(async () => {\n    setLoading(true);\n    try {\n      const list = await MessagingAPI.listRequests({ status: 'pending' });\n      setRequests(Array.isArray(list) ? list : []);\n      setError('');\n    } catch (err) {\n      logger.error('Failed to load messaging requests', err);\n      setError(err?.message ?? 'Unable to load requests');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    load();\n  }, [load]);\n\n  const handleReasonChange = (id, value) => {\n    setReasons((prev) => ({ ...prev, [id]: value }));\n  };\n\n  const decide = async (id, approve) => {\n    if (!id) return;\n    setProcessing((prev) => ({ ...prev, [id]: true }));\n    try {\n      await MessagingAPI.approveMessagingRequest({\n        requestId: id,\n        approve,\n        reason: reasons[id],\n      });\n      await load();\n    } catch (err) {\n      logger.error('Error saving messaging decision', err);\n      setError(err?.message ?? 'Unable to save decision');\n    } finally {\n      setProcessing((prev) => ({ ...prev, [id]: false }));\n    }\n  };\n\n  const greeting = user?.displayName || user?.email || 'there';\n\n  return (\n    <div className=\"p-6 space-y-4\">\n      <header className=\"space-y-1\">\n        <p className=\"text-sm text-gray-500\">Hi {greeting},</p>\n        <h1 className=\"text-2xl font-semibold text-gray-900\">Messaging requests</h1>\n        <p className=\"text-sm text-gray-600\">Approve or deny requests addressed to you.</p>\n      </header>\n\n      {error && (\n        <div className=\"rounded-md border border-red-100 bg-red-50 p-3 text-sm text-red-700\" role=\"alert\">\n          {error}\n        </div>\n      )}\n\n      {loading ? (\n        <p className=\"text-gray-600\">Loading requests…</p>\n      ) : requests.length === 0 ? (\n        <div className=\"rounded-lg border border-gray-100 bg-white p-6 shadow-sm\">\n          <p className=\"font-semibold text-gray-900\">No pending requests</p>\n          <p className=\"text-sm text-gray-600\">You&apos;ll see new requests here when parents ask to message you.</p>\n        </div>\n      ) : (\n        <div className={cn('grid gap-4', requests.length > 1 ? 'md:grid-cols-2' : '')}>\n          {requests.map((request) => (\n            <RequestRow\n              key={request.id}\n              request={request}\n              onApprove={() => decide(request.id, true)}\n              onDeny={() => decide(request.id, false)}\n              onReasonChange={handleReasonChange}\n              isProcessing={processing[request.id]}\n              reasonValue={reasons[request.id] ?? ''}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["cn","classes","logger","createLogger","RequestRow","request","onApprove","onDeny","onReasonChange","isProcessing","reasonValue","created","useMemo","formatDistanceToNow","error","jsxs","jsx","_a","Textarea","event","Button","MessagingRequests","user","useUserData","requests","setRequests","useState","loading","setLoading","setError","processing","setProcessing","reasons","setReasons","load","useCallback","list","MessagingAPI.listRequests","err","useEffect","handleReasonChange","id","value","prev","decide","approve","MessagingAPI.approveMessagingRequest","greeting"],"mappings":"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"}