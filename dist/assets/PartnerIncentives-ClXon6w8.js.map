{"version":3,"file":"PartnerIncentives-ClXon6w8.js","sources":["../../src/pages/PartnerIncentives.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport { API_BASE_URL } from '@/config/api';\nimport { useUserId } from '@nhost/react';\nimport { useTenantScope } from '@/hooks/useTenantScope';\nimport ProtectedRoute from '@/components/shared/ProtectedRoute';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { ultraMinimalToast } from '@/components/shared/UltraMinimalToast';\n\nfunction PartnerIncentivesContent() {\n  const [list, setList] = useState([]);\n  const [apps, setApps] = useState([]);\n  const userId = useUserId();\n  const { data: scope } = useTenantScope();\n  const partnerId = userId;\n\n  const tenantHeaders = useMemo(() => {\n    const h = {};\n    if (userId) h['x-user-id'] = userId;\n    if (scope?.districtId) h['x-district-id'] = scope.districtId;\n    if (scope?.schoolId) h['x-school-id'] = scope.schoolId;\n    return h;\n  }, [userId, scope?.districtId, scope?.schoolId]);\n\n  const load = async () => {\n    try {\n      const [incentives, applications] = await Promise.all([\n        fetch(`${API_BASE_URL}/incentives`, { headers: tenantHeaders }).then((r) => r.json()),\n        partnerId\n          ? fetch(`${API_BASE_URL}/incentives/applications/${partnerId}`, { headers: tenantHeaders }).then((r) => r.json())\n          : Promise.resolve([]),\n      ]);\n      setList(incentives || []);\n      setApps(applications || []);\n    } catch (error) {\n      console.error('Failed to load incentives:', error);\n      ultraMinimalToast.error('Unable to load incentives.');\n      setList([]);\n      setApps([]);\n    }\n  };\n\n  useEffect(() => { load(); }, [tenantHeaders, partnerId]);\n\n  const apply = async (id) => {\n    try {\n      await fetch(`${API_BASE_URL}/incentives/${id}/apply`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', ...tenantHeaders },\n        body: JSON.stringify({ partnerId }),\n      });\n      load();\n    } catch (error) {\n      console.error('Failed to apply for incentive:', error);\n      ultraMinimalToast.error('Unable to apply for this incentive.');\n    }\n  };\n\n  const claim = async (id) => {\n    try {\n      await fetch(`${API_BASE_URL}/incentives/${id}/claim`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', ...tenantHeaders },\n        body: JSON.stringify({ partnerId }),\n      });\n      load();\n    } catch (error) {\n      console.error('Failed to claim incentive:', error);\n      ultraMinimalToast.error('Unable to claim this incentive.');\n    }\n  };\n\n  const appMap = Object.fromEntries(apps.map((a) => [a.incentive_id, a]));\n\n  const getStatus = (application) => {\n    if (!application) return { label: 'Not Applied', variant: 'secondary' };\n    if (application.status === 'earned') return { label: 'Earned', variant: 'default' };\n    if (application.status === 'approved') return { label: 'Approved', variant: 'default' };\n    if (application.status === 'rejected') return { label: 'Rejected', variant: 'destructive' };\n    return { label: application.status || 'Pending', variant: 'secondary' };\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6\">\n      <div className=\"max-w-5xl mx-auto space-y-6\">\n        <header className=\"space-y-2\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Incentives</h1>\n          <p className=\"text-gray-600\">\n            Track incentive programs, claim earned rewards, and monitor payout status.\n          </p>\n        </header>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-xl\">Available programs</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {list.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">No incentive programs available yet.</p>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Program</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Value</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Action</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {list.map((incentive) => {\n                    const application = appMap[incentive.id];\n                    const status = getStatus(application);\n                    const value = incentive.value ? `$${incentive.value}` : '—';\n                    const canClaim = application?.status === 'earned';\n                    return (\n                      <TableRow key={incentive.id}>\n                        <TableCell className=\"font-medium\">{incentive.title}</TableCell>\n                        <TableCell className=\"text-muted-foreground\">{incentive.description}</TableCell>\n                        <TableCell>{value}</TableCell>\n                        <TableCell>\n                          <Badge variant={status.variant}>{status.label}</Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {!application && (\n                            <Button size=\"sm\" onClick={() => apply(incentive.id)}>\n                              Apply\n                            </Button>\n                          )}\n                          {canClaim && (\n                            <Button size=\"sm\" onClick={() => claim(incentive.id)}>\n                              Claim\n                            </Button>\n                          )}\n                          {application && !canClaim && (\n                            <span className=\"text-xs text-muted-foreground\">—</span>\n                          )}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport default function PartnerIncentives() {\n  return (\n    <ProtectedRoute allowedRoles={['partner', 'admin', 'system_admin']} requireAuth={true}>\n      <PartnerIncentivesContent />\n    </ProtectedRoute>\n  );\n}\n"],"names":["PartnerIncentivesContent","list","setList","useState","apps","setApps","userId","useUserId","scope","useTenantScope","partnerId","tenantHeaders","useMemo","h","load","incentives","applications","API_BASE_URL","error","ultraMinimalToast","useEffect","apply","id","claim","appMap","a","getStatus","application","jsxs","jsx","Card","CardHeader","CardTitle","CardContent","Table","TableHeader","TableRow","TableHead","TableBody","incentive","status","value","canClaim","TableCell","Badge","Button","PartnerIncentives","ProtectedRoute"],"mappings":"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"}