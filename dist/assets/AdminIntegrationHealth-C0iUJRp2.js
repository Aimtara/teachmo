import{r as a,j as e,e as k}from"./index-CXW08ga6.js";async function y(n,x={}){const d=await fetch(`${k}${n}`,{headers:{"Content-Type":"application/json",...x.headers||{}},...x}),i=await d.json().catch(()=>({}));if(!d.ok)throw new Error((i==null?void 0:i.error)||"Request failed");return i}function j(n){if(!n)return"—";try{return new Date(n).toLocaleString()}catch{return n}}function A(){var S,w,I;const[n,x]=a.useState([]),[d,i]=a.useState(""),[r,m]=a.useState(null),[h,f]=a.useState(!1),[b,u]=a.useState(!1),[N,l]=a.useState(""),[p,g]=a.useState(""),t=a.useMemo(()=>n.find(s=>s.id===d),[n,d]),o=a.useCallback(async()=>{f(!0),l(""),g("");try{const s=await y("/integrations/roster/alerts");x(s),s.length&&!d&&i(s[0].id)}catch(s){l((s==null?void 0:s.message)||"Failed to load alerts.")}finally{f(!1)}},[d]),v=a.useCallback(async s=>{if(s){u(!0),l("");try{const c=await y(`/integrations/roster/runs/${s}`);m(c)}catch(c){l((c==null?void 0:c.message)||"Failed to load run.")}finally{u(!1)}}},[]),R=a.useCallback(async()=>{if(t!=null&&t.runId){u(!0),l(""),g("");try{const s=await y(`/integrations/roster/runs/${t.runId}/retry`,{method:"POST"});m(s),g("Retry started."),await o()}catch(s){l((s==null?void 0:s.message)||"Retry failed.")}finally{u(!1)}}},[t,o]);return a.useEffect(()=>{o()},[o]),a.useEffect(()=>{t!=null&&t.runId?v(t.runId):m(null)},[t,v]),e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Integration Sync Health"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monitor SIS/LMS sync alerts, diagnostics, and remediation actions."})]}),N&&e.jsx("div",{className:"bg-red-50 text-red-700 border border-red-200 p-3 rounded",children:N}),p&&e.jsx("div",{className:"bg-green-50 text-green-700 border border-green-200 p-3 rounded",children:p}),e.jsxs("div",{className:"grid md:grid-cols-[1.2fr_1.8fr] gap-6",children:[e.jsxs("section",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Active alerts"}),e.jsx("button",{type:"button",onClick:o,className:"text-sm text-blue-600 hover:underline disabled:opacity-50",disabled:h,children:h?"Refreshing…":"Refresh"})]}),n.length===0&&!h&&e.jsx("p",{className:"text-sm text-gray-500",children:"No alerts right now."}),e.jsx("ul",{className:"space-y-2",children:n.map(s=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>i(s.id),className:`w-full text-left border rounded p-3 space-y-1 ${d===s.id?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:s.message}),e.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:s.severity})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created ",j(s.createdAt)]}),s.runId&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Run ID: ",s.runId]})]})},s.id))})]}),e.jsxs("section",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium",children:"Diagnostics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review failed sync details and retry."})]}),e.jsx("button",{type:"button",onClick:R,className:"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50",disabled:!(t!=null&&t.runId)||b,children:b?"Retrying…":"Retry sync"})]}),!t&&e.jsx("p",{className:"text-sm text-gray-500",children:"Select an alert to view details."}),t&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:"Alert details"}),e.jsxs("div",{className:"text-gray-600",children:["Severity: ",t.severity]}),e.jsxs("div",{className:"text-gray-600",children:["Source ID: ",t.sourceId||"—"]}),e.jsxs("div",{className:"text-gray-600",children:["Run ID: ",t.runId||"—"]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded p-3 space-y-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"Run diagnostics"}),r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-gray-600",children:["Status: ",r.status]}),e.jsxs("div",{className:"text-gray-600",children:["Started: ",j(r.startedAt)]}),e.jsxs("div",{className:"text-gray-600",children:["Finished: ",j(r.finishedAt)]}),e.jsxs("div",{className:"text-gray-600",children:["Invalid: ",((S=r.stats)==null?void 0:S.invalid)??0]}),e.jsxs("div",{className:"text-gray-600",children:["Deactivated: ",((w=r.stats)==null?void 0:w.deactivated)??0]}),e.jsxs("div",{className:"text-gray-600",children:["Triggered by: ",r.triggeredBy]}),((I=r.errors)==null?void 0:I.length)>0&&e.jsx("div",{className:"text-red-600 text-xs",children:r.errors.map((s,c)=>e.jsxs("div",{children:["• ",s.message]},`${s.message}-${c}`))}),r.diagnostics&&e.jsx("pre",{className:"text-xs bg-slate-50 border border-slate-200 rounded p-2 overflow-auto",children:JSON.stringify(r.diagnostics,null,2)})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Loading run details…"})]})]})]})]})]})}export{A as default};
//# sourceMappingURL=AdminIntegrationHealth-C0iUJRp2.js.map
