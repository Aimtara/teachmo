import{b as I,r as h,G as K,j as e,C as P,i as k,k as w,o as S,B as F,K as L,M as N,O as E,Q as M}from"./index-BPP-_OMN.js";import{u as R}from"./useMutation-CMiQkM4s.js";import{I as o}from"./input-DXyqFpUo.js";import{S as O}from"./switch-CC0KUM4c.js";import{T as z,a as H,b as g,c as r,d as Q,e as l}from"./table-C5y0xJGn.js";const q=[];function p(s){return{enabled:!!(s.enabled??s.defaultEnabled??!1),description:s.description??"",rolloutPercentage:s.rolloutPercentage??"",canaryPercentage:s.canaryPercentage??"",allowlistText:E(s.allowlist),denylistText:E(s.denylist)}}function J(){const{data:s}=I(),i=(s==null?void 0:s.organizationId)??null,u=(s==null?void 0:s.schoolId)??null,[x,y]=h.useState(""),[b,f]=h.useState(""),[C,T]=h.useState({}),d=K({queryKey:["feature-flags-admin",i,u],enabled:!!i,queryFn:()=>M({organizationId:i,schoolId:u})}),j=R({mutationFn:L,onSuccess:()=>d.refetch()});h.useEffect(()=>{var a;(a=d.data)!=null&&a.flags&&T(()=>{const t={};return d.data.flags.forEach(n=>{t[n.key]=p(n)}),t})},[d.data]);const m=h.useMemo(()=>{var a;return((a=d.data)==null?void 0:a.flags)??q},[d.data]),c=(a,t,n)=>{T(v=>({...v,[a]:{...v[a]??p(m.find(B=>B.key===a)||{}),[t]:n}}))},D=a=>{var n;const t=C[a];t&&j.mutate({key:a,organizationId:i,schoolId:u,enabled:!!t.enabled,description:((n=t.description)==null?void 0:n.trim())||null,rolloutPercentage:t.rolloutPercentage===""?null:Number(t.rolloutPercentage),canaryPercentage:t.canaryPercentage===""?null:Number(t.canaryPercentage),allowlist:N(t.allowlistText||""),denylist:N(t.denylistText||"")})},A=()=>{x.trim()&&(j.mutate({key:x.trim(),organizationId:i,schoolId:u,description:b.trim()||null,enabled:!1,rolloutPercentage:null,canaryPercentage:null,allowlist:[],denylist:[]}),y(""),f(""))};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Feature Flags"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Toggle enterprise capabilities per tenant. Percentage rollouts apply to user-based hashing, with allowlists and denylists overriding staged rollouts. Updates are audited in the backend."})]}),e.jsxs(P,{children:[e.jsx(k,{children:e.jsx(w,{children:"Create Flag"})}),e.jsxs(S,{className:"grid gap-4 md:grid-cols-[2fr,3fr,auto]",children:[e.jsx(o,{value:x,onChange:a=>y(a.target.value),placeholder:"ENTERPRISE_SSO"}),e.jsx(o,{value:b,onChange:a=>f(a.target.value),placeholder:"Description"}),e.jsx(F,{onClick:A,disabled:!x.trim()||j.isLoading||!i,children:"Add"})]})]}),e.jsxs(P,{children:[e.jsx(k,{children:e.jsx(w,{children:"Flags"})}),e.jsx(S,{className:"space-y-4",children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsxs(g,{children:[e.jsx(r,{children:"Key"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Default"}),e.jsx(r,{children:"Enabled"}),e.jsx(r,{children:"Rollout %"}),e.jsx(r,{children:"Canary %"}),e.jsx(r,{children:"Allowlist"}),e.jsx(r,{children:"Denylist"}),e.jsx(r,{children:"Scope"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(Q,{children:m.length===0?e.jsx(g,{children:e.jsx(l,{colSpan:10,className:"text-sm text-muted-foreground",children:"No flags configured."})}):m.map(a=>{const t=C[a.key]??p(a);return e.jsxs(g,{children:[e.jsx(l,{className:"font-mono text-xs",children:a.key}),e.jsx(l,{children:e.jsx(o,{value:t.description,onChange:n=>c(a.key,"description",n.target.value)})}),e.jsx(l,{children:a.defaultEnabled?"On":"Off"}),e.jsx(l,{children:e.jsx(O,{checked:!!t.enabled,onCheckedChange:n=>c(a.key,"enabled",n),"aria-label":`Toggle ${a.key}`})}),e.jsx(l,{children:e.jsx(o,{type:"number",min:"0",max:"100",value:t.rolloutPercentage,onChange:n=>c(a.key,"rolloutPercentage",n.target.value),placeholder:"0-100"})}),e.jsx(l,{children:e.jsx(o,{type:"number",min:"0",max:"100",value:t.canaryPercentage,onChange:n=>c(a.key,"canaryPercentage",n.target.value),placeholder:"0-100"})}),e.jsx(l,{children:e.jsx(o,{value:t.allowlistText,onChange:n=>c(a.key,"allowlistText",n.target.value),placeholder:"tenant ids"})}),e.jsx(l,{children:e.jsx(o,{value:t.denylistText,onChange:n=>c(a.key,"denylistText",n.target.value),placeholder:"tenant ids"})}),e.jsx(l,{children:a.scope??(u?"school":"organization")}),e.jsx(l,{children:e.jsx(F,{variant:"outline",onClick:()=>D(a.key),disabled:j.isLoading||!i,children:"Save"})})]},a.key)})})]})})]})]})}export{J as default};
//# sourceMappingURL=AdminFeatureFlags-CTOl7JTm.js.map
