import{c as H,r,h as K,u as Z,y as J,Q as X}from"./index-CXW08ga6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],re=H("Star",ee),te=X("use-api"),b={maxConcurrentRequests:3,requestDelay:500,backoffMultiplier:2,maxBackoffDelay:1e4};let T=[],_=0,N=0;const q=a=>{var l;const t=(a==null?void 0:a.message)||(a==null?void 0:a.toString())||"Unknown error",o=((l=a==null?void 0:a.response)==null?void 0:l.status)||(a==null?void 0:a.status);return o===429||t.includes("429")||t.includes("Too Many Requests")?{type:"rate_limit",code:"RATE_LIMITED",shouldRetry:!0}:t.includes("Unauthorized")||o===401?{type:"auth",code:"UNAUTHORIZED",shouldRetry:!1}:o===403||t.includes("Forbidden")?{type:"permission",code:"FORBIDDEN",shouldRetry:!1}:o===404||t.includes("Not Found")?{type:"not_found",code:"NOT_FOUND",shouldRetry:!1}:o>=500||t.includes("500")||t.includes("502")||t.includes("503")||t.includes("504")?{type:"server",code:"SERVER_ERROR",shouldRetry:!0}:t.includes("Network")||t.includes("Failed to fetch")||t.includes("ETIMEDOUT")||t.includes("ECONNREFUSED")?{type:"network",code:"NETWORK_ERROR",shouldRetry:!0}:{type:"general",code:"GENERAL_ERROR",shouldRetry:!1}},v=async a=>new Promise((t,o)=>{const l={fn:a,resolve:t,reject:o};T.push(l),O()}),O=async()=>{if(_>=b.maxConcurrentRequests||T.length===0)return;const a=Date.now(),t=a-N;if(t<b.requestDelay){setTimeout(O,b.requestDelay-t);return}const{fn:o,resolve:l,reject:u}=T.shift();_++,N=a;try{const i=await o();l(i)}catch(i){u(i)}finally{_--,setTimeout(O,b.requestDelay)}},M=async(a,t,o,l)=>{try{return await v(a)}catch(u){const i=q(u);if(t>0&&i.shouldRetry){const y=i.type==="rate_limit"?Math.min(o*b.backoffMultiplier,b.maxBackoffDelay):o;return te.warn(`Request failed, retrying in ${y}ms. Retries left: ${t}`,u.message),await new Promise(f=>setTimeout(f,y)),M(a,t-1,y)}throw u}},se=(a,t="")=>{const{type:o}=q(a);switch(o){case"rate_limit":return"Too many requests. Please wait a moment and try again.";case"auth":return"Your session has expired. Please sign in again.";case"permission":return"You don't have permission to perform this action.";case"not_found":return`The requested ${t||"resource"} could not be found.`;case"server":return"Our servers are experiencing issues. Please try again in a few minutes.";case"network":return"Connection problem. Please check your internet and try again.";default:return`Something went wrong${t?` with ${t}`:""}. Please try again.`}},ne=(a={})=>{const[t,o]=r.useState({}),[l,u]=r.useState({}),{toast:i}=K(),y=Z(),f=r.useRef({}),{showToastOnError:D=!0,showToastOnSuccess:x=!1,redirectOnAuth:S=!0,enableRetry:I=!0,context:$="",silent:p=!1}=a,m=r.useCallback((e,s)=>{o(n=>({...n,[e]:s}))},[]),R=r.useCallback((e,s)=>{u(n=>({...n,[e]:s}))},[]),C=r.useCallback(e=>{u(s=>{const n={...s};return delete n[e],n})},[]),h=r.useCallback(e=>{f.current[e]&&(f.current[e].abort(),delete f.current[e],m(e,!1))},[m]),c=r.useCallback(async(e,{key:s="default",successMessage:n=null,errorContext:E=$,onSuccess:L=null,onError:A=null,skipErrorHandling:G=!1,retryable:Y=I}={})=>{h(s);const k=new AbortController;f.current[s]=k;try{m(s,!0),C(s);let d;return Y?d=await M(()=>e(k.signal),3,1e3,"api_call"):d=await v(()=>e(k.signal)),L&&await L(d),n&&!p&&x&&i({title:"Success",description:n,variant:"default"}),d}catch(d){if(d.name==="AbortError")return null;const g=q(d),w=se(d,E);if(R(s,{original:d,type:g.type,code:g.code,message:w,timestamp:new Date().toISOString()}),g.type==="auth"&&S)return p||i({variant:"destructive",title:"Authentication Required",description:w}),y(J("Landing")),null;throw!G&&D&&!p&&i({variant:"destructive",title:g.type==="rate_limit"?"Please slow down":"Error",description:w,duration:g.type==="rate_limit"?5e3:4e3}),A&&await A(d,g),d}finally{m(s,!1),delete f.current[s]}},[h,m,C,R,i,y,$,I,D,x,S,p]),P={list:r.useCallback((e,...s)=>c(()=>e.list(...s),{key:`${e.constructor.name||"entity"}_list`,errorContext:"loading data",retryable:!0}),[c]),filter:r.useCallback((e,s,...n)=>c(()=>e.filter(s,...n),{key:`${e.constructor.name||"entity"}_filter`,errorContext:"searching data",retryable:!0}),[c]),get:r.useCallback((e,s)=>c(()=>e.get(s),{key:`${e.constructor.name||"entity"}_get_${s}`,errorContext:"loading item",retryable:!0}),[c]),create:r.useCallback((e,s,n="Item created successfully")=>c(()=>e.create(s),{key:`${e.constructor.name||"entity"}_create`,successMessage:n,errorContext:"creating item",retryable:!1}),[c]),update:r.useCallback((e,s,n,E="Item updated successfully")=>c(()=>e.update(s,n),{key:`${e.constructor.name||"entity"}_update_${s}`,successMessage:E,errorContext:"updating item",retryable:!1}),[c]),delete:r.useCallback((e,s,n="Item deleted successfully")=>c(()=>e.delete(s),{key:`${e.constructor.name||"entity"}_delete_${s}`,successMessage:n,errorContext:"deleting item",retryable:!1}),[c])},U=r.useCallback((e,s={},n={})=>c(()=>e(s),{key:`function_${e.name||"call"}`,errorContext:"performing action",retryable:!0,...n}),[c]),B=r.useCallback((e="default")=>!!t[e],[t]),F=r.useCallback((e="default")=>l[e],[l]),j=r.useCallback((e="default")=>!!l[e],[l]),Q=r.useCallback(()=>Object.values(t).some(Boolean),[t]),V=r.useCallback(()=>Object.keys(l).length>0,[l]),W=r.useCallback(()=>u({}),[]),z=r.useCallback(()=>{Object.keys(f.current).forEach(h)},[h]);return{execute:c,...P,callFunction:U,isLoading:B,getError:F,hasError:j,isAnyLoading:Q,hasAnyError:V,setLoading:m,setError:R,clearError:C,clearAllErrors:W,cancelRequest:h,cancelAllRequests:z,loadingStates:t,errors:l}};function oe(a,t){const[o,l]=r.useState(a);return r.useEffect(()=>{const u=setTimeout(()=>{l(a)},t);return()=>{clearTimeout(u)}},[a,t]),o}export{re as S,ne as a,oe as u};
//# sourceMappingURL=useDebounce-ABn6640d.js.map
