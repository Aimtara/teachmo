import{b as y,G as b,f as j,r as m,j as e,S as v,n as f,J as w}from"./index-BPP-_OMN.js";function q(){const{data:s}=y(),n=(s==null?void 0:s.organizationId)??(s==null?void 0:s.districtId)??null;return b({queryKey:["tenant-sso-settings",n],enabled:!!n,queryFn:async()=>{var g,r,u;const a=await j(`
        query TenantSSOSettings($organizationId: uuid!) {
          enterprise_sso_settings(where: { organization_id: { _eq: $organizationId }, is_enabled: { _eq: true } }) {
            provider
          }
          tenant_settings(where: { district_id: { _eq: $organizationId }, school_id: { _is_null: true } }, limit: 1) {
            settings
          }
        }
      `),o=((g=a==null?void 0:a.enterprise_sso_settings)==null?void 0:g.map(c=>c.provider).filter(Boolean))??[];let l=!1;const d=((u=(r=a==null?void 0:a.tenant_settings)==null?void 0:r[0])==null?void 0:u.settings)??{};return d&&(typeof d.require_sso=="boolean"?l=d.require_sso:typeof d.requireSso=="boolean"&&(l=d.requireSso)),{providers:o,requireSso:l}}})}const p=w("login");function _(){const[s,n]=m.useState(""),[i,a]=m.useState(""),[o,l]=m.useState(null),[d,g]=m.useState(!1),{data:r}=q(),u=(r==null?void 0:r.requireSso)||!1,c=(r==null?void 0:r.providers)||[],h=async t=>{t.preventDefault(),l(null);try{await f.auth.signIn({email:s,password:i})}catch(x){p.error("Email login failed",x),l((x==null?void 0:x.message)||"Login failed")}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Sign in to Teachmo"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use your school account to continue"})]}),o&&e.jsx("p",{role:"alert",className:"text-red-600 text-sm text-center",children:o}),u&&c.length===1&&e.jsx(N,{provider:c[0],onError:t=>l((t==null?void 0:t.message)||"Login failed"),onStart:()=>g(!0)}),(!u||c.length!==1)&&e.jsx(v,{onError:t=>l((t==null?void 0:t.message)||"Login failed"),providers:c.length?c:null}),d&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Redirecting to your single sign-on providerâ€¦"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"bg-gray-50 px-2 text-gray-500",children:"or"})})]}),!u&&e.jsxs("form",{className:"mt-8 space-y-4",onSubmit:h,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,placeholder:"Email address",value:s,onChange:t=>n(t.target.value),className:"block w-full rounded-md border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,placeholder:"Password",value:i,onChange:t=>a(t.target.value),className:"block w-full rounded-md border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsx("button",{type:"submit",className:"w-full flex justify-center rounded-md bg-emerald-600 py-2 px-4 text-sm font-semibold text-white hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500",children:"Sign in"})]})]})})}function N({provider:s,onStart:n,onError:i}){return m.useEffect(()=>{async function a(){try{n==null||n(),await f.auth.signIn({provider:s,options:{redirectTo:`${window.location.origin}/auth/callback`}})}catch(o){p.error("SSO redirect failed",o),i==null||i(o)}}s&&a()},[i,n,s]),null}export{_ as default};
//# sourceMappingURL=Login-CdbZd0wA.js.map
