{"version":3,"file":"AdminTenantDomains-BPTEEAcO.js","sources":["../../src/pages/AdminTenantDomains.jsx"],"sourcesContent":["import { useMemo, useState } from 'react';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport { graphqlRequest } from '@/lib/graphql';\nimport { useTenantScope } from '@/hooks/useTenantScope';\nimport ProtectedRoute from '@/components/shared/ProtectedRoute';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\n\nexport default function AdminTenantDomains() {\n  const { data: scope } = useTenantScope();\n  const organizationId = scope?.organizationId ?? null;\n  const [newDomain, setNewDomain] = useState('');\n\n  const domainsQuery = useQuery({\n    queryKey: ['tenant-domains', organizationId],\n    enabled: Boolean(organizationId),\n    queryFn: async () => {\n      const query = `query TenantDomains($organizationId: uuid!) {\n        tenant_domains(where: { organization_id: { _eq: $organizationId } }, order_by: { domain: asc }) {\n          id\n          domain\n          is_primary\n          verified_at\n        }\n      }`;\n      const data = await graphqlRequest({ query, variables: { organizationId } });\n      return data?.tenant_domains ?? [];\n    },\n  });\n\n  const addDomainMutation = useMutation({\n    mutationFn: async () => {\n      if (!organizationId) throw new Error('Missing organization scope');\n      const mutation = `mutation AddTenantDomain($object: tenant_domains_insert_input!) {\n        insert_tenant_domains_one(object: $object) { id }\n      }`;\n      await graphqlRequest({\n        query: mutation,\n        variables: {\n          object: {\n            organization_id: organizationId,\n            domain: newDomain.trim().toLowerCase(),\n            is_primary: false,\n          },\n        },\n      });\n    },\n    onSuccess: () => {\n      setNewDomain('');\n      domainsQuery.refetch();\n    },\n  });\n\n  const setPrimaryMutation = useMutation({\n    mutationFn: async ({ id }) => {\n      const mutation = `mutation SetPrimaryDomain($organizationId: uuid!, $id: uuid!) {\n        update_tenant_domains(where: { organization_id: { _eq: $organizationId } }, _set: { is_primary: false }) {\n          affected_rows\n        }\n        update_tenant_domains_by_pk(pk_columns: { id: $id }, _set: { is_primary: true }) { id }\n      }`;\n      await graphqlRequest({ query: mutation, variables: { organizationId, id } });\n    },\n    onSuccess: () => domainsQuery.refetch(),\n  });\n\n  const removeDomainMutation = useMutation({\n    mutationFn: async ({ id }) => {\n      const mutation = `mutation RemoveTenantDomain($id: uuid!) {\n        delete_tenant_domains_by_pk(id: $id) { id }\n      }`;\n      await graphqlRequest({ query: mutation, variables: { id } });\n    },\n    onSuccess: () => domainsQuery.refetch(),\n  });\n\n  const domainRows = useMemo(() => domainsQuery.data ?? [], [domainsQuery.data]);\n\n  return (\n    <ProtectedRoute allowedRoles={['system_admin', 'district_admin', 'school_admin', 'admin']}>\n      <div className=\"p-6 space-y-6\">\n        <header className=\"space-y-2\">\n          <h1 className=\"text-2xl font-semibold\">Tenant Domains</h1>\n          <p className=\"text-sm text-muted-foreground\">Manage allowed email domains for single sign-on.</p>\n        </header>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Add Domain</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form\n              onSubmit={(event) => {\n                event.preventDefault();\n                if (!newDomain.trim()) return;\n                addDomainMutation.mutate();\n              }}\n              className=\"flex flex-col sm:flex-row gap-3\"\n            >\n              <Input\n                type=\"text\"\n                placeholder=\"example.com\"\n                value={newDomain}\n                onChange={(event) => setNewDomain(event.target.value)}\n              />\n              <Button type=\"submit\" variant=\"default\" disabled={addDomainMutation.isLoading || !newDomain.trim()}>\n                Add\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Domains</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Domain</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Primary</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {domainRows.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={4} className=\"text-sm text-muted-foreground\">\n                      No domains configured yet.\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  domainRows.map((domain) => (\n                    <TableRow key={domain.id}>\n                      <TableCell className=\"font-mono text-xs\">{domain.domain}</TableCell>\n                      <TableCell>{domain.verified_at ? 'Verified' : 'Pending'}</TableCell>\n                      <TableCell>{domain.is_primary ? 'Yes' : 'No'}</TableCell>\n                      <TableCell className=\"flex gap-2\">\n                        <Button\n                          variant=\"secondary\"\n                          size=\"sm\"\n                          onClick={() => setPrimaryMutation.mutate({ id: domain.id })}\n                          disabled={domain.is_primary}\n                        >\n                          Set primary\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeDomainMutation.mutate({ id: domain.id })}\n                        >\n                          Remove\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </ProtectedRoute>\n  );\n}\n"],"names":["AdminTenantDomains","scope","useTenantScope","organizationId","newDomain","setNewDomain","useState","domainsQuery","useQuery","data","graphqlRequest","addDomainMutation","useMutation","setPrimaryMutation","id","removeDomainMutation","domainRows","useMemo","jsx","ProtectedRoute","jsxs","Card","CardHeader","CardTitle","CardContent","event","Input","Button","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","domain"],"mappings":"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"}