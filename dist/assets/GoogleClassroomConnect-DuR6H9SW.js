import{c as A,e as _,r as o,j as e,C as I,i as D,k as B,o as F,B as g,R as C,a9 as v,Q as R}from"./index-CXW08ga6.js";import{U as b}from"./entities-CLCXHT4z.js";import"./messaging-cshogndc.js";import{B as $}from"./badge-Dl3t65au.js";import{A as O,a as T}from"./alert-KdgI_V-I.js";import{B as k}from"./book-open-Bot6lLRm.js";import{C as z}from"./circle-alert-CzGZOM4y.js";import{E as P}from"./external-link-Duz6MPfX.js";import{U as H}from"./users-CCMiawQ7.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],i=A("CircleCheckBig",M);async function J(a){try{const s=await fetch(`${_}/integrations/google/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return s.ok,s.json()}catch(s){throw s}}async function U(a){try{const s=await fetch(`${_}/integrations/google/sync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const j=s.status===404||s.status===501;throw new Error(`Google Sync request failed with status ${s.status}`)}return s.json()}catch(s){throw s}}const y=R("GoogleClassroomConnect");function se({user:a,onConnectionUpdate:s}){const[j,m]=o.useState(!1),[x,S]=o.useState(!1),[d,r]=o.useState(null),[p,u]=o.useState("disconnected"),[w,h]=o.useState(null),n=o.useRef(null),l=o.useRef(null);o.useEffect(()=>{a!=null&&a.google_classroom_connected&&(u("connected"),h(a.last_integration_sync))},[a]);const G=async()=>{m(!0),r(null);try{const{data:t}=await J({action:"authorize"});if(t.authUrl){const c=window.open(t.authUrl,"google-auth","width=500,height=600,scrollbars=yes,resizable=yes");n.current=setInterval(()=>{c.closed&&(n.current&&clearInterval(n.current),m(!1),L())},1e3),l.current=f=>{f.origin===window.location.origin&&(f.data.type==="google-auth-success"?(n.current&&clearInterval(n.current),c.close(),u("connected"),m(!1),r({type:"success",message:"Connected to Google Classroom successfully!"}),s&&s(),l.current&&window.removeEventListener("message",l.current)):f.data.type==="google-auth-error"&&(n.current&&clearInterval(n.current),c.close(),m(!1),r({type:"error",message:f.data.error||"Failed to connect to Google Classroom"}),l.current&&window.removeEventListener("message",l.current)))},window.addEventListener("message",l.current)}}catch(t){y.error("Connection error:",t),m(!1),r({type:"error",message:"Failed to initiate Google Classroom connection"})}},L=async()=>{try{const t=await b.me();t!=null&&t.google_classroom_connected&&(u("connected"),h(t.last_integration_sync),s&&s())}catch(t){y.error("Error checking connection status:",t)}},N=async(t="courses")=>{S(!0),r(null);try{const{data:c}=await U({action:`sync_${t}`,courseId:t==="assignments"?"all":void 0});c.success?(r({type:"success",message:`Successfully synced ${c.totalSynced||0} ${t}`}),h(new Date().toISOString()),s&&s()):r({type:"error",message:c.error||`Failed to sync ${t}`})}catch(c){y.error("Sync error:",c),r({type:"error",message:`Failed to sync ${t}. Please try again.`})}finally{S(!1)}},E=async()=>{if(window.confirm("Are you sure you want to disconnect Google Classroom? This will stop syncing your classes and assignments."))try{await b.updateMyUserData({google_classroom_connected:!1,google_classroom_token:null,google_classroom_refresh_token:null}),u("disconnected"),h(null),r({type:"success",message:"Disconnected from Google Classroom"}),s&&s()}catch(t){y.error("Disconnect error:",t),r({type:"error",message:"Failed to disconnect from Google Classroom"})}};return o.useEffect(()=>()=>{n.current&&clearInterval(n.current),l.current&&window.removeEventListener("message",l.current)},[]),e.jsxs(I,{className:"border-0 shadow-lg bg-white/90 backdrop-blur-sm",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-lg",children:"Google Classroom"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Sync your classes, assignments, and student data"})]})]}),e.jsx($,{className:p==="connected"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:p==="connected"?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),"Connected"]}):"Not Connected"})]})}),e.jsxs(F,{className:"space-y-4",children:[d&&e.jsxs(O,{className:d.type==="error"?"border-red-200 bg-red-50":"border-green-200 bg-green-50",children:[d.type==="error"?e.jsx(z,{className:"h-4 w-4 text-red-600"}):e.jsx(i,{className:"h-4 w-4 text-green-600"}),e.jsx(T,{className:d.type==="error"?"text-red-800":"text-green-800",children:d.message})]}),p==="disconnected"?e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Connect Google Classroom"}),e.jsx("p",{className:"text-gray-600 text-sm max-w-md mx-auto",children:"Connect your Google Classroom account to automatically sync your classes, assignments, and communicate with parents through Teachmo."})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-700",children:[e.jsx(i,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Sync classes and coursework"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-700",children:[e.jsx(i,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Connect with student parents"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-700",children:[e.jsx(i,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Automatic assignment updates"})]})]}),e.jsx(g,{onClick:G,disabled:j,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:j?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Connect Google Classroom"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Google Classroom Connected"}),w&&e.jsxs("p",{className:"text-sm text-green-700",children:["Last synced: ",new Date(w).toLocaleDateString()," at ",new Date(w).toLocaleTimeString()]})]})]}),e.jsx(g,{variant:"outline",size:"sm",onClick:E,children:"Disconnect"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},children:e.jsxs(g,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-center gap-2",onClick:()=>N("courses"),disabled:x,children:[e.jsx(k,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Sync Classes"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Update course list"})]})]})}),e.jsx(v.div,{whileHover:{scale:1.02},children:e.jsxs(g,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-center gap-2",onClick:()=>N("assignments"),disabled:x,children:[e.jsx(C,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Sync Assignments"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Update coursework"})]})]})}),e.jsx(v.div,{whileHover:{scale:1.02},children:e.jsxs(g,{variant:"outline",className:"w-full h-auto p-4 flex flex-col items-center gap-2",onClick:()=>N("guardians"),disabled:x,children:[e.jsx(H,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:"Link Parents"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Connect guardians"})]})]})})]}),x&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 py-2",children:[e.jsx(C,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Syncing data from Google Classroom..."})]})]})]})]})}export{se as G};
//# sourceMappingURL=GoogleClassroomConnect-DuR6H9SW.js.map
