import{U as d,au as S,av as v,aw as T,ax as _,ay as w,az as j,T as I,r as p,J as X,j as a,B as R}from"./index-BPP-_OMN.js";import"./entities-B5ABfrWT.js";import{l as O,a as A}from"./messaging-DUlHVuxN.js";import{T as C}from"./textarea-Be6YKw6o.js";import{e as L,a as Y}from"./endOfMonth-YkXIKlYF.js";function E(...e){return e.filter(Boolean).join(" ")}function D(e,n){const s=d(e),i=d(n),t=s.getTime()-i.getTime();return t<0?-1:t>0?1:t}function z(e){return S(e,Date.now())}function F(e,n){const s=d(e),i=d(n),t=s.getFullYear()-i.getFullYear(),f=s.getMonth()-i.getMonth();return t*12+f}function k(e){return n=>{const i=(e?Math[e]:Math.trunc)(n);return i===0?0:i}}function U(e,n){return+d(e)-+d(n)}function B(e){const n=d(e);return+L(n)==+Y(n)}function H(e,n){const s=d(e),i=d(n),t=D(s,i),f=Math.abs(F(s,i));let l;if(f<1)l=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-t*f);let r=D(s,i)===-t;B(d(e))&&f===1&&D(e,i)===1&&(r=!1),l=t*(f-Number(r))}return l===0?0:l}function J(e,n,s){const i=U(e,n)/1e3;return k(s==null?void 0:s.roundingMethod)(i)}function V(e,n,s){const i=T(),t=(s==null?void 0:s.locale)??i.locale??_,f=2520,l=D(e,n);if(isNaN(l))throw new RangeError("Invalid time value");const r=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:l});let u,x;l>0?(u=d(n),x=d(e)):(u=d(e),x=d(n));const y=J(x,u),M=(v(x)-v(u))/1e3,c=Math.round((y-M)/60);let g;if(c<2)return s!=null&&s.includeSeconds?y<5?t.formatDistance("lessThanXSeconds",5,r):y<10?t.formatDistance("lessThanXSeconds",10,r):y<20?t.formatDistance("lessThanXSeconds",20,r):y<40?t.formatDistance("halfAMinute",0,r):y<60?t.formatDistance("lessThanXMinutes",1,r):t.formatDistance("xMinutes",1,r):c===0?t.formatDistance("lessThanXMinutes",1,r):t.formatDistance("xMinutes",c,r);if(c<45)return t.formatDistance("xMinutes",c,r);if(c<90)return t.formatDistance("aboutXHours",1,r);if(c<w){const m=Math.round(c/60);return t.formatDistance("aboutXHours",m,r)}else{if(c<f)return t.formatDistance("xDays",1,r);if(c<j){const m=Math.round(c/w);return t.formatDistance("xDays",m,r)}else if(c<j*2)return g=Math.round(c/j),t.formatDistance("aboutXMonths",g,r)}if(g=H(x,u),g<12){const m=Math.round(c/j);return t.formatDistance("xMonths",m,r)}else{const m=g%12,o=Math.trunc(g/12);return m<3?t.formatDistance("aboutXYears",o,r):m<9?t.formatDistance("overXYears",o,r):t.formatDistance("almostXYears",o+1,r)}}function G(e,n){return V(e,z(e),n)}const b=X("MessagingRequests");function K({request:e,onApprove:n,onDeny:s,onReasonChange:i,isProcessing:t,reasonValue:f}){var r;const l=p.useMemo(()=>{if(!(e!=null&&e.created_at))return"just now";try{return G(new Date(e.created_at),{addSuffix:!0})}catch(u){return b.error("Invalid date in messaging request",u),e.created_at}},[e==null?void 0:e.created_at]);return a.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm space-y-3",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Requester"}),a.jsx("p",{className:"font-semibold text-gray-900",children:e.requester_user_id})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Target"}),a.jsx("p",{className:"font-semibold text-gray-900",children:e.target_user_id})]})]}),((r=e.metadata)==null?void 0:r.note)&&a.jsxs("div",{className:"rounded-md bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-900",children:[a.jsx("p",{className:"font-semibold",children:"Note from requester"}),a.jsx("p",{className:"whitespace-pre-wrap",children:e.metadata.note})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(C,{placeholder:"Optional reason (shared when denying)",value:f,onChange:u=>i(e.id,u.target.value),className:"min-h-[80px]"}),a.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[a.jsx(R,{variant:"outline",size:"sm",disabled:t,onClick:()=>s(e.id),children:t?"Saving…":"Deny"}),a.jsx(R,{size:"sm",disabled:t,onClick:()=>n(e.id),children:t?"Saving…":"Approve"})]}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Requested ",l]})]})]})}function q(){const e=I(),[n,s]=p.useState([]),[i,t]=p.useState(!0),[f,l]=p.useState(""),[r,u]=p.useState({}),[x,y]=p.useState({}),M=p.useCallback(async()=>{t(!0);try{const o=await O({status:"pending"});s(Array.isArray(o)?o:[]),l("")}catch(o){b.error("Failed to load messaging requests",o),l((o==null?void 0:o.message)??"Unable to load requests")}finally{t(!1)}},[]);p.useEffect(()=>{M()},[M]);const c=(o,N)=>{y(h=>({...h,[o]:N}))},g=async(o,N)=>{if(o){u(h=>({...h,[o]:!0}));try{await A({requestId:o,approve:N,reason:x[o]}),await M()}catch(h){b.error("Error saving messaging decision",h),l((h==null?void 0:h.message)??"Unable to save decision")}finally{u(h=>({...h,[o]:!1}))}}},m=(e==null?void 0:e.displayName)||(e==null?void 0:e.email)||"there";return a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("header",{className:"space-y-1",children:[a.jsxs("p",{className:"text-sm text-gray-500",children:["Hi ",m,","]}),a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Messaging requests"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Approve or deny requests addressed to you."})]}),f&&a.jsx("div",{className:"rounded-md border border-red-100 bg-red-50 p-3 text-sm text-red-700",role:"alert",children:f}),i?a.jsx("p",{className:"text-gray-600",children:"Loading requests…"}):n.length===0?a.jsxs("div",{className:"rounded-lg border border-gray-100 bg-white p-6 shadow-sm",children:[a.jsx("p",{className:"font-semibold text-gray-900",children:"No pending requests"}),a.jsx("p",{className:"text-sm text-gray-600",children:"You'll see new requests here when parents ask to message you."})]}):a.jsx("div",{className:E("grid gap-4",n.length>1?"md:grid-cols-2":""),children:n.map(o=>a.jsx(K,{request:o,onApprove:()=>g(o.id,!0),onDeny:()=>g(o.id,!1),onReasonChange:c,isProcessing:r[o.id],reasonValue:x[o.id]??""},o.id))})]})}export{q as default};
//# sourceMappingURL=MessagingRequests-BUWNTFLm.js.map
