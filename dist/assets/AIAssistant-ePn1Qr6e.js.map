{"version":3,"file":"AIAssistant-ePn1Qr6e.js","sources":["../../node_modules/lucide-react/dist/esm/icons/bot.js","../../node_modules/lucide-react/dist/esm/icons/lightbulb.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../node_modules/lucide-react/dist/esm/icons/thumbs-down.js","../../node_modules/lucide-react/dist/esm/icons/thumbs-up.js","../../node_modules/idb-keyval/dist/index.js","../../src/offline/OfflineStorageManager.ts","../../src/api/ai/log.ts","../../src/api/ai/resolveModel.ts","../../src/observability/aiSafety.ts","../../src/hooks/useTenantFeatureFlags.ts","../../src/components/ai/EnhancedAIAssistant.jsx","../../src/pages/AIAssistant.jsx"],"sourcesContent":["/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 8V4H8\", key: \"hb8ula\" }],\n  [\"rect\", { width: \"16\", height: \"12\", x: \"4\", y: \"8\", rx: \"2\", key: \"enze0r\" }],\n  [\"path\", { d: \"M2 14h2\", key: \"vft8re\" }],\n  [\"path\", { d: \"M20 14h2\", key: \"4cs60a\" }],\n  [\"path\", { d: \"M15 13v2\", key: \"1xurst\" }],\n  [\"path\", { d: \"M9 13v2\", key: \"rq6x2g\" }]\n];\nconst Bot = createLucideIcon(\"Bot\", __iconNode);\n\nexport { __iconNode, Bot as default };\n//# sourceMappingURL=bot.js.map\n","/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5\",\n      key: \"1gvzjb\"\n    }\n  ],\n  [\"path\", { d: \"M9 18h6\", key: \"x1upvd\" }],\n  [\"path\", { d: \"M10 22h4\", key: \"ceow96\" }]\n];\nconst Lightbulb = createLucideIcon(\"Lightbulb\", __iconNode);\n\nexport { __iconNode, Lightbulb as default };\n//# sourceMappingURL=lightbulb.js.map\n","/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n];\nconst Send = createLucideIcon(\"Send\", __iconNode);\n\nexport { __iconNode, Send as default };\n//# sourceMappingURL=send.js.map\n","/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M17 14V2\", key: \"8ymqnk\" }],\n  [\n    \"path\",\n    {\n      d: \"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z\",\n      key: \"m61m77\"\n    }\n  ]\n];\nconst ThumbsDown = createLucideIcon(\"ThumbsDown\", __iconNode);\n\nexport { __iconNode, ThumbsDown as default };\n//# sourceMappingURL=thumbs-down.js.map\n","/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M7 10v12\", key: \"1qc93n\" }],\n  [\n    \"path\",\n    {\n      d: \"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z\",\n      key: \"emmmcr\"\n    }\n  ]\n];\nconst ThumbsUp = createLucideIcon(\"ThumbsUp\", __iconNode);\n\nexport { __iconNode, ThumbsUp as default };\n//# sourceMappingURL=thumbs-up.js.map\n","function promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        // @ts-ignore - file size hacks\n        request.oncomplete = request.onsuccess = () => resolve(request.result);\n        // @ts-ignore - file size hacks\n        request.onabort = request.onerror = () => reject(request.error);\n    });\n}\nfunction createStore(dbName, storeName) {\n    let dbp;\n    const getDB = () => {\n        if (dbp)\n            return dbp;\n        const request = indexedDB.open(dbName);\n        request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n        dbp = promisifyRequest(request);\n        dbp.then((db) => {\n            // It seems like Safari sometimes likes to just close the connection.\n            // It's supposed to fire this event when that happens. Let's hope it does!\n            db.onclose = () => (dbp = undefined);\n        }, () => { });\n        return dbp;\n    };\n    return (txMode, callback) => getDB().then((db) => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n    if (!defaultGetStoreFunc) {\n        defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n    }\n    return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.put(value, key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic â€“ if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        entries.forEach((entry) => store.put(entry[1], entry[0]));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => Promise.all(keys.map((key) => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => \n    // Need to create the promise manually.\n    // If I try to chain promises, the transaction closes in browsers\n    // that use a promise polyfill (IE10/11).\n    new Promise((resolve, reject) => {\n        store.get(key).onsuccess = function () {\n            try {\n                store.put(updater(this.result), key);\n                resolve(promisifyRequest(store.transaction));\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n    }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.delete(key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        keys.forEach((key) => store.delete(key));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.clear();\n        return promisifyRequest(store.transaction);\n    });\n}\nfunction eachCursor(store, callback) {\n    store.openCursor().onsuccess = function () {\n        if (!this.result)\n            return;\n        callback(this.result);\n        this.result.continue();\n    };\n    return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAllKeys) {\n            return promisifyRequest(store.getAllKeys());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.key)).then(() => items);\n    });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAll) {\n            return promisifyRequest(store.getAll());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.value)).then(() => items);\n    });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        // (although, hopefully we'll get a simpler path some day)\n        if (store.getAll && store.getAllKeys) {\n            return Promise.all([\n                promisifyRequest(store.getAllKeys()),\n                promisifyRequest(store.getAll()),\n            ]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n        }\n        const items = [];\n        return customStore('readonly', (store) => eachCursor(store, (cursor) => items.push([cursor.key, cursor.value])).then(() => items));\n    });\n}\n\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };\n","import { createStore, get, set } from 'idb-keyval';\n\nexport type OfflineRequest = {\n  id: string;\n  url: string;\n  method: string;\n  headers: Record<string, string>;\n  body?: string;\n  createdAt: string;\n};\n\nconst store = createStore('teachmo-offline', 'outbox');\nconst QUEUE_KEY = 'queue';\n\nasync function readQueue(): Promise<OfflineRequest[]> {\n  return (await get(QUEUE_KEY, store)) || [];\n}\n\nasync function writeQueue(queue: OfflineRequest[]) {\n  await set(QUEUE_KEY, queue, store);\n}\n\nexport async function enqueueRequest(request: Omit<OfflineRequest, 'id' | 'createdAt'>) {\n  const queue = await readQueue();\n  const id = typeof crypto !== 'undefined' && crypto.randomUUID ? crypto.randomUUID() : `${Date.now()}-${Math.random()}`;\n  const entry: OfflineRequest = {\n    ...request,\n    id,\n    createdAt: new Date().toISOString()\n  };\n  queue.push(entry);\n  await writeQueue(queue);\n  return entry;\n}\n\nexport async function removeRequest(id: string) {\n  const queue = await readQueue();\n  const next = queue.filter((item) => item.id !== id);\n  await writeQueue(next);\n}\n\nexport async function listQueuedRequests(): Promise<OfflineRequest[]> {\n  const queue = await readQueue();\n  return queue.sort((a, b) => a.createdAt.localeCompare(b.createdAt));\n}\n\nexport async function clearQueue() {\n  await writeQueue([]);\n}\n","import { enqueueRequest } from '@/offline/OfflineStorageManager';\nimport { API_BASE_URL } from '@/config/api';\nimport { fetchAiJson, getAiHeaders } from './client';\n\nexport type TenantScope = {\n  organizationId: string;\n  schoolId?: string | null;\n};\n\nexport type AiLogPayload = {\n  prompt: string;\n  response: string;\n  tokenPrompt?: number;\n  tokenResponse?: number;\n  tokenTotal?: number;\n  safetyRiskScore?: number;\n  safetyFlags?: string[];\n  model?: string;\n  metadata?: Record<string, unknown>;\n  childId?: string | null;\n  inputs?: Record<string, unknown>;\n  outputs?: Record<string, unknown>;\n  promptId?: string | null;\n  promptVersionId?: string | null;\n  userId?: string | null;\n  reviewRequired?: boolean;\n  reviewReason?: string | null;\n  costUsd?: number | null;\n  latencyMs?: number | null;\n};\n\nexport async function logAiInteraction(_tenant: TenantScope, payload: AiLogPayload) {\n  try {\n    return await fetchAiJson('/ai/log', {\n      method: 'POST',\n      body: JSON.stringify(payload),\n    });\n  } catch (err) {\n    if (typeof navigator !== 'undefined' && navigator.onLine === false) {\n      const headers = await getAiHeaders();\n      await enqueueRequest({\n        url: `${API_BASE_URL}/ai/log`,\n        method: 'POST',\n        headers,\n        body: JSON.stringify(payload)\n      });\n      return { queued: true };\n    }\n    throw err;\n  }\n}\n","import { fetchAiJson } from './client';\n\nexport type ResolveModelResponse = {\n  allowed: boolean;\n  model: string;\n  reason?: string;\n  estimatedCost?: number;\n  budgetExceeded?: boolean;\n  policy?: {\n    defaultModel?: string | null;\n    fallbackModel?: string | null;\n  } | null;\n  budget?: {\n    monthlyLimitUsd?: number | null;\n    spentUsd?: number | null;\n    fallbackPolicy?: string | null;\n    resetAt?: string | null;\n  } | null;\n  prompt?: {\n    id: string;\n    name?: string | null;\n    version_id?: string | null;\n    content?: string | null;\n    variables?: Record<string, unknown>;\n  } | null;\n};\n\ntype ResolveModelPayload = {\n  preferredModel?: string;\n  estimatedTokens?: number;\n  featureFlags?: Record<string, boolean>;\n  promptId?: string | null;\n};\n\nexport async function resolveAiModel(payload: ResolveModelPayload): Promise<ResolveModelResponse> {\n  return fetchAiJson('/ai/resolve-model', {\n    method: 'POST',\n    body: JSON.stringify(payload),\n  });\n}\n","const CONFIDENCE_MARKERS = ['definitely', 'certainly', 'guaranteed', 'always', 'never', 'proven', '100%'];\n\nfunction countMatches(text: string, regex: RegExp) {\n  const match = text.match(regex);\n  return match ? match.length : 0;\n}\n\nexport function estimateTokens(text: string) {\n  if (!text) return 0;\n  return Math.max(1, Math.ceil(text.trim().length / 4));\n}\n\nexport function scoreHallucinationRisk(text: string) {\n  if (!text) return { score: 0, flags: [] as string[] };\n  const flags: string[] = [];\n  const numericClaims = /\\d+[%]?\\b/g.test(text);\n  const confidenceHits = CONFIDENCE_MARKERS.some((marker) => text.toLowerCase().includes(marker));\n  const hasSources = /(http|https|source|according to|study|report)/i.test(text);\n  const namedEntities = countMatches(text, /\\b[A-Z][a-z]+\\b/g);\n\n  let score = 0.1;\n  if (numericClaims) {\n    score += 0.2;\n    flags.push('numeric_claims');\n  }\n  if (confidenceHits) {\n    score += 0.2;\n    flags.push('high_confidence_language');\n  }\n  if (!hasSources) {\n    score += 0.2;\n    flags.push('missing_sources');\n  }\n  if (namedEntities >= 6) {\n    score += 0.2;\n    flags.push('many_named_entities');\n  }\n\n  score = Math.min(1, Math.max(0, score));\n  return { score, flags };\n}\n","import { useQuery } from '@tanstack/react-query';\nimport { useUserData } from '@nhost/react';\nimport { graphqlRequest } from '@/lib/graphql';\n\ntype FeatureFlags = Record<string, boolean>;\n\ntype TenantProfile = {\n  organization_id: string | null;\n  school_id: string | null;\n};\n\nexport function useTenantFeatureFlags() {\n  const authUser = useUserData();\n  const userId = authUser?.id ?? null;\n\n  return useQuery({\n    queryKey: ['tenant-feature-flags', userId],\n    enabled: Boolean(userId),\n    queryFn: async (): Promise<FeatureFlags> => {\n      if (!userId) return {};\n      const profileQuery = `query MyProfile($userId: uuid!) {\n        profiles(where: { user_id: { _eq: $userId } }, limit: 1) {\n          organization_id\n          school_id\n        }\n      }`;\n      const profileData = await graphqlRequest({ query: profileQuery, variables: { userId } });\n      const profile: TenantProfile | undefined = profileData?.profiles?.[0];\n      const organizationId = profile?.organization_id ?? null;\n      const schoolId = profile?.school_id ?? null;\n\n      if (!organizationId) return {};\n\n      const flagsQuery = `query TenantFeatureFlags($orgId: uuid!, $schoolId: uuid) {\n        feature_flags(\n          where: {\n            organization_id: { _eq: $orgId },\n            _or: [\n              { school_id: { _eq: $schoolId } },\n              { school_id: { _is_null: true } }\n            ]\n          }\n        ) {\n          key\n          enabled\n        }\n      }`;\n      const flagData = await graphqlRequest({\n        query: flagsQuery,\n        variables: { orgId: organizationId, schoolId },\n      });\n      const flags = (flagData?.feature_flags ?? []).reduce((acc: FeatureFlags, flag: { key: string; enabled: boolean }) => {\n        acc[flag.key] = Boolean(flag.enabled);\n        return acc;\n      }, {} as FeatureFlags);\n      return flags;\n    },\n  });\n}\n","import React, { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { Bot, Send, Loader2, AlertCircle, Lightbulb, BookOpen, Users, Sparkles, RefreshCw, ThumbsUp, ThumbsDown } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { invokeAdvancedAI } from '@/api/functions';\nimport { logAiInteraction } from '@/api/ai/log';\nimport { resolveAiModel } from '@/api/ai/resolveModel';\nimport { useTenant } from '@/contexts/TenantContext';\nimport { estimateTokens, scoreHallucinationRisk } from '@/observability/aiSafety';\nimport { logAnalyticsEvent } from '@/observability/telemetry';\nimport { useTenantFeatureFlags } from '@/hooks/useTenantFeatureFlags';\n\nconst AICapabilityBadge = ({ icon: Icon, label, description }) => (\n  <div className=\"flex items-center gap-2 p-2 bg-blue-50 rounded-lg border border-blue-100\">\n    <Icon className=\"w-4 h-4 text-blue-600\" />\n    <div>\n      <p className=\"text-sm font-medium text-blue-900\">{label}</p>\n      <p className=\"text-xs text-blue-700\">{description}</p>\n    </div>\n  </div>\n);\n\nconst AIMessage = ({ message, isUser, onFeedback, timestamp, confidence, sources }) => {\n  const [feedback, setFeedback] = useState(null);\n\n  const handleFeedback = (type) => {\n    setFeedback(type);\n    onFeedback?.(message.id, type);\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={`flex gap-3 mb-4 ${isUser ? 'justify-end' : 'justify-start'}`}\n    >\n      {!isUser && (\n        <div className=\"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0\">\n          <Bot className=\"w-4 h-4 text-white\" />\n        </div>\n      )}\n      \n      <div className={`max-w-[80%] ${isUser ? 'order-first' : ''}`}>\n        <div className={`rounded-lg p-3 ${\n          isUser \n            ? 'bg-blue-600 text-white ml-auto' \n            : 'bg-gray-100 text-gray-900'\n        }`}>\n          <div className=\"prose prose-sm max-w-none\">\n            {typeof message.content === 'string' ? (\n              <p className=\"whitespace-pre-wrap\">{message.content}</p>\n            ) : (\n              message.content\n            )}\n          </div>\n          \n          {/* AI-specific enhancements */}\n          {!isUser && (\n            <div className=\"mt-3 space-y-2\">\n              {/* Confidence indicator */}\n              {confidence && (\n                <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                  <div className=\"flex items-center gap-1\">\n                    <div className={`w-2 h-2 rounded-full ${\n                      confidence > 0.8 ? 'bg-green-500' : \n                      confidence > 0.6 ? 'bg-yellow-500' : 'bg-red-500'\n                    }`} />\n                    <span>\n                      {confidence > 0.8 ? 'High confidence' : \n                       confidence > 0.6 ? 'Medium confidence' : 'Lower confidence'}\n                    </span>\n                  </div>\n                </div>\n              )}\n              \n              {/* Sources */}\n              {sources && sources.length > 0 && (\n                <div className=\"text-xs text-gray-600\">\n                  <p className=\"font-medium mb-1\">Sources:</p>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {sources.map((source, idx) => (\n                      <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                        {source}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Feedback buttons */}\n              <div className=\"flex items-center gap-2 pt-2 border-t border-gray-200\">\n                <span className=\"text-xs text-gray-500\">Was this helpful?</span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => handleFeedback('positive')}\n                  className={`h-6 px-2 ${feedback === 'positive' ? 'bg-green-100 text-green-700' : ''}`}\n                >\n                  <ThumbsUp className=\"w-3 h-3\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => handleFeedback('negative')}\n                  className={`h-6 px-2 ${feedback === 'negative' ? 'bg-red-100 text-red-700' : ''}`}\n                >\n                  <ThumbsDown className=\"w-3 h-3\" />\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n        \n        {timestamp && (\n          <p className=\"text-xs text-gray-500 mt-1 px-1\">\n            {new Date(timestamp).toLocaleTimeString()}\n          </p>\n        )}\n      </div>\n      \n      {isUser && (\n        <div className=\"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0\">\n          <Users className=\"w-4 h-4 text-gray-600\" />\n        </div>\n      )}\n    </motion.div>\n  );\n};\n\nconst AIThinkingIndicator = ({ stage }) => {\n  const stages = [\n    { key: 'analyzing', label: 'Analyzing your question...', icon: Sparkles },\n    { key: 'researching', label: 'Researching relevant information...', icon: BookOpen },\n    { key: 'formulating', label: 'Formulating response...', icon: Lightbulb },\n  ];\n\n  const currentStage = stages.find(s => s.key === stage) || stages[0];\n  const Icon = currentStage.icon;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      className=\"flex items-center gap-3 p-3 bg-blue-50 rounded-lg border border-blue-100\"\n    >\n      <Icon className=\"w-4 h-4 text-blue-600 animate-pulse\" />\n      <span className=\"text-sm text-blue-800\">{currentStage.label}</span>\n    </motion.div>\n  );\n};\n\nexport default function EnhancedAIAssistant({ user, children }) {\n  const tenant = useTenant();\n  const featureFlagsQuery = useTenantFeatureFlags();\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [thinkingStage, setThinkingStage] = useState(null);\n  const [showCapabilities, setShowCapabilities] = useState(!messages.length);\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, isLoading]);\n\n  // Initialize with welcome message\n  useEffect(() => {\n    if (messages.length === 0) {\n      const welcomeMessage = {\n        id: 'welcome',\n        content: `Hi! I'm your AI assistant. I'm here to help with parenting questions, activity suggestions, and homework support. I provide general guidance based on research and best practices, but I'm not a substitute for professional medical or therapeutic advice.\n\nWhat would you like help with today?`,\n        isUser: false,\n        timestamp: new Date().toISOString(),\n        confidence: 0.95\n      };\n      setMessages([welcomeMessage]);\n    }\n  }, []);\n\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() || isLoading) return;\n\n    const userMessage = {\n      id: Date.now().toString(),\n      content: inputValue,\n      isUser: true,\n      timestamp: new Date().toISOString()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInputValue('');\n    setIsLoading(true);\n    setShowCapabilities(false);\n\n    try {\n      const startTime = Date.now();\n      // Simulate thinking stages\n      setThinkingStage('analyzing');\n      await new Promise(resolve => setTimeout(resolve, 800));\n      \n      setThinkingStage('researching');\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      setThinkingStage('formulating');\n      await new Promise(resolve => setTimeout(resolve, 600));\n\n      const tokenPrompt = estimateTokens(inputValue);\n      const featureFlags = featureFlagsQuery.data ?? {};\n      let resolvedModel = { allowed: true, model: 'gpt-4o-mini', reason: 'default' };\n      try {\n        resolvedModel = await resolveAiModel({\n          preferredModel: tokenPrompt > 300 ? 'gpt-4o' : 'gpt-4o-mini',\n          estimatedTokens: tokenPrompt,\n          featureFlags,\n        });\n      } catch (error) {\n        console.warn('AI model resolution failed, using default model.', error);\n      }\n\n      if (!resolvedModel.allowed) {\n        setMessages(prev => [\n          ...prev,\n          {\n            id: Date.now().toString() + '_blocked',\n            content: \"Your organization's AI budget has been reached. Please try again later or contact an administrator.\",\n            isUser: false,\n            timestamp: new Date().toISOString(),\n            confidence: 0.1\n          }\n        ]);\n        setIsLoading(false);\n        setThinkingStage(null);\n        return;\n      }\n\n      const context = {\n        user_type: user?.user_type,\n        children: children || [],\n        conversation_history: messages.slice(-5) // Last 5 messages for context\n      };\n\n      const aiResponse = await invokeAdvancedAI({\n        query: inputValue,\n        context,\n        model: resolvedModel.model\n      });\n\n      const aiMessage = {\n        id: Date.now().toString() + '_ai',\n        content: aiResponse.response,\n        isUser: false,\n        timestamp: new Date().toISOString(),\n        confidence: aiResponse.confidence || 0.8,\n        sources: aiResponse.sources || []\n      };\n\n      setMessages(prev => [...prev, aiMessage]);\n\n      if (tenant.organizationId) {\n        const tokenResponse = estimateTokens(aiResponse.response);\n        const tokenTotal = tokenPrompt + tokenResponse;\n        const risk = scoreHallucinationRisk(aiResponse.response);\n        const childId = Array.isArray(children) && children.length\n          ? String(children[0].id || children[0].childId || '')\n          : null;\n        const reviewRequired = risk.score >= 0.7;\n        const reviewReason = reviewRequired\n          ? `Risk score ${risk.score}${risk.flags.length ? ` (${risk.flags.join(', ')})` : ''}`\n          : null;\n\n        Promise.allSettled([\n          logAiInteraction(\n            { organizationId: tenant.organizationId, schoolId: tenant.schoolId },\n            {\n              prompt: inputValue,\n              response: aiResponse.response,\n              tokenPrompt,\n              tokenResponse,\n              tokenTotal,\n              safetyRiskScore: risk.score,\n              safetyFlags: risk.flags,\n              model: aiResponse.model || aiResponse.provider || resolvedModel.model || 'unknown',\n              metadata: {\n                confidence: aiResponse.confidence,\n                sources: aiResponse.sources,\n                modelReason: resolvedModel.reason,\n                budgetExceeded: resolvedModel.budgetExceeded\n              },\n              childId,\n              inputs: { query: inputValue, context },\n              outputs: { response: aiResponse.response, confidence: aiResponse.confidence, sources: aiResponse.sources },\n              reviewRequired,\n              reviewReason,\n              latencyMs: Date.now() - startTime\n            }\n          ),\n          logAnalyticsEvent(\n            { organizationId: tenant.organizationId, schoolId: tenant.schoolId },\n            {\n              eventName: 'ai_call',\n              metadata: {\n                tokenPrompt,\n                tokenResponse,\n                tokenTotal,\n                safetyRiskScore: risk.score,\n                safetyFlags: risk.flags,\n                model: aiResponse.model || aiResponse.provider || resolvedModel.model || 'unknown',\n                reviewRequired\n              }\n            }\n          )\n        ]).catch(() => {});\n      }\n    } catch (error) {\n      console.error('AI Assistant error:', error);\n      const errorMessage = {\n        id: Date.now().toString() + '_error',\n        content: \"I'm sorry, I encountered an error processing your request. Please try again, or rephrase your question.\",\n        isUser: false,\n        timestamp: new Date().toISOString(),\n        confidence: 0.1\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n      setThinkingStage(null);\n    }\n  };\n\n  const handleFeedback = async (messageId, feedbackType) => {\n    // Here you could send feedback to your analytics system\n    console.log(`Feedback for message ${messageId}: ${feedbackType}`);\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const startNewConversation = () => {\n    setMessages([]);\n    setShowCapabilities(true);\n  };\n\n  return (\n    <div className=\"flex flex-col h-full max-h-[80vh]\">\n      {/* Header */}\n      <CardHeader className=\"border-b\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\n              <Bot className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-lg\">AI Assistant</CardTitle>\n              <p className=\"text-sm text-gray-600\">Your personal parenting guide</p>\n            </div>\n          </div>\n          <Button variant=\"outline\" size=\"sm\" onClick={startNewConversation}>\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\n            New Chat\n          </Button>\n        </div>\n      </CardHeader>\n\n      {/* Capabilities Display */}\n      <AnimatePresence>\n        {showCapabilities && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"p-4 border-b bg-gray-50\"\n          >\n            <h3 className=\"font-medium text-sm mb-3 text-gray-800\">I can help you with:</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              <AICapabilityBadge\n                icon={Users}\n                label=\"Parenting Guidance\"\n                description=\"Age-appropriate strategies and tips\"\n              />\n              <AICapabilityBadge\n                icon={BookOpen}\n                label=\"Homework Support\"\n                description=\"Learning strategies and explanations\"\n              />\n              <AICapabilityBadge\n                icon={Sparkles}\n                label=\"Activity Suggestions\"\n                description=\"Personalized recommendations\"\n              />\n              <AICapabilityBadge\n                icon={Lightbulb}\n                label=\"Development Insights\"\n                description=\"Understanding your child's growth\"\n              />\n            </div>\n            \n            <div className=\"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded-lg\">\n              <div className=\"flex items-start gap-2\">\n                <AlertCircle className=\"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0\" />\n                <p className=\"text-xs text-yellow-800\">\n                  <strong>Important:</strong> I provide general guidance based on research and cannot replace professional medical, therapeutic, or educational advice. Always consult qualified professionals for specific concerns.\n                </p>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Messages */}\n      <CardContent className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.map((message) => (\n          <AIMessage\n            key={message.id}\n            message={message}\n            isUser={message.isUser}\n            onFeedback={handleFeedback}\n            timestamp={message.timestamp}\n            confidence={message.confidence}\n            sources={message.sources}\n          />\n        ))}\n        \n        {isLoading && thinkingStage && (\n          <AIThinkingIndicator stage={thinkingStage} />\n        )}\n        \n        <div ref={messagesEndRef} />\n      </CardContent>\n\n      {/* Input */}\n      <div className=\"border-t p-4\">\n        <div className=\"flex gap-2\">\n          <Textarea\n            value={inputValue}\n            onChange={(e) => setInputValue(e.target.value)}\n            onKeyPress={handleKeyPress}\n            placeholder=\"Ask me anything about parenting, activities, or homework help...\"\n            className=\"resize-none\"\n            rows={2}\n            disabled={isLoading}\n          />\n          <Button\n            onClick={handleSendMessage}\n            disabled={!inputValue.trim() || isLoading}\n            className=\"px-4\"\n          >\n            {isLoading ? (\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n            ) : (\n              <Send className=\"w-4 h-4\" />\n            )}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport { useUserData } from '@nhost/react';\nimport EnhancedAIAssistant from '@/components/ai/EnhancedAIAssistant';\nimport { Card } from '@/components/ui/card';\n\nexport default function AIAssistant() {\n  const user = useUserData();\n  return (\n    <div className=\"p-6\">\n      <Card className=\"max-w-5xl mx-auto\">\n        <EnhancedAIAssistant user={user} />\n      </Card>\n    </div>\n  );\n}\n"],"names":["__iconNode","Bot","createLucideIcon","Lightbulb","Send","ThumbsDown","ThumbsUp","promisifyRequest","request","resolve","reject","createStore","dbName","storeName","dbp","getDB","db","txMode","callback","defaultGetStoreFunc","defaultGetStore","get","key","customStore","store","set","value","QUEUE_KEY","readQueue","writeQueue","queue","enqueueRequest","id","entry","logAiInteraction","_tenant","payload","fetchAiJson","err","headers","getAiHeaders","API_BASE_URL","resolveAiModel","CONFIDENCE_MARKERS","countMatches","text","regex","match","estimateTokens","scoreHallucinationRisk","flags","numericClaims","confidenceHits","marker","hasSources","namedEntities","score","useTenantFeatureFlags","authUser","useUserData","userId","useQuery","profileData","graphqlRequest","profile","_a","organizationId","schoolId","flagData","acc","flag","AICapabilityBadge","Icon","label","description","jsxs","jsx","AIMessage","message","isUser","onFeedback","timestamp","confidence","sources","feedback","setFeedback","useState","handleFeedback","type","motion","source","idx","Badge","Button","Users","AIThinkingIndicator","stage","stages","Sparkles","BookOpen","currentStage","s","EnhancedAIAssistant","user","children","tenant","useTenant","featureFlagsQuery","messages","setMessages","inputValue","setInputValue","isLoading","setIsLoading","thinkingStage","setThinkingStage","showCapabilities","setShowCapabilities","messagesEndRef","useRef","scrollToBottom","useEffect","welcomeMessage","handleSendMessage","userMessage","prev","startTime","tokenPrompt","featureFlags","resolvedModel","error","context","aiResponse","invokeAdvancedAI","aiMessage","tokenResponse","tokenTotal","risk","childId","reviewRequired","reviewReason","logAnalyticsEvent","errorMessage","messageId","feedbackType","handleKeyPress","e","startNewConversation","CardHeader","CardTitle","RefreshCw","AnimatePresence","AlertCircle","CardContent","Textarea","Loader2","AIAssistant","Card"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}