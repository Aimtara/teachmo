{"version":3,"file":"messagingModeration-DxGxbPDO.js","sources":["../../src/api/adapters/modules/messagingModeration.ts"],"sourcesContent":["import { nhost } from '@/lib/nhostClient';\n\ntype FunctionEnvelope<T> = { data?: T } | T;\n\ntype ReportResponse = FunctionEnvelope<{ ok: boolean; reportId?: string | null }>;\ntype GenericResponse = FunctionEnvelope<{ ok: boolean }>;\n\nexport async function reportMessage(input: { threadId: string; messageId?: string; reason: string; detail?: string }) {\n  const { res, error } = await nhost.functions.call('report-message', input);\n  if (error) throw error;\n  const payload = (res as ReportResponse)?.data ?? (res as ReportResponse);\n  return payload;\n}\n\nexport async function triageReport(input: {\n  reportId: string;\n  status: 'triaged' | 'resolved' | 'dismissed';\n  severity: 'low' | 'medium' | 'high';\n  adminNote?: string;\n  action?: 'none' | 'close_thread' | 'block_user' | 'lift_block';\n  blockedUserId?: string;\n}) {\n  const { res, error } = await nhost.functions.call('triage-message-report', input);\n  if (error) throw error;\n  const payload = (res as GenericResponse)?.data ?? (res as GenericResponse);\n  return payload;\n}\n\nexport async function blockUser(input: { schoolId: string; blockedUserId: string; reason?: string }) {\n  const { res, error } = await nhost.functions.call('block-user-from-messaging', input);\n  if (error) throw error;\n  const payload = (res as GenericResponse)?.data ?? (res as GenericResponse);\n  return payload;\n}\n\nexport async function liftBlock(input: { blockId: string }) {\n  const { res, error } = await nhost.functions.call('lift-messaging-block', input);\n  if (error) throw error;\n  const payload = (res as GenericResponse)?.data ?? (res as GenericResponse);\n  return payload;\n}\n\nexport async function listReports(input: { status?: string } = {}) {\n  const { res, error } = await nhost.functions.call('get-open-message-reports', input);\n  if (error) throw error;\n  const payload = (res as FunctionEnvelope<{ reports?: unknown[] }>)?.data ?? (res as { reports?: unknown[] });\n  return Array.isArray(payload?.reports) ? payload.reports : [];\n}\n\nexport async function listBlocks() {\n  const { res, error } = await nhost.functions.call('list-message-blocks', {});\n  if (error) throw error;\n  const payload = (res as FunctionEnvelope<{ blocks?: unknown[] }>)?.data ?? (res as { blocks?: unknown[] });\n  return Array.isArray(payload?.blocks) ? payload.blocks : [];\n}\n\nexport async function exportTranscript(input: { threadId: string }) {\n  const { res, error } = await nhost.functions.call('export-thread-transcript', input);\n  if (error) throw error;\n  const payload = (res as FunctionEnvelope<unknown>)?.data ?? res;\n  return payload;\n}\n"],"names":["triageReport","input","res","error","nhost","liftBlock","listReports","payload","listBlocks"],"mappings":"wCAcA,eAAsBA,EAAaC,EAOhC,CACD,KAAM,CAAE,IAAAC,EAAK,MAAAC,GAAU,MAAMC,EAAM,UAAU,KAAK,wBAAyBH,CAAK,EAChF,GAAIE,EAAO,MAAMA,EAEjB,OADiBD,GAAA,YAAAA,EAAyB,OAASA,CAErD,CASA,eAAsBG,EAAUJ,EAA4B,CAC1D,KAAM,CAAE,IAAAC,EAAK,MAAAC,GAAU,MAAMC,EAAM,UAAU,KAAK,uBAAwBH,CAAK,EAC/E,GAAIE,EAAO,MAAMA,EAEjB,OADiBD,GAAA,YAAAA,EAAyB,OAASA,CAErD,CAEA,eAAsBI,EAAYL,EAA6B,GAAI,CACjE,KAAM,CAAE,IAAAC,EAAK,MAAAC,GAAU,MAAMC,EAAM,UAAU,KAAK,2BAA4BH,CAAK,EACnF,GAAIE,EAAO,MAAMA,EACjB,MAAMI,GAAWL,GAAA,YAAAA,EAAmD,OAASA,EAC7E,OAAO,MAAM,QAAQK,GAAA,YAAAA,EAAS,OAAO,EAAIA,EAAQ,QAAU,CAAA,CAC7D,CAEA,eAAsBC,GAAa,CACjC,KAAM,CAAE,IAAAN,EAAK,MAAAC,GAAU,MAAMC,EAAM,UAAU,KAAK,sBAAuB,EAAE,EAC3E,GAAID,EAAO,MAAMA,EACjB,MAAMI,GAAWL,GAAA,YAAAA,EAAkD,OAASA,EAC5E,OAAO,MAAM,QAAQK,GAAA,YAAAA,EAAS,MAAM,EAAIA,EAAQ,OAAS,CAAA,CAC3D"}