{"version":3,"file":"AdminIntegrationHealth-C0iUJRp2.js","sources":["../../src/pages/AdminIntegrationHealth.jsx"],"sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\nimport { API_BASE_URL } from '@/config/api';\n\nasync function fetchJson(path, options = {}) {\n  const res = await fetch(`${API_BASE_URL}${path}`, {\n    headers: { 'Content-Type': 'application/json', ...(options.headers || {}) },\n    ...options,\n  });\n\n  const payload = await res.json().catch(() => ({}));\n  if (!res.ok) {\n    throw new Error(payload?.error || 'Request failed');\n  }\n  return payload;\n}\n\nfunction formatDate(value) {\n  if (!value) return '—';\n  try {\n    return new Date(value).toLocaleString();\n  } catch {\n    return value;\n  }\n}\n\nexport default function AdminIntegrationHealth() {\n  const [alerts, setAlerts] = useState([]);\n  const [selectedAlertId, setSelectedAlertId] = useState('');\n  const [selectedRun, setSelectedRun] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [runLoading, setRunLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n\n  const selectedAlert = useMemo(\n    () => alerts.find((alert) => alert.id === selectedAlertId),\n    [alerts, selectedAlertId]\n  );\n\n  const loadAlerts = useCallback(async () => {\n    setLoading(true);\n    setError('');\n    setSuccess('');\n    try {\n      const data = await fetchJson('/integrations/roster/alerts');\n      setAlerts(data);\n      if (data.length && !selectedAlertId) {\n        setSelectedAlertId(data[0].id);\n      }\n    } catch (err) {\n      setError(err?.message || 'Failed to load alerts.');\n    } finally {\n      setLoading(false);\n    }\n  }, [selectedAlertId]);\n\n  const loadRun = useCallback(async (runId) => {\n    if (!runId) return;\n    setRunLoading(true);\n    setError('');\n    try {\n      const data = await fetchJson(`/integrations/roster/runs/${runId}`);\n      setSelectedRun(data);\n    } catch (err) {\n      setError(err?.message || 'Failed to load run.');\n    } finally {\n      setRunLoading(false);\n    }\n  }, []);\n\n  const handleRetry = useCallback(async () => {\n    if (!selectedAlert?.runId) return;\n    setRunLoading(true);\n    setError('');\n    setSuccess('');\n    try {\n      const data = await fetchJson(`/integrations/roster/runs/${selectedAlert.runId}/retry`, { method: 'POST' });\n      setSelectedRun(data);\n      setSuccess('Retry started.');\n      await loadAlerts();\n    } catch (err) {\n      setError(err?.message || 'Retry failed.');\n    } finally {\n      setRunLoading(false);\n    }\n  }, [selectedAlert, loadAlerts]);\n\n  useEffect(() => {\n    loadAlerts();\n  }, [loadAlerts]);\n\n  useEffect(() => {\n    if (selectedAlert?.runId) {\n      loadRun(selectedAlert.runId);\n    } else {\n      setSelectedRun(null);\n    }\n  }, [selectedAlert, loadRun]);\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 space-y-6\">\n      <header className=\"space-y-2\">\n        <h1 className=\"text-2xl font-semibold\">Integration Sync Health</h1>\n        <p className=\"text-sm text-gray-600\">Monitor SIS/LMS sync alerts, diagnostics, and remediation actions.</p>\n      </header>\n\n      {error && <div className=\"bg-red-50 text-red-700 border border-red-200 p-3 rounded\">{error}</div>}\n      {success && <div className=\"bg-green-50 text-green-700 border border-green-200 p-3 rounded\">{success}</div>}\n\n      <div className=\"grid md:grid-cols-[1.2fr_1.8fr] gap-6\">\n        <section className=\"border rounded-lg p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-lg font-medium\">Active alerts</h2>\n            <button\n              type=\"button\"\n              onClick={loadAlerts}\n              className=\"text-sm text-blue-600 hover:underline disabled:opacity-50\"\n              disabled={loading}\n            >\n              {loading ? 'Refreshing…' : 'Refresh'}\n            </button>\n          </div>\n          {alerts.length === 0 && !loading && (\n            <p className=\"text-sm text-gray-500\">No alerts right now.</p>\n          )}\n          <ul className=\"space-y-2\">\n            {alerts.map((alert) => (\n              <li key={alert.id}>\n                <button\n                  type=\"button\"\n                  onClick={() => setSelectedAlertId(alert.id)}\n                  className={`w-full text-left border rounded p-3 space-y-1 ${\n                    selectedAlertId === alert.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200'\n                  }`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium text-sm\">{alert.message}</span>\n                    <span className=\"text-xs uppercase tracking-wide text-gray-500\">{alert.severity}</span>\n                  </div>\n                  <div className=\"text-xs text-gray-500\">Created {formatDate(alert.createdAt)}</div>\n                  {alert.runId && <div className=\"text-xs text-gray-500\">Run ID: {alert.runId}</div>}\n                </button>\n              </li>\n            ))}\n          </ul>\n        </section>\n\n        <section className=\"border rounded-lg p-4 space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-lg font-medium\">Diagnostics</h2>\n              <p className=\"text-sm text-gray-600\">Review failed sync details and retry.</p>\n            </div>\n            <button\n              type=\"button\"\n              onClick={handleRetry}\n              className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50\"\n              disabled={!selectedAlert?.runId || runLoading}\n            >\n              {runLoading ? 'Retrying…' : 'Retry sync'}\n            </button>\n          </div>\n\n          {!selectedAlert && <p className=\"text-sm text-gray-500\">Select an alert to view details.</p>}\n\n          {selectedAlert && (\n            <div className=\"space-y-3\">\n              <div className=\"bg-gray-50 border border-gray-200 rounded p-3 text-sm\">\n                <div className=\"font-medium\">Alert details</div>\n                <div className=\"text-gray-600\">Severity: {selectedAlert.severity}</div>\n                <div className=\"text-gray-600\">Source ID: {selectedAlert.sourceId || '—'}</div>\n                <div className=\"text-gray-600\">Run ID: {selectedAlert.runId || '—'}</div>\n              </div>\n\n              <div className=\"bg-white border border-gray-200 rounded p-3 space-y-2 text-sm\">\n                <div className=\"font-medium\">Run diagnostics</div>\n                {selectedRun ? (\n                  <>\n                    <div className=\"text-gray-600\">Status: {selectedRun.status}</div>\n                    <div className=\"text-gray-600\">Started: {formatDate(selectedRun.startedAt)}</div>\n                    <div className=\"text-gray-600\">Finished: {formatDate(selectedRun.finishedAt)}</div>\n                    <div className=\"text-gray-600\">Invalid: {selectedRun.stats?.invalid ?? 0}</div>\n                    <div className=\"text-gray-600\">Deactivated: {selectedRun.stats?.deactivated ?? 0}</div>\n                    <div className=\"text-gray-600\">Triggered by: {selectedRun.triggeredBy}</div>\n                    {selectedRun.errors?.length > 0 && (\n                      <div className=\"text-red-600 text-xs\">\n                        {selectedRun.errors.map((err, index) => (\n                          <div key={`${err.message}-${index}`}>• {err.message}</div>\n                        ))}\n                      </div>\n                    )}\n                    {selectedRun.diagnostics && (\n                      <pre className=\"text-xs bg-slate-50 border border-slate-200 rounded p-2 overflow-auto\">\n                        {JSON.stringify(selectedRun.diagnostics, null, 2)}\n                      </pre>\n                    )}\n                  </>\n                ) : (\n                  <p className=\"text-sm text-gray-500\">Loading run details…</p>\n                )}\n              </div>\n            </div>\n          )}\n        </section>\n      </div>\n    </div>\n  );\n}\n"],"names":["fetchJson","path","options","res","API_BASE_URL","payload","formatDate","value","AdminIntegrationHealth","alerts","setAlerts","useState","selectedAlertId","setSelectedAlertId","selectedRun","setSelectedRun","loading","setLoading","runLoading","setRunLoading","error","setError","success","setSuccess","selectedAlert","useMemo","alert","loadAlerts","useCallback","data","err","loadRun","runId","handleRetry","useEffect","jsxs","jsx","Fragment","_a","_b","_c","index"],"mappings":"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"}