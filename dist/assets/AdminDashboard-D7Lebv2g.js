import{Y as _,l as S,r as d,G as q,j as e,L as C,Z as D,f as A}from"./index-BPP-_OMN.js";import{b as O}from"./onboarding-C5j826Dm.js";const F=()=>{const s=_();return{log:(a,n={})=>{s.organizationId&&S({organizationId:s.organizationId,schoolId:s.schoolId},{eventName:a,metadata:n}).catch(()=>{})}}};function E(){var m,h,p,x,N,b,j,f;const[s,t]=d.useState({organizationName:"",schoolName:""}),[a,n]=d.useState({userId:"",fullName:"",role:"teacher",organizationId:"",schoolId:""}),[c,g]=d.useState(""),{log:u}=F(),{data:r,isLoading:l}=q({queryKey:["admin-dashboard-metrics"],queryFn:async()=>A({query:`query AdminDashboardMetrics {
        organizations_aggregate {
          aggregate {
            count
          }
        }
        schools_aggregate {
          aggregate {
            count
          }
        }
        profiles_aggregate {
          aggregate {
            count
          }
        }
        classrooms_aggregate {
          aggregate {
            count
          }
        }
      }`}),staleTime:1e3*60*5}),I=async o=>{var v,z;o.preventDefault();const y=await O({organizationName:s.organizationName,schoolName:s.schoolName});u("organization_bootstrap",{organizationName:s.organizationName,schoolName:s.schoolName,organizationId:(v=y.organization)==null?void 0:v.id}),g(`Created/updated organization ${(z=y.organization)==null?void 0:z.name}`)},w=async o=>{o.preventDefault(),await D({user_id:a.userId,full_name:a.fullName,app_role:a.role,organization_id:a.organizationId||null,school_id:a.schoolId||null}),u("admin_assign_role",{userId:a.userId,role:a.role,organizationId:a.organizationId||null,schoolId:a.schoolId||null}),g("User role saved")};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Admin dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Manage organizations, schools, and roles."})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(i,{label:"Organizations",value:l?"—":(h=(m=r==null?void 0:r.organizations_aggregate)==null?void 0:m.aggregate)==null?void 0:h.count}),e.jsx(i,{label:"Schools",value:l?"—":(x=(p=r==null?void 0:r.schools_aggregate)==null?void 0:p.aggregate)==null?void 0:x.count}),e.jsx(i,{label:"Profiles",value:l?"—":(b=(N=r==null?void 0:r.profiles_aggregate)==null?void 0:N.aggregate)==null?void 0:b.count}),e.jsx(i,{label:"Classrooms",value:l?"—":(f=(j=r==null?void 0:r.classrooms_aggregate)==null?void 0:j.aggregate)==null?void 0:f.count})]}),e.jsxs("form",{onSubmit:I,className:"bg-white rounded shadow p-4 space-y-3",children:[e.jsx("h2",{className:"font-medium",children:"Create organization & school"}),e.jsx("input",{placeholder:"Organization name",value:s.organizationName,onChange:o=>t({...s,organizationName:o.target.value}),className:"w-full border rounded px-3 py-2",required:!0}),e.jsx("input",{placeholder:"School name",value:s.schoolName,onChange:o=>t({...s,schoolName:o.target.value}),className:"w-full border rounded px-3 py-2",required:!0}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Create"})]}),e.jsxs("form",{onSubmit:w,className:"bg-white rounded shadow p-4 space-y-3",children:[e.jsx("h2",{className:"font-medium",children:"Assign user role"}),e.jsx("input",{placeholder:"User ID",value:a.userId,onChange:o=>n({...a,userId:o.target.value}),className:"w-full border rounded px-3 py-2",required:!0}),e.jsx("input",{placeholder:"Full name",value:a.fullName,onChange:o=>n({...a,fullName:o.target.value}),className:"w-full border rounded px-3 py-2",required:!0}),e.jsxs("select",{value:a.role,onChange:o=>n({...a,role:o.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"parent",children:"Parent"}),e.jsx("option",{value:"teacher",children:"Teacher"}),e.jsx("option",{value:"partner",children:"Partner"}),e.jsx("option",{value:"system_admin",children:"System admin"}),e.jsx("option",{value:"school_admin",children:"School admin"}),e.jsx("option",{value:"district_admin",children:"District admin"})]}),e.jsx("input",{placeholder:"Organization ID",value:a.organizationId,onChange:o=>n({...a,organizationId:o.target.value}),className:"w-full border rounded px-3 py-2"}),e.jsx("input",{placeholder:"School ID",value:a.schoolId,onChange:o=>n({...a,schoolId:o.target.value}),className:"w-full border rounded px-3 py-2"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Save role"})]}),c&&e.jsx("p",{className:"text-green-700 text-sm",children:c}),e.jsxs("section",{className:"bg-white rounded shadow p-4 space-y-2",children:[e.jsx("h2",{className:"font-medium",children:"Pilot tools"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Generate and review weekly parent briefs on demand."}),e.jsx(C,{to:"/admin/weekly-briefs",className:"inline-flex items-center text-sm text-blue-700 hover:underline",children:"Open Weekly Briefs tool"})]}),e.jsxs("section",{className:"bg-white rounded shadow p-4 space-y-2",children:[e.jsx("h2",{className:"font-medium",children:"Audit logs"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Audit log reporting is migrating to Nhost. Enable the audit log feature flag once the data pipeline is ready."})]})]})}const i=({label:s,value:t})=>e.jsxs("div",{className:"border rounded p-4 bg-white shadow",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s}),e.jsx("p",{className:"text-3xl font-semibold",children:t??"—"})]});export{E as default};
//# sourceMappingURL=AdminDashboard-D7Lebv2g.js.map
