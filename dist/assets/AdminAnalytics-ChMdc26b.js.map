{"version":3,"file":"AdminAnalytics-ChMdc26b.js","sources":["../../src/pages/AdminAnalytics.jsx"],"sourcesContent":["import { useMemo, useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { graphql } from '@/lib/graphql';\nimport { useTenantScope } from '@/hooks/useTenantScope';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { API_BASE_URL } from '@/config/api';\nimport { nhost } from '@/lib/nhostClient';\n\nfunction toDateOnly(isoString) {\n  if (!isoString) return null;\n  return isoString.slice(0, 10);\n}\n\nfunction downloadText(filename, text, mime = 'text/plain') {\n  const blob = new Blob([text], { type: mime });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n\nfunction csvEscape(value) {\n  const s = String(value ?? '');\n  if (/[\\n\\r,\\\"]/g.test(s)) return `\"${s.replaceAll('\"', '\"\"')}\"`;\n  return s;\n}\n\nexport default function AdminAnalytics() {\n  const { data: scope } = useTenantScope();\n  const [from, setFrom] = useState(() => {\n    const d = new Date();\n    d.setDate(d.getDate() - 14);\n    return d.toISOString().slice(0, 10);\n  });\n  const [to, setTo] = useState(() => new Date().toISOString().slice(0, 10));\n  const [eventName, setEventName] = useState('all');\n  const [actorRole, setActorRole] = useState('all');\n  const [drillEventName, setDrillEventName] = useState(null);\n\n  const headersQuery = useQuery({\n    queryKey: ['analytics-ai-token'],\n    queryFn: async () => {\n      const token = await nhost.auth.getAccessToken();\n      return {\n        'Content-Type': 'application/json',\n        ...(token ? { Authorization: `Bearer ${token}` } : {}),\n      };\n    },\n  });\n\n  const aiUsageQuery = useQuery({\n    queryKey: ['analytics-ai-usage-summary'],\n    enabled: Boolean(headersQuery.data),\n    queryFn: async () => {\n      const response = await fetch(`${API_BASE_URL}/admin/ai/usage-summary`, { headers: headersQuery.data });\n      if (!response.ok) throw new Error('Failed to load AI usage summary');\n      return response.json();\n    },\n  });\n\n  const rollupWhere = useMemo(() => {\n    const where = {\n      day: { _gte: from, _lte: to },\n    };\n\n    // Tenant scope:\n    // - district_id is always included when present\n    // - school_id optional\n    if (scope?.districtId) where.district_id = { _eq: scope.districtId };\n    if (scope?.schoolId) where.school_id = { _eq: scope.schoolId };\n    if (eventName !== 'all') where.event_name = { _eq: eventName };\n\n    return where;\n  }, [from, to, scope?.districtId, scope?.schoolId, eventName]);\n\n  const rollupsQuery = useQuery({\n    queryKey: ['analytics-rollups', rollupWhere],\n    enabled: Boolean(scope?.districtId),\n    queryFn: async () => {\n      const data = await graphql(\n        `query Rollups($where: analytics_event_rollups_daily_bool_exp!) {\n          analytics_event_rollups_daily(\n            where: $where,\n            order_by: [{ day: desc }, { event_count: desc }],\n            limit: 500\n          ) {\n            day\n            event_name\n            district_id\n            school_id\n            event_count\n          }\n        }`,\n        { where: rollupWhere }\n      );\n      return data?.analytics_event_rollups_daily ?? [];\n    },\n  });\n\n  const drillWhere = useMemo(() => {\n    if (!drillEventName) return null;\n\n    const where = {\n      event_ts: { _gte: `${from}T00:00:00.000Z`, _lte: `${to}T23:59:59.999Z` },\n      event_name: { _eq: drillEventName },\n    };\n    if (scope?.districtId) where.district_id = { _eq: scope.districtId };\n    if (scope?.schoolId) where.school_id = { _eq: scope.schoolId };\n    if (actorRole !== 'all') where.metadata = { _contains: { actor_role: actorRole } };\n\n    return where;\n  }, [drillEventName, from, to, scope?.districtId, scope?.schoolId, actorRole]);\n\n  const drillQuery = useQuery({\n    queryKey: ['analytics-drill', drillWhere],\n    enabled: Boolean(drillWhere),\n    queryFn: async () => {\n      const data = await graphql(\n        `query Drill($where: analytics_events_bool_exp!) {\n          analytics_events(\n            where: $where,\n            order_by: { event_ts: desc },\n            limit: 200\n          ) {\n            id\n            event_ts\n            event_name\n            actor_user_id\n            entity_type\n            entity_id\n            metadata\n          }\n        }`,\n        { where: drillWhere }\n      );\n      return data?.analytics_events ?? [];\n    },\n  });\n\n  const uniqueEventNames = useMemo(() => {\n    const s = new Set();\n    for (const r of rollupsQuery.data ?? []) s.add(r.event_name);\n    return Array.from(s).sort();\n  }, [rollupsQuery.data]);\n\n  const exportRollupsCsv = () => {\n    const rows = rollupsQuery.data ?? [];\n    const header = ['day', 'event_name', 'district_id', 'school_id', 'event_count'];\n    const lines = [header.join(',')];\n    for (const r of rows) {\n      lines.push([\n        csvEscape(r.day),\n        csvEscape(r.event_name),\n        csvEscape(r.district_id ?? ''),\n        csvEscape(r.school_id ?? ''),\n        csvEscape(r.event_count ?? 0),\n      ].join(','));\n    }\n    downloadText(`teachmo_analytics_rollups_${from}_${to}.csv`, lines.join('\\n'), 'text/csv');\n  };\n\n  const exportDrillCsv = () => {\n    const rows = drillQuery.data ?? [];\n    const header = ['event_ts', 'event_name', 'actor_user_id', 'entity_type', 'entity_id', 'metadata'];\n    const lines = [header.join(',')];\n    for (const r of rows) {\n      lines.push([\n        csvEscape(r.event_ts),\n        csvEscape(r.event_name),\n        csvEscape(r.actor_user_id ?? ''),\n        csvEscape(r.entity_type ?? ''),\n        csvEscape(r.entity_id ?? ''),\n        csvEscape(JSON.stringify(r.metadata ?? {})),\n      ].join(','));\n    }\n    downloadText(`teachmo_analytics_events_${drillEventName}_${from}_${to}.csv`, lines.join('\\n'), 'text/csv');\n  };\n\n  const exportPdf = () => {\n    // Lightweight, dependency-free PDF via the browser print dialog.\n    const html = `\n      <html>\n        <head>\n          <title>Teachmo Analytics Export</title>\n          <style>\n            body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }\n            h1 { font-size: 18px; margin: 0 0 8px; }\n            h2 { font-size: 14px; margin: 18px 0 8px; }\n            table { width: 100%; border-collapse: collapse; }\n            th, td { border: 1px solid #ddd; padding: 6px 8px; font-size: 12px; }\n            th { text-align: left; background: #f6f6f6; }\n            .meta { color: #555; font-size: 12px; margin-bottom: 8px; }\n          </style>\n        </head>\n        <body>\n          <h1>Teachmo Analytics Export</h1>\n          <div class=\"meta\">Range: ${from} → ${to}</div>\n          <h2>Rollups (daily)</h2>\n          <table>\n            <thead>\n              <tr><th>Day</th><th>Event</th><th>District</th><th>School</th><th>Count</th></tr>\n            </thead>\n            <tbody>\n              ${(rollupsQuery.data ?? [])\n                .map(\n                  (r) =>\n                    `<tr><td>${r.day}</td><td>${r.event_name}</td><td>${r.district_id ?? ''}</td><td>${r.school_id ?? ''}</td><td>${r.event_count ?? 0}</td></tr>`\n                )\n                .join('')}\n            </tbody>\n          </table>\n          ${drillEventName ? `\n            <h2>Drilldown: ${drillEventName}</h2>\n            <table>\n              <thead>\n                <tr><th>Time</th><th>User</th><th>Entity</th><th>Metadata</th></tr>\n              </thead>\n              <tbody>\n                ${(drillQuery.data ?? [])\n                  .map(\n                    (r) =>\n                      `<tr><td>${new Date(r.event_ts).toLocaleString()}</td><td>${r.actor_user_id ?? ''}</td><td>${(r.entity_type ?? '') + (r.entity_id ? ':' + r.entity_id : '')}</td><td><pre style=\"margin:0; white-space: pre-wrap;\">${JSON.stringify(r.metadata ?? {}, null, 2)}</pre></td></tr>`\n                  )\n                  .join('')}\n              </tbody>\n            </table>\n          ` : ''}\n        </body>\n      </html>\n    `;\n\n    const win = window.open('', '_blank');\n    if (!win) return;\n    win.document.open();\n    win.document.write(html);\n    win.document.close();\n    win.focus();\n    win.print();\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Analytics</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Tenant-scoped rollups and event drilldowns (event_ts + metadata). Export to CSV or PDF.\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button variant=\"secondary\" onClick={exportPdf} disabled={rollupsQuery.isLoading}>\n            Export PDF\n          </Button>\n          <Button onClick={exportRollupsCsv} disabled={rollupsQuery.isLoading}>\n            Export Rollups CSV\n          </Button>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Filters</CardTitle>\n        </CardHeader>\n        <CardContent className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\n          <div>\n            <div className=\"text-xs text-muted-foreground mb-1\">From</div>\n            <Input type=\"date\" value={from} onChange={(e) => setFrom(toDateOnly(e.target.value))} />\n          </div>\n          <div>\n            <div className=\"text-xs text-muted-foreground mb-1\">To</div>\n            <Input type=\"date\" value={to} onChange={(e) => setTo(toDateOnly(e.target.value))} />\n          </div>\n          <div>\n            <div className=\"text-xs text-muted-foreground mb-1\">Event</div>\n            <Select value={eventName} onValueChange={setEventName}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"All events\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All events</SelectItem>\n                {uniqueEventNames.map((e) => (\n                  <SelectItem key={e} value={e}>{e}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div>\n            <div className=\"text-xs text-muted-foreground mb-1\">Actor role (drilldown)</div>\n            <Select value={actorRole} onValueChange={setActorRole}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"All roles\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All roles</SelectItem>\n                {['parent', 'teacher', 'school_admin', 'district_admin', 'system_admin'].map((r) => (\n                  <SelectItem key={r} value={r}>{r}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between\">\n          <CardTitle>Daily rollups</CardTitle>\n          <div className=\"text-xs text-muted-foreground\">\n            {scope?.districtId ? `District: ${scope.districtId}${scope.schoolId ? ` • School: ${scope.schoolId}` : ''}` : 'Loading tenant scope…'}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {rollupsQuery.isLoading ? (\n            <div className=\"text-sm text-muted-foreground\">Loading rollups…</div>\n          ) : rollupsQuery.data?.length ? (\n            <div className=\"overflow-auto\">\n              <table className=\"min-w-full text-sm\">\n                <thead>\n                  <tr className=\"text-left border-b\">\n                    <th className=\"p-2\">Day</th>\n                    <th className=\"p-2\">Event</th>\n                    <th className=\"p-2\">School</th>\n                    <th className=\"p-2\">Count</th>\n                    <th className=\"p-2\"></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rollupsQuery.data.map((r) => (\n                    <tr key={`${r.day}-${r.event_name}-${r.school_id ?? 'district'}`} className=\"border-b hover:bg-muted/30\">\n                      <td className=\"p-2 whitespace-nowrap\">{r.day}</td>\n                      <td className=\"p-2\">{r.event_name}</td>\n                      <td className=\"p-2 font-mono text-xs\">{r.school_id ?? '—'}</td>\n                      <td className=\"p-2 font-semibold\">{r.event_count}</td>\n                      <td className=\"p-2\">\n                        <Button size=\"sm\" variant=\"secondary\" onClick={() => setDrillEventName(r.event_name)}>\n                          Drill down\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <div className=\"text-sm text-muted-foreground\">No events in this range yet.</div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>AI Usage Summary</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3 text-sm\">\n          {aiUsageQuery.isLoading ? (\n            <div className=\"text-muted-foreground\">Loading AI usage…</div>\n          ) : aiUsageQuery.data?.byModel?.length ? (\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-muted-foreground\">\n                <span>Total calls</span>\n                <span>{aiUsageQuery.data?.totals?.calls ?? 0}</span>\n              </div>\n              <div className=\"flex justify-between text-muted-foreground\">\n                <span>Estimated spend</span>\n                <span>${Number(aiUsageQuery.data?.totals?.cost_usd || 0).toFixed(2)}</span>\n              </div>\n              <div className=\"overflow-auto\">\n                <table className=\"min-w-full text-sm\">\n                  <thead>\n                    <tr className=\"text-left border-b\">\n                      <th className=\"p-2\">Model</th>\n                      <th className=\"p-2\">Calls</th>\n                      <th className=\"p-2\">Tokens</th>\n                      <th className=\"p-2\">Cost</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {aiUsageQuery.data.byModel.map((row) => (\n                      <tr key={row.model} className=\"border-b\">\n                        <td className=\"p-2 font-mono text-xs\">{row.model || '—'}</td>\n                        <td className=\"p-2\">{row.calls}</td>\n                        <td className=\"p-2\">{row.tokens ?? 0}</td>\n                        <td className=\"p-2\">${Number(row.cost_usd || 0).toFixed(2)}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-muted-foreground\">No AI usage recorded yet.</div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between\">\n          <CardTitle>Drilldown {drillEventName ? `• ${drillEventName}` : ''}</CardTitle>\n          <div className=\"flex gap-2\">\n            <Button variant=\"secondary\" onClick={() => setDrillEventName(null)} disabled={!drillEventName}>\n              Clear\n            </Button>\n            <Button onClick={exportDrillCsv} disabled={!drillEventName || drillQuery.isLoading}>\n              Export Events CSV\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {!drillEventName ? (\n            <div className=\"text-sm text-muted-foreground\">Select an event in rollups to drill down.</div>\n          ) : drillQuery.isLoading ? (\n            <div className=\"text-sm text-muted-foreground\">Loading events…</div>\n          ) : drillQuery.data?.length ? (\n            <div className=\"overflow-auto\">\n              <table className=\"min-w-full text-sm\">\n                <thead>\n                  <tr className=\"text-left border-b\">\n                    <th className=\"p-2\">Time</th>\n                    <th className=\"p-2\">User</th>\n                    <th className=\"p-2\">Entity</th>\n                    <th className=\"p-2\">Metadata</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {drillQuery.data.map((e) => (\n                    <tr key={e.id} className=\"border-b\">\n                      <td className=\"p-2 whitespace-nowrap\">{new Date(e.event_ts).toLocaleString()}</td>\n                      <td className=\"p-2 font-mono text-xs\">{e.actor_user_id ?? '—'}</td>\n                      <td className=\"p-2 font-mono text-xs\">{(e.entity_type ?? '') + (e.entity_id ? `:${e.entity_id}` : '')}</td>\n                      <td className=\"p-2\">\n                        <pre className=\"text-xs whitespace-pre-wrap max-w-[720px]\">{JSON.stringify(e.metadata ?? {}, null, 2)}</pre>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <div className=\"text-sm text-muted-foreground\">No matching events.</div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":["toDateOnly","isoString","downloadText","filename","text","mime","blob","url","a","csvEscape","value","s","AdminAnalytics","scope","useTenantScope","from","setFrom","useState","d","to","setTo","eventName","setEventName","actorRole","setActorRole","drillEventName","setDrillEventName","headersQuery","useQuery","token","nhost","aiUsageQuery","response","API_BASE_URL","rollupWhere","useMemo","where","rollupsQuery","data","graphql","drillWhere","drillQuery","uniqueEventNames","r","exportRollupsCsv","rows","lines","exportDrillCsv","exportPdf","html","win","jsxs","jsx","Button","Card","CardHeader","CardTitle","CardContent","Input","e","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","_a","_c","_b","_e","_d","_g","_f","row","_h"],"mappings":"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"}