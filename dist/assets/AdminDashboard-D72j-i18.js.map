{"version":3,"file":"AdminDashboard-D72j-i18.js","sources":["../../src/utils/useTelemetry.ts","../../src/pages/AdminDashboard.jsx"],"sourcesContent":["import { useTenant } from '@/contexts/TenantContext';\nimport { logAnalyticsEvent } from '@/observability/telemetry';\n\nexport const useTelemetry = () => {\n  const tenant = useTenant();\n  const log = (event: string, metadata: Record<string, unknown> = {}) => {\n    if (!tenant.organizationId) return;\n    logAnalyticsEvent(\n      { organizationId: tenant.organizationId, schoolId: tenant.schoolId },\n      { eventName: event, metadata }\n    ).catch(() => {});\n  };\n\n  return { log };\n};\n","import { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useQuery } from '@tanstack/react-query';\nimport { bootstrapOrganization } from '@/domains/onboarding';\nimport { createProfile } from '@/domains/auth';\nimport { graphqlRequest } from '@/lib/graphql';\nimport { useTelemetry } from '@/utils/useTelemetry';\n\nexport default function AdminDashboard() {\n  const [orgForm, setOrgForm] = useState({ organizationName: '', schoolName: '' });\n  const [userForm, setUserForm] = useState({ userId: '', fullName: '', role: 'teacher', organizationId: '', schoolId: '' });\n  const [message, setMessage] = useState('');\n  const { log } = useTelemetry();\n  const { data: metrics, isLoading: metricsLoading } = useQuery({\n    queryKey: ['admin-dashboard-metrics'],\n    queryFn: async () => {\n      const query = `query AdminDashboardMetrics {\n        organizations_aggregate {\n          aggregate {\n            count\n          }\n        }\n        schools_aggregate {\n          aggregate {\n            count\n          }\n        }\n        profiles_aggregate {\n          aggregate {\n            count\n          }\n        }\n        classrooms_aggregate {\n          aggregate {\n            count\n          }\n        }\n      }`;\n\n      return graphqlRequest({ query });\n    },\n    staleTime: 1000 * 60 * 5\n  });\n\n  const handleOrgSubmit = async (evt) => {\n    evt.preventDefault();\n    const data = await bootstrapOrganization({\n      organizationName: orgForm.organizationName,\n      schoolName: orgForm.schoolName\n    });\n    log('organization_bootstrap', {\n      organizationName: orgForm.organizationName,\n      schoolName: orgForm.schoolName,\n      organizationId: data.organization?.id\n    });\n    setMessage(`Created/updated organization ${data.organization?.name}`);\n  };\n\n  const handleUserSubmit = async (evt) => {\n    evt.preventDefault();\n    await createProfile({\n      user_id: userForm.userId,\n      full_name: userForm.fullName,\n      app_role: userForm.role,\n      organization_id: userForm.organizationId || null,\n      school_id: userForm.schoolId || null\n    });\n    log('admin_assign_role', {\n      userId: userForm.userId,\n      role: userForm.role,\n      organizationId: userForm.organizationId || null,\n      schoolId: userForm.schoolId || null\n    });\n    setMessage('User role saved');\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <header>\n        <h1 className=\"text-3xl font-semibold\">Admin dashboard</h1>\n        <p className=\"text-gray-600\">Manage organizations, schools, and roles.</p>\n      </header>\n\n      <section className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Stat\n          label=\"Organizations\"\n          value={metricsLoading ? '—' : metrics?.organizations_aggregate?.aggregate?.count}\n        />\n        <Stat\n          label=\"Schools\"\n          value={metricsLoading ? '—' : metrics?.schools_aggregate?.aggregate?.count}\n        />\n        <Stat\n          label=\"Profiles\"\n          value={metricsLoading ? '—' : metrics?.profiles_aggregate?.aggregate?.count}\n        />\n        <Stat\n          label=\"Classrooms\"\n          value={metricsLoading ? '—' : metrics?.classrooms_aggregate?.aggregate?.count}\n        />\n      </section>\n\n      <form onSubmit={handleOrgSubmit} className=\"bg-white rounded shadow p-4 space-y-3\">\n        <h2 className=\"font-medium\">Create organization & school</h2>\n        <input\n          placeholder=\"Organization name\"\n          value={orgForm.organizationName}\n          onChange={(e) => setOrgForm({ ...orgForm, organizationName: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n          required\n        />\n        <input\n          placeholder=\"School name\"\n          value={orgForm.schoolName}\n          onChange={(e) => setOrgForm({ ...orgForm, schoolName: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n          required\n        />\n        <button type=\"submit\" className=\"bg-blue-600 text-white px-4 py-2 rounded\">Create</button>\n      </form>\n\n      <form onSubmit={handleUserSubmit} className=\"bg-white rounded shadow p-4 space-y-3\">\n        <h2 className=\"font-medium\">Assign user role</h2>\n        <input\n          placeholder=\"User ID\"\n          value={userForm.userId}\n          onChange={(e) => setUserForm({ ...userForm, userId: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n          required\n        />\n        <input\n          placeholder=\"Full name\"\n          value={userForm.fullName}\n          onChange={(e) => setUserForm({ ...userForm, fullName: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n          required\n        />\n        <select\n          value={userForm.role}\n          onChange={(e) => setUserForm({ ...userForm, role: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n        >\n          <option value=\"parent\">Parent</option>\n          <option value=\"teacher\">Teacher</option>\n          <option value=\"partner\">Partner</option>\n          <option value=\"system_admin\">System admin</option>\n          <option value=\"school_admin\">School admin</option>\n          <option value=\"district_admin\">District admin</option>\n        </select>\n        <input\n          placeholder=\"Organization ID\"\n          value={userForm.organizationId}\n          onChange={(e) => setUserForm({ ...userForm, organizationId: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n        />\n        <input\n          placeholder=\"School ID\"\n          value={userForm.schoolId}\n          onChange={(e) => setUserForm({ ...userForm, schoolId: e.target.value })}\n          className=\"w-full border rounded px-3 py-2\"\n        />\n        <button type=\"submit\" className=\"bg-blue-600 text-white px-4 py-2 rounded\">Save role</button>\n      </form>\n\n      {message && <p className=\"text-green-700 text-sm\">{message}</p>}\n\n      <section className=\"bg-white rounded shadow p-4 space-y-2\">\n        <h2 className=\"font-medium\">Pilot tools</h2>\n        <p className=\"text-gray-600 text-sm\">\n          Generate and review weekly parent briefs on demand.\n        </p>\n        <Link\n          to=\"/admin/weekly-briefs\"\n          className=\"inline-flex items-center text-sm text-blue-700 hover:underline\"\n        >\n          Open Weekly Briefs tool\n        </Link>\n      </section>\n\n      <section className=\"bg-white rounded shadow p-4 space-y-2\">\n        <h2 className=\"font-medium\">Audit logs</h2>\n        <p className=\"text-sm text-gray-600\">\n          Audit log reporting is migrating to Nhost. Enable the audit log feature flag once the\n          data pipeline is ready.\n        </p>\n      </section>\n    </div>\n  );\n}\n\nconst Stat = ({ label, value }) => (\n  <div className=\"border rounded p-4 bg-white shadow\">\n    <p className=\"text-sm text-gray-600\">{label}</p>\n    <p className=\"text-3xl font-semibold\">{value ?? '—'}</p>\n  </div>\n);\n"],"names":["useTelemetry","tenant","useTenant","event","metadata","logAnalyticsEvent","AdminDashboard","orgForm","setOrgForm","useState","userForm","setUserForm","message","setMessage","log","metrics","metricsLoading","useQuery","graphqlRequest","handleOrgSubmit","evt","data","bootstrapOrganization","_a","_b","handleUserSubmit","createProfile","jsxs","jsx","Stat","_d","_c","_f","_e","_h","_g","e","Link","label","value"],"mappings":"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"}