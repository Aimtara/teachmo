import{c as b,j as e,C as g,i as N,k as w,o as p,af as R,B as m,ag as u,ah as l,T as v,w as C,r as _,R as f,f as z}from"./index-CXW08ga6.js";import{B as h}from"./badge-Dl3t65au.js";import{S as y}from"./sparkles-BjNBUl13.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],B=b("ArrowRight",T);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],q=b("BookmarkPlus",L);function k({recommendation:s}){const{title:a,summary:i,tags:n=[],subject:c,gradeLevel:t,ctaLabel:x="View details",ctaHref:d}=s||{},r=()=>{u("Saved to your list",{description:a||"Recommendation saved"})},o=()=>{d?window.open(d,"_blank","noopener,noreferrer"):u("More details coming soon",{description:a||"This card is a preview."})};return e.jsxs(g,{className:"h-full border border-gray-200",children:[e.jsxs(N,{className:"flex flex-row items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"text-lg font-semibold text-gray-900",children:a||"Untitled"}),e.jsx("p",{className:"text-sm text-gray-600",children:i||"A curated learning experience awaits."})]}),e.jsx(y,{className:"h-5 w-5 text-primary shrink-0"})]}),e.jsx(p,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[c?e.jsx(h,{variant:"secondary",children:c}):null,t?e.jsxs(h,{variant:"secondary",children:["Grade ",t]}):null,n==null?void 0:n.map(j=>e.jsx(h,{variant:"outline",children:j},j))]})}),e.jsxs(R,{className:"flex items-center justify-between gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"gap-2",onClick:r,children:[e.jsx(q,{className:"h-4 w-4"}),"Save"]}),e.jsxs(m,{variant:"outline",size:"sm",className:"gap-2",onClick:o,children:[x,e.jsx(B,{className:"h-4 w-4"})]})]})]})}k.propTypes={recommendation:l.shape({title:l.string,summary:l.string,tags:l.arrayOf(l.string),subject:l.string,gradeLevel:l.oneOfType([l.string,l.number]),ctaLabel:l.string,ctaHref:l.string})};const O=`query DiscoverRecommendations($limit: Int) {
  activities(order_by: { created_at: desc }, limit: $limit) {
    id
    title
    description
    subject
    grade_level
    category
    library_items(limit: 1) {
      id
      url
      format
    }
  }
}`,P=s=>{var n;const a=((n=s==null?void 0:s.library_items)==null?void 0:n[0])??null,i=[s==null?void 0:s.category,a==null?void 0:a.format].filter(Boolean);return{id:s==null?void 0:s.id,title:s==null?void 0:s.title,summary:s==null?void 0:s.description,subject:s==null?void 0:s.subject,gradeLevel:s==null?void 0:s.grade_level,tags:i,ctaLabel:a!=null&&a.url?"Open resource":"View details",ctaHref:(a==null?void 0:a.url)??void 0}},E=async s=>{if(!s)return{items:[],unavailable:!0};try{const a=await z({query:O,variables:{limit:6}});return{items:((a==null?void 0:a.activities)??[]).map(P),unavailable:!1}}catch(a){return{items:[],unavailable:!1,error:a}}};function A(){const s=v(),{data:a,isLoading:i,isFetching:n,refetch:c}=C({queryKey:["personalized-discover-feed",s==null?void 0:s.id],enabled:!!(s!=null&&s.id),queryFn:()=>E(s==null?void 0:s.id),staleTime:1e3*60*5}),t=_.useMemo(()=>(a==null?void 0:a.items)||[],[a]),x=a==null?void 0:a.unavailable,d=async()=>{var o;const r=await c();r!=null&&r.error&&!((o=r==null?void 0:r.data)!=null&&o.unavailable)&&u("Unable to generate recommendations",{description:r.error.message||"Please try again shortly."})};return s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Personalized for you"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Recommendations generated from your saved interests and classroom activity."})]}),e.jsxs(m,{variant:"secondary",size:"sm",className:"gap-2",onClick:d,disabled:n,children:[e.jsx(f,{className:`h-4 w-4 ${n?"animate-spin":""}`}),n?"Refreshing":"Generate Recommendations"]})]}),i?e.jsx(g,{children:e.jsxs(p,{className:"p-6 space-y-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded bg-gray-100"}),e.jsx("div",{className:"h-3 w-3/4 rounded bg-gray-100"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-gray-100"})]})}):null,!i&&t.length===0?e.jsxs(g,{className:"border-dashed",children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2 text-gray-800",children:[e.jsx(y,{className:"h-4 w-4"}),"No Recommendations Yet"]})}),e.jsxs(p,{className:"space-y-3 text-sm text-gray-600",children:[e.jsx("p",{children:"We’ll surface personalized ideas as soon as your activity and library data are available."}),e.jsx("div",{children:e.jsxs(m,{variant:"outline",size:"sm",className:"gap-2",onClick:d,disabled:n,children:[e.jsx(f,{className:`h-4 w-4 ${n?"animate-spin":""}`}),n?"Checking again...":"Generate Recommendations"]})})]})]}):null,e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map((r,o)=>e.jsx(k,{recommendation:r},(r==null?void 0:r.id)||(r==null?void 0:r.title)||o))}),a!=null&&a.error&&x?e.jsx("p",{className:"text-sm text-amber-600",children:"Recommendation service is not available yet. We’ll enable it as soon as it ships."}):null]}):null}export{A as default};
//# sourceMappingURL=PersonalizedDiscoverFeed-fwBsveZb.js.map
