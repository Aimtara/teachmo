import{b as V,w as n,r as N,j as e,P as G,C as c,i as u,k as m,o as x,L as w,B as R,e as i,n as J,F as H}from"./index-CXW08ga6.js";import{u as Q}from"./useMutation-mXVxaFfD.js";import{I as j}from"./input-DQ0nv64R.js";import{S as W,a as X,b as Y,c as Z,d as F}from"./select-CevpuT8Q.js";async function r(h,y={}){const t=await fetch(h,y);if(!t.ok){const f=await t.text();throw new Error(f||"Request failed")}return t.json()}function le(){var S,P,C,A,I,v,B,L,U,$,E;const{data:h}=V(),y=(h==null?void 0:h.organizationId)??null,t=n({queryKey:["ai-governance-token"],queryFn:async()=>{const a=await J.auth.getAccessToken();return{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}}}}),f=n({queryKey:["ai-policy-docs-admin",y],queryFn:async()=>{const M=await H(`query AIPolicyDocsAdmin($where: ai_policy_docs_bool_exp) {
        ai_policy_docs(where: $where, order_by: { published_at: desc }) {
          id
          title
          summary
          published_at
        }
      }`,{where:y?{_or:[{organization_id:{_eq:y}},{organization_id:{_is_null:!0}}]}:{organization_id:{_is_null:!0}}});return(M==null?void 0:M.ai_policy_docs)??[]}}),T=n({queryKey:["ai-usage-summary"],enabled:!!t.data,queryFn:async()=>r(`${i}/admin/ai/usage-summary`,{headers:t.data})}),D=n({queryKey:["ai-review-queue-admin"],enabled:!!t.data,queryFn:async()=>r(`${i}/admin/ai/review-queue`,{headers:t.data})}),K=n({queryKey:["ai-prompt-library-admin"],enabled:!!t.data,queryFn:async()=>r(`${i}/admin/ai/prompts`,{headers:t.data})}),l=n({queryKey:["ai-budget-admin"],enabled:!!t.data,queryFn:async()=>r(`${i}/admin/ai/budget`,{headers:t.data})}),b=n({queryKey:["ai-model-policy-admin"],enabled:!!t.data,queryFn:async()=>r(`${i}/admin/ai/model-policy`,{headers:t.data})}),[p,_]=N.useState({monthlyLimitUsd:"",fallbackPolicy:"block"}),[d,g]=N.useState({defaultModel:"gpt-4o-mini",fallbackModel:"gpt-4o-mini",allowedModels:"gpt-4o-mini, gpt-4o",featureFlags:""});N.useMemo(()=>{var a;(a=l.data)!=null&&a.budget&&_({monthlyLimitUsd:l.data.budget.monthly_limit_usd??"",fallbackPolicy:l.data.budget.fallback_policy??"block"})},[l.data]),N.useMemo(()=>{var a;if((a=b.data)!=null&&a.policy){const s=b.data.policy;g({defaultModel:s.default_model??"gpt-4o-mini",fallbackModel:s.fallback_model??"gpt-4o-mini",allowedModels:(s.allowed_models||[]).join(", "),featureFlags:(s.feature_flags||[]).join(", ")})}},[b.data]);const k=Q({mutationFn:async()=>r(`${i}/admin/ai/budget`,{method:"PUT",headers:t.data,body:JSON.stringify({monthlyLimitUsd:p.monthlyLimitUsd?Number(p.monthlyLimitUsd):null,fallbackPolicy:p.fallbackPolicy})}),onSuccess:()=>l.refetch()}),q=Q({mutationFn:async()=>r(`${i}/admin/ai/model-policy`,{method:"PUT",headers:t.data,body:JSON.stringify({defaultModel:d.defaultModel,fallbackModel:d.fallbackModel,allowedModels:d.allowedModels.split(",").map(a=>a.trim()).filter(Boolean),featureFlags:d.featureFlags.split(",").map(a=>a.trim()).filter(Boolean)})}),onSuccess:()=>b.refetch()}),z=((P=(S=D.data)==null?void 0:S.queue)==null?void 0:P.length)??0,O=((A=(C=K.data)==null?void 0:C.prompts)==null?void 0:A.length)??0,o=(I=T.data)==null?void 0:I.totals;return e.jsx(G,{allowedRoles:["system_admin","district_admin","school_admin","admin"],children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"AI Governance & Transparency"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track AI model usage, review queue activity, and published transparency briefs for your tenant."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(m,{children:"Review Queue"})}),e.jsxs(x,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Pending reviews"}),e.jsx("span",{className:"font-semibold",children:z})]}),e.jsx(w,{className:"text-blue-600 hover:underline",to:"/admin/ai-review-queue",children:"Open AI review queue →"})]})]}),e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(m,{children:"Usage Logging"})}),e.jsxs(x,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total AI requests logged"}),e.jsx("span",{className:"font-semibold",children:(o==null?void 0:o.calls)??0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Estimated spend"}),e.jsxs("span",{className:"font-semibold",children:["$",((B=(v=o==null?void 0:o.cost_usd)==null?void 0:v.toFixed)==null?void 0:B.call(v,2))??"0.00"]})]}),e.jsx(w,{className:"text-blue-600 hover:underline",to:"/admin/analytics",children:"Explore analytics →"})]})]}),e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(m,{children:"Prompt Management"})}),e.jsxs(x,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active prompts"}),e.jsx("span",{className:"font-semibold",children:O})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Manage versions, approvals, and rollout metadata for AI prompt templates."}),e.jsx(w,{className:"text-blue-600 hover:underline",to:"/admin/ai-prompts",children:"Open prompt library →"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(m,{children:"AI Budget & Fallbacks"})}),e.jsxs(x,{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Monthly budget (USD)"}),e.jsx(j,{value:p.monthlyLimitUsd,onChange:a=>_(s=>({...s,monthlyLimitUsd:a.target.value})),placeholder:"250"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Fallback policy"}),e.jsxs(W,{value:p.fallbackPolicy,onValueChange:a=>_(s=>({...s,fallbackPolicy:a})),children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Select fallback"})}),e.jsxs(Z,{children:[e.jsx(F,{value:"block",children:"Block requests"}),e.jsx(F,{value:"degrade",children:"Degrade model"}),e.jsx(F,{value:"allow",children:"Allow overage"})]})]})]}),e.jsx(R,{onClick:()=>k.mutate(),disabled:k.isPending,children:k.isPending?"Saving…":"Save budget settings"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Current spend: $",((U=(L=l.data)==null?void 0:L.budget)==null?void 0:U.spent_usd)??0," · Reset at"," ",(E=($=l.data)==null?void 0:$.budget)!=null&&E.reset_at?new Date(l.data.budget.reset_at).toLocaleDateString():"—"]})]})]}),e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(m,{children:"Model Policy"})}),e.jsxs(x,{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Default model"}),e.jsx(j,{value:d.defaultModel,onChange:a=>g(s=>({...s,defaultModel:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Fallback model"}),e.jsx(j,{value:d.fallbackModel,onChange:a=>g(s=>({...s,fallbackModel:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Allowed models (comma-separated)"}),e.jsx(j,{value:d.allowedModels,onChange:a=>g(s=>({...s,allowedModels:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Required feature flags"}),e.jsx(j,{value:d.featureFlags,onChange:a=>g(s=>({...s,featureFlags:a.target.value})),placeholder:"ENTERPRISE_AI_GOVERNANCE"})]}),e.jsx(R,{onClick:()=>q.mutate(),disabled:q.isPending,children:q.isPending?"Saving…":"Save model policy"})]})]})]}),e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(m,{children:"Transparency Docs"})}),e.jsxs(x,{className:"space-y-3 text-sm",children:[(f.data??[]).length===0?e.jsx("p",{className:"text-muted-foreground",children:"No published docs yet. Seeded documents will appear after migration."}):e.jsx("ul",{className:"space-y-2",children:f.data.map(a=>e.jsxs("li",{className:"border rounded-lg p-3",children:[e.jsx("div",{className:"font-medium",children:a.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.summary})]},a.id))}),e.jsx(w,{className:"text-blue-600 hover:underline",to:"/ai/transparency",children:"View public transparency page →"})]})]})]})})}export{le as default};
//# sourceMappingURL=AdminAIGovernance-CKYdVGll.js.map
