import{A as G,T as V,F as X,r as a,j as e,N as Z,L as ee}from"./index-BPP-_OMN.js";import{O as d,b as te,d as se,g as B,f as ae,h as re,i as le,j as ne}from"./commandCenter-BFr7izyb.js";const de=["all","queued","approved","running","done","failed","canceled"],ie=["all",...Object.values(d)];function K(l){return l==="queued"?"bg-gray-100 text-gray-900":l==="approved"?"bg-blue-100 text-blue-900":l==="running"?"bg-amber-100 text-amber-900":l==="done"?"bg-green-100 text-green-900":l==="failed"?"bg-red-100 text-red-900":l==="canceled"?"bg-gray-100 text-gray-700":"bg-gray-100 text-gray-800"}function C(l){try{return JSON.stringify(l??null,null,2)}catch{return String(l)}}function ce(l){return!l||!String(l).trim()?{}:JSON.parse(l)}function me(){const{isAuthenticated:l,isLoading:$}=G(),{user:y}=V(),[c,A]=X(),o=y==null?void 0:y.id,[T,k]=a.useState(!0),[b,x]=a.useState(null),[j,Y]=a.useState([]),[O,H]=a.useState([]),[m,M]=a.useState("all"),[g,Q]=a.useState("all"),[N,W]=a.useState(""),[E,L]=a.useState(!1),[P,R]=a.useState(d.RUNBOOK_CREATE),[I,f]=a.useState(""),[q,i]=a.useState(`{
  "severity": "warn",
  "target": "slack"
}`),[v,F]=a.useState(null),[n,J]=a.useState(null),[r,p]=a.useState(null),[D,U]=a.useState(!1);a.useEffect(()=>{const t=c.get("type"),s=c.get("title"),S=c.get("payload");let u=!1;t&&Object.values(d).includes(t)&&(R(t),u=!0),s&&(f(s),u=!0),S&&(i(S),u=!0),u&&A({},{replace:!0})},[c,A]);const h=async()=>{k(!0);try{const[t,s]=await Promise.all([te({status:m!=="all"?m:void 0,type:g!=="all"?g:void 0,limit:400}),se({limit:200})]);Y(t.actions||[]),H(s.audit||[]),x(null)}catch(t){x(t)}finally{k(!1)}};a.useEffect(()=>{l&&h()},[l,m,g]),a.useEffect(()=>{if(!n){p(null);return}(async()=>{U(!0);try{const s=await B(n);p(s.action)}catch(s){p(null),x(s)}finally{U(!1)}})()},[n]);const _=a.useMemo(()=>{const t=N.trim().toLowerCase();return t?j.filter(s=>[s.id,s.type,s.status,s.title,C(s.payload)].filter(Boolean).join(" ").toLowerCase().includes(t)):j},[j,N]),z=async()=>{F(null),L(!0);try{const t=ce(q);await ae({type:P,title:I,payload:t,actorId:o}),f(""),h()}catch(t){F(t)}finally{L(!1)}},w=async t=>{try{if(await t(),await h(),n)try{const s=await B(n);p(s.action)}catch{}}catch(s){x(s)}};return $?e.jsx("p",{className:"p-6 text-gray-600",children:"Checking your session…"}):l?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Command Center"}),e.jsx("p",{className:"text-gray-600",children:"Plan, approve, and execute operational actions. Today this runs as a stub executor (file-backed), but the UI + contract are designed to plug into the real orchestrator later."}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[e.jsx(ee,{className:"underline text-gray-700",to:"/internal/execution-board",children:"Open Execution Board"}),e.jsx("a",{className:"underline text-gray-700",href:"/api/command-center/actions",target:"_blank",rel:"noreferrer",children:"Actions JSON"}),e.jsx("a",{className:"underline text-gray-700",href:"/api/command-center/audit",target:"_blank",rel:"noreferrer",children:"Audit JSON"})]})]}),b&&e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-red-900",role:"alert",children:[e.jsx("p",{className:"font-semibold",children:"Something went sideways."}),e.jsx("p",{className:"text-sm opacity-90 mt-1",children:b.message||String(b)})]}),e.jsxs("section",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col lg:flex-row",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Queue an action"}),e.jsx("p",{className:"text-sm text-gray-600",children:"These actions show up in the approvals/execution queue and produce an audit trail."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm hover:bg-gray-50",onClick:h,disabled:T,children:"Refresh"})})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-4",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Type"}),e.jsx("select",{className:"mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:P,onChange:t=>{const s=t.target.value;R(s),s===d.RUNBOOK_CREATE?i(`{
  "incident": "",
  "service": "",
  "severity": "warn"
}`):s===d.ESCALATE?i(`{
  "severity": "warn",
  "target": "slack",
  "message": ""
}`):s===d.ROLLBACK&&i(`{
  "deployment": "",
  "reason": ""
}`)},children:Object.values(d).map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("label",{className:"text-sm text-gray-700 lg:col-span-2",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Title"}),e.jsx("input",{className:"mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:I,onChange:t=>f(t.target.value),placeholder:"e.g., Create runbook for duplicate message storm"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{className:"w-full rounded-lg bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 disabled:opacity-50",onClick:z,disabled:E,children:E?"Creating…":"Create"})})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Payload (JSON)"}),e.jsx("textarea",{className:"mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 font-mono text-xs min-h-[120px]",value:q,onChange:t=>i(t.target.value),spellCheck:!1})]}),v&&e.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 text-amber-900 text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Fix payload JSON:"})," ",v.message||String(v)]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end lg:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Action queue"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Approve → execute → track results. (Stub executor completes instantly.)"})]}),e.jsxs("label",{className:"text-sm text-gray-700 lg:min-w-[260px]",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Search"}),e.jsx("input",{className:"mt-1 w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:N,onChange:t=>W(t.target.value),placeholder:"id, title, payload…"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Status"}),e.jsx("select",{className:"mt-1 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:m,onChange:t=>M(t.target.value),children:de.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("label",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"block text-xs text-gray-500",children:"Type"}),e.jsx("select",{className:"mt-1 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm",value:g,onChange:t=>Q(t.target.value),children:ie.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),T?e.jsx("p",{className:"text-gray-600",children:"Loading actions…"}):e.jsxs("div",{className:"overflow-auto",children:[e.jsxs("table",{className:"min-w-full border-separate border-spacing-y-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs font-semibold text-gray-600",children:[e.jsx("th",{className:"px-3 py-2",children:"Status"}),e.jsx("th",{className:"px-3 py-2",children:"Type"}),e.jsx("th",{className:"px-3 py-2",children:"Title"}),e.jsx("th",{className:"px-3 py-2",children:"Created"}),e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(t=>e.jsxs("tr",{className:`rounded-lg ${n===t.id?"bg-slate-100":"bg-slate-50"} text-sm text-gray-800`,onClick:()=>J(t.id),style:{cursor:"pointer"},children:[e.jsx("td",{className:"px-3 py-3 align-top whitespace-nowrap",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-medium ${K(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-3 py-3 align-top whitespace-nowrap text-xs text-gray-700",children:t.type}),e.jsxs("td",{className:"px-3 py-3 align-top",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.title||"—"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.id})]}),e.jsx("td",{className:"px-3 py-3 align-top whitespace-nowrap text-xs text-gray-700",children:t.createdAt?new Date(t.createdAt).toLocaleString():"—"}),e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"flex flex-wrap gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-xs hover:bg-gray-50 disabled:opacity-50",disabled:t.status!=="queued",onClick:()=>w(()=>re(t.id,o)),children:"Approve"}),e.jsx("button",{className:"rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-xs hover:bg-gray-50 disabled:opacity-50",disabled:!["approved","queued"].includes(t.status),onClick:()=>w(()=>le(t.id,o)),children:"Execute"}),e.jsx("button",{className:"rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-xs hover:bg-gray-50 disabled:opacity-50",disabled:!["queued","approved","running"].includes(t.status),onClick:()=>w(()=>ne(t.id,{actorId:o,reason:"Canceled in UI"})),children:"Cancel"})]})})]},t.id))})]}),_.length===0&&e.jsx("p",{className:"text-sm text-gray-600 mt-3",children:"No actions match the current filters."})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Selected action"}),!n&&e.jsx("p",{className:"text-sm text-gray-600",children:"Pick an action from the queue to see details."}),n&&D&&e.jsx("p",{className:"text-sm text-gray-600",children:"Loading details…"}),n&&!D&&r&&e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-medium ${K(r.status)}`,children:r.status}),e.jsx("span",{className:"inline-flex rounded-full px-2 py-1 text-xs font-medium bg-indigo-50 text-indigo-900",children:r.type}),e.jsx("span",{className:"text-xs text-gray-500",children:r.id})]}),e.jsx("p",{className:"text-sm text-gray-900 font-medium",children:r.title||"—"}),e.jsxs("dl",{className:"grid grid-cols-2 gap-2 text-xs text-gray-700",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Created"}),e.jsx("dd",{children:r.createdAt?new Date(r.createdAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Approved"}),e.jsx("dd",{children:r.approvedAt?new Date(r.approvedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Executed"}),e.jsx("dd",{children:r.executedAt?new Date(r.executedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Updated"}),e.jsx("dd",{children:r.updatedAt?new Date(r.updatedAt).toLocaleString():"—"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Payload"}),e.jsx("pre",{className:"mt-1 rounded-lg border border-gray-200 bg-slate-50 p-3 text-xs overflow-auto max-h-[240px]",children:C(r.payload)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Result"}),e.jsx("pre",{className:"mt-1 rounded-lg border border-gray-200 bg-slate-50 p-3 text-xs overflow-auto max-h-[240px]",children:C(r.result)})]}),r.error&&e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-xs text-red-900",children:[e.jsx("span",{className:"font-semibold",children:"Error:"})," ",String(r.error)]})]})]})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Audit trail"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Recent events for approvals/executions."}),e.jsxs("div",{className:"space-y-2 max-h-[560px] overflow-auto pr-1",children:[O.length===0&&e.jsx("p",{className:"text-sm text-gray-600",children:"No events yet."}),O.map(t=>e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:t.action}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.ts?new Date(t.ts).toLocaleString():"—"}),t.entityId&&e.jsxs("button",{className:"mt-2 text-xs underline text-gray-700",onClick:()=>J(t.entityId),children:["Open ",t.entityId]})]},t.id))]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),e.jsxs("ul",{className:"mt-2 text-sm text-gray-600 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Use this during pilot hardening to record why you did a thing, not just what you did."}),e.jsx("li",{children:"When you plug in the real orchestrator, keep the same action statuses + audit events."}),e.jsxs("li",{children:["For now, this stores to ",e.jsx("code",{className:"px-1 rounded bg-slate-50 border",children:"backend/data/commandCenter.json"}),"."]})]})]})]})]})]}):e.jsx(Z,{to:"/",replace:!0})}export{me as default};
//# sourceMappingURL=CommandCenter-BEwCfB7n.js.map
