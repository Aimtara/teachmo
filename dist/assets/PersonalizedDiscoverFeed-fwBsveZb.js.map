{"version":3,"file":"PersonalizedDiscoverFeed-fwBsveZb.js","sources":["../../node_modules/lucide-react/dist/esm/icons/arrow-right.js","../../node_modules/lucide-react/dist/esm/icons/bookmark-plus.js","../../src/components/discover/RecommendationCard.jsx","../../src/components/discover/PersonalizedDiscoverFeed.jsx"],"sourcesContent":["/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"m12 5 7 7-7 7\", key: \"xquz4c\" }]\n];\nconst ArrowRight = createLucideIcon(\"ArrowRight\", __iconNode);\n\nexport { __iconNode, ArrowRight as default };\n//# sourceMappingURL=arrow-right.js.map\n","/**\n * @license lucide-react v0.475.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z\", key: \"1fy3hk\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"7\", y2: \"13\", key: \"1cppfj\" }],\n  [\"line\", { x1: \"15\", x2: \"9\", y1: \"10\", y2: \"10\", key: \"1gty7f\" }]\n];\nconst BookmarkPlus = createLucideIcon(\"BookmarkPlus\", __iconNode);\n\nexport { __iconNode, BookmarkPlus as default };\n//# sourceMappingURL=bookmark-plus.js.map\n","import PropTypes from 'prop-types';\nimport { BookmarkPlus, Sparkles, ArrowRight } from 'lucide-react';\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { showToast } from '@/components/shared/UltraMinimalToast';\n\nexport default function RecommendationCard({ recommendation }) {\n  const {\n    title,\n    summary,\n    tags = [],\n    subject,\n    gradeLevel,\n    ctaLabel = 'View details',\n    ctaHref\n  } = recommendation || {};\n\n  const handleSave = () => {\n    showToast('Saved to your list', { description: title || 'Recommendation saved' });\n  };\n\n  const handleOpen = () => {\n    if (ctaHref) {\n      window.open(ctaHref, '_blank', 'noopener,noreferrer');\n    } else {\n      showToast('More details coming soon', { description: title || 'This card is a preview.' });\n    }\n  };\n\n  return (\n    <Card className=\"h-full border border-gray-200\">\n      <CardHeader className=\"flex flex-row items-start justify-between gap-2\">\n        <div className=\"space-y-1\">\n          <CardTitle className=\"text-lg font-semibold text-gray-900\">{title || 'Untitled'}</CardTitle>\n          <p className=\"text-sm text-gray-600\">{summary || 'A curated learning experience awaits.'}</p>\n        </div>\n        <Sparkles className=\"h-5 w-5 text-primary shrink-0\" />\n      </CardHeader>\n      <CardContent className=\"space-y-2\">\n        <div className=\"flex flex-wrap gap-2\">\n          {subject ? <Badge variant=\"secondary\">{subject}</Badge> : null}\n          {gradeLevel ? <Badge variant=\"secondary\">Grade {gradeLevel}</Badge> : null}\n          {tags?.map((tag) => (\n            <Badge key={tag} variant=\"outline\">\n              {tag}\n            </Badge>\n          ))}\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex items-center justify-between gap-2\">\n        <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" onClick={handleSave}>\n          <BookmarkPlus className=\"h-4 w-4\" />\n          Save\n        </Button>\n        <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" onClick={handleOpen}>\n          {ctaLabel}\n          <ArrowRight className=\"h-4 w-4\" />\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}\n\nRecommendationCard.propTypes = {\n  recommendation: PropTypes.shape({\n    title: PropTypes.string,\n    summary: PropTypes.string,\n    tags: PropTypes.arrayOf(PropTypes.string),\n    subject: PropTypes.string,\n    gradeLevel: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    ctaLabel: PropTypes.string,\n    ctaHref: PropTypes.string\n  })\n};\n","import { useMemo } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useUserData } from '@nhost/react';\nimport { RefreshCw, Sparkles } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { showToast } from '@/components/shared/UltraMinimalToast';\nimport { graphqlRequest } from '@/lib/graphql';\nimport RecommendationCard from './RecommendationCard';\n\nconst RECOMMENDATION_QUERY = `query DiscoverRecommendations($limit: Int) {\n  activities(order_by: { created_at: desc }, limit: $limit) {\n    id\n    title\n    description\n    subject\n    grade_level\n    category\n    library_items(limit: 1) {\n      id\n      url\n      format\n    }\n  }\n}`;\n\nconst buildRecommendation = (activity) => {\n  const libraryItem = activity?.library_items?.[0] ?? null;\n  const tags = [activity?.category, libraryItem?.format].filter(Boolean);\n\n  return {\n    id: activity?.id,\n    title: activity?.title,\n    summary: activity?.description,\n    subject: activity?.subject,\n    gradeLevel: activity?.grade_level,\n    tags,\n    ctaLabel: libraryItem?.url ? 'Open resource' : 'View details',\n    ctaHref: libraryItem?.url ?? undefined\n  };\n};\n\nconst fetchRecommendations = async (userId) => {\n  if (!userId) return { items: [], unavailable: true };\n\n  try {\n    const data = await graphqlRequest({\n      query: RECOMMENDATION_QUERY,\n      variables: { limit: 6 }\n    });\n    const activities = data?.activities ?? [];\n\n    return {\n      items: activities.map(buildRecommendation),\n      unavailable: false\n    };\n  } catch (error) {\n    return { items: [], unavailable: false, error };\n  }\n};\n\nexport default function PersonalizedDiscoverFeed() {\n  const user = useUserData();\n\n  const { data, isLoading, isFetching, refetch } = useQuery({\n    queryKey: ['personalized-discover-feed', user?.id],\n    enabled: Boolean(user?.id),\n    queryFn: () => fetchRecommendations(user?.id),\n    staleTime: 1000 * 60 * 5\n  });\n\n  const items = useMemo(() => data?.items || [], [data]);\n  const unavailable = data?.unavailable;\n\n  const handleGenerate = async () => {\n    const result = await refetch();\n    if (result?.error && !result?.data?.unavailable) {\n      showToast('Unable to generate recommendations', {\n        description: result.error.message || 'Please try again shortly.'\n      });\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between gap-3\">\n        <div>\n          <h2 className=\"text-xl font-semibold text-gray-900\">Personalized for you</h2>\n          <p className=\"text-sm text-gray-600\">\n            Recommendations generated from your saved interests and classroom activity.\n          </p>\n        </div>\n        <Button\n          variant=\"secondary\"\n          size=\"sm\"\n          className=\"gap-2\"\n          onClick={handleGenerate}\n          disabled={isFetching}\n        >\n          <RefreshCw className={`h-4 w-4 ${isFetching ? 'animate-spin' : ''}`} />\n          {isFetching ? 'Refreshing' : 'Generate Recommendations'}\n        </Button>\n      </div>\n\n      {isLoading ? (\n        <Card>\n          <CardContent className=\"p-6 space-y-3\">\n            <div className=\"h-4 w-1/3 rounded bg-gray-100\" />\n            <div className=\"h-3 w-3/4 rounded bg-gray-100\" />\n            <div className=\"h-3 w-2/3 rounded bg-gray-100\" />\n          </CardContent>\n        </Card>\n      ) : null}\n\n      {!isLoading && items.length === 0 ? (\n        <Card className=\"border-dashed\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-gray-800\">\n              <Sparkles className=\"h-4 w-4\" />\n              No Recommendations Yet\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-sm text-gray-600\">\n            <p>\n              We’ll surface personalized ideas as soon as your activity and library data are\n              available.\n            </p>\n            <div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"gap-2\"\n                onClick={handleGenerate}\n                disabled={isFetching}\n              >\n                <RefreshCw className={`h-4 w-4 ${isFetching ? 'animate-spin' : ''}`} />\n                {isFetching ? 'Checking again...' : 'Generate Recommendations'}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      ) : null}\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        {items.map((recommendation, index) => (\n          <RecommendationCard key={recommendation?.id || recommendation?.title || index} recommendation={recommendation} />\n        ))}\n      </div>\n\n      {data?.error && unavailable ? (\n        <p className=\"text-sm text-amber-600\">\n          Recommendation service is not available yet. We’ll enable it as soon as it ships.\n        </p>\n      ) : null}\n    </div>\n  );\n}\n"],"names":["__iconNode","ArrowRight","createLucideIcon","BookmarkPlus","RecommendationCard","recommendation","title","summary","tags","subject","gradeLevel","ctaLabel","ctaHref","handleSave","showToast","handleOpen","jsxs","Card","CardHeader","jsx","CardTitle","Sparkles","CardContent","Badge","tag","CardFooter","Button","PropTypes","RECOMMENDATION_QUERY","buildRecommendation","activity","libraryItem","_a","fetchRecommendations","userId","data","graphqlRequest","error","PersonalizedDiscoverFeed","user","useUserData","isLoading","isFetching","refetch","useQuery","items","useMemo","unavailable","handleGenerate","result","RefreshCw","index"],"mappings":"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","x_google_ignoreList":[0,1]}