{"version":3,"file":"teacher-DBm_6_52.js","sources":["../../src/pages/onboarding/teacher.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { z } from 'zod';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { useUserData } from '@nhost/react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/components/ui/use-toast';\nimport { nhost } from '@/lib/nhostClient';\n\nconst teacherOnboardingSchema = z.object({\n  firstName: z.string().min(2, 'First name is required'),\n  lastName: z.string().min(2, 'Last name is required'),\n  phone: z\n    .string()\n    .min(7, 'Enter a valid phone number')\n    .regex(/^[0-9+\\-() ]+$/, 'Phone number can only include digits and basic symbols'),\n  schoolId: z.string().min(2, 'School ID is required'),\n  subjects: z.string().min(2, 'Please tell us what you teach'),\n  grades: z.string().min(1, 'List at least one grade level'),\n  teachingFocus: z.string().optional()\n});\n\nconst CREATE_TEACHER_PROFILE = `\n  mutation CreateTeacherProfile($input: user_profiles_insert_input!) {\n    insert_user_profiles_one(object: $input) {\n      user_id\n    }\n  }\n`;\n\nconst ASSIGN_TEACHER_ROLE = `\n  mutation AssignTeacherRole($userId: uuid!) {\n    insert_user_roles_one(object: { user_id: $userId, role: \"teacher\" }) {\n      id\n      role\n    }\n  }\n`;\n\nconst CONNECT_TEACHER_SCHOOL = `\n  mutation ConnectTeacherSchool($teacherId: uuid!, $schoolId: uuid!) {\n    insert_teacher_school_links_one(object: { teacher_id: $teacherId, school_id: $schoolId }) {\n      id\n    }\n  }\n`;\n\ntype TeacherFormValues = z.infer<typeof teacherOnboardingSchema>;\n\nexport default function TeacherOnboardingPage() {\n  const user = useUserData();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  const defaultValues = useMemo(\n    () => ({\n      firstName: user?.displayName?.split(' ')[0] || '',\n      lastName: user?.displayName?.split(' ').slice(1).join(' ') || '',\n      phone: '',\n      schoolId: '',\n      subjects: '',\n      grades: '',\n      bio: ''\n    }),\n    [user]\n  );\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors, isSubmitting }\n  } = useForm<TeacherFormValues>({\n    resolver: zodResolver(teacherOnboardingSchema),\n    defaultValues\n  });\n\n  const onSubmit = async (values: TeacherFormValues) => {\n    if (!user?.id) {\n      toast({\n        variant: 'destructive',\n        title: 'You need to be signed in to continue',\n        description: 'Please log in again and restart onboarding.'\n      });\n      return;\n    }\n\n    const profileInput = {\n      user_id: user.id,\n      first_name: values.firstName,\n      last_name: values.lastName,\n      phone: values.phone,\n      school_id: values.schoolId,\n      subjects: values.subjects,\n      grades: values.grades,\n      bio: values.bio,\n      role: 'teacher'\n    };\n\n    const { error: profileError, data: profileData } = await nhost.graphql.request(CREATE_TEACHER_PROFILE, {\n      input: profileInput\n    });\n\n    if (profileError || !profileData?.insert_user_profiles_one?.user_id) {\n      console.error('Failed to create teacher profile', profileError);\n      toast({\n        variant: 'destructive',\n        title: 'Could not save your profile',\n        description: 'Please verify the details and try again.'\n      });\n      return;\n    }\n\n    const teacherProfileId = profileData.insert_user_profiles_one.user_id;\n\n    const { error: linkError } = await nhost.graphql.request(CONNECT_TEACHER_SCHOOL, {\n      teacherId: teacherProfileId,\n      schoolId: values.schoolId\n    });\n\n    if (linkError) {\n      console.error('Failed to connect teacher to school', linkError);\n      toast({\n        variant: 'destructive',\n        title: 'School connection failed',\n        description: 'Your profile is saved but we could not connect to your school. Please try again.'\n      });\n      return;\n    }\n\n    const { error: roleError } = await nhost.graphql.request(ASSIGN_TEACHER_ROLE, {\n      userId: user.id\n    });\n\n    if (roleError) {\n      console.error('Failed to assign teacher role', roleError);\n      toast({\n        variant: 'destructive',\n        title: 'Role assignment failed',\n        description: 'Your profile is saved but we could not finalize your access. Contact support if this continues.'\n      });\n      return;\n    }\n\n    toast({\n      title: 'Welcome to Teachmo!',\n      description: 'Your classroom profile is ready. We connected you to your school and saved your teaching details.'\n    });\n\n    navigate('/teacher/dashboard');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-indigo-50 to-white\">\n      <div className=\"max-w-3xl mx-auto py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8 text-center\">\n          <p className=\"text-sm font-medium text-indigo-600\">Teacher onboarding</p>\n          <h1 className=\"text-3xl font-bold text-slate-900 mt-2\">Set up your classroom profile</h1>\n          <p className=\"text-slate-600 mt-3 max-w-2xl mx-auto\">\n            Add your teaching details so we can personalize resources, connect you with parents, and assign the right role.\n          </p>\n        </div>\n\n        <Card className=\"shadow-lg border-slate-200\">\n          <CardHeader>\n            <CardTitle>Teacher details</CardTitle>\n            <CardDescription>Share the basics of your classroom so we can get everything ready.</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form className=\"space-y-6\" onSubmit={handleSubmit(onSubmit)}>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"firstName\">First name</Label>\n                  <Input id=\"firstName\" autoComplete=\"given-name\" {...register('firstName')} />\n                  {errors.firstName && <p className=\"text-sm text-red-600\">{errors.firstName.message}</p>}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"lastName\">Last name</Label>\n                  <Input id=\"lastName\" autoComplete=\"family-name\" {...register('lastName')} />\n                  {errors.lastName && <p className=\"text-sm text-red-600\">{errors.lastName.message}</p>}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone\">Mobile number</Label>\n                  <Input id=\"phone\" placeholder=\"(555) 123-4567\" {...register('phone')} />\n                  {errors.phone && <p className=\"text-sm text-red-600\">{errors.phone.message}</p>}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"schoolId\">School ID</Label>\n                  <Input id=\"schoolId\" placeholder=\"Enter your school's ID\" {...register('schoolId')} />\n                  {errors.schoolId && <p className=\"text-sm text-red-600\">{errors.schoolId.message}</p>}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"subjects\">Subjects</Label>\n                  <Input id=\"subjects\" placeholder=\"e.g., Math, Science\" {...register('subjects')} />\n                  {errors.subjects && <p className=\"text-sm text-red-600\">{errors.subjects.message}</p>}\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"grades\">Grade levels</Label>\n                  <Input id=\"grades\" placeholder=\"e.g., 3rd-5th\" {...register('grades')} />\n                  {errors.grades && <p className=\"text-sm text-red-600\">{errors.grades.message}</p>}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bio\">Teaching focus</Label>\n                <Textarea\n                  id=\"bio\"\n                  placeholder=\"Share your teaching philosophy, classroom goals, or experience\"\n                  rows={4}\n                  {...register('bio')}\n                />\n                {errors.bio && <p className=\"text-sm text-red-600\">{errors.bio.message}</p>}\n              </div>\n\n              <Button className=\"w-full md:w-auto\" type=\"submit\" disabled={isSubmitting}>\n                {isSubmitting ? 'Saving...' : 'Complete setup'}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"],"names":["teacherOnboardingSchema","z.object","z.string","CREATE_TEACHER_PROFILE","ASSIGN_TEACHER_ROLE","CONNECT_TEACHER_SCHOOL","TeacherOnboardingPage","user","useUserData","navigate","useNavigate","toast","useToast","defaultValues","useMemo","_a","_b","register","handleSubmit","errors","isSubmitting","useForm","zodResolver","onSubmit","values","profileInput","profileError","profileData","nhost","teacherProfileId","linkError","roleError","jsxs","jsx","Card","CardHeader","CardTitle","CardDescription","CardContent","Label","Input","Textarea","Button"],"mappings":"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"}