import{T as b,r,D as w,j as e,F as R,k as S,B as y}from"./index-CcbYISPP.js";import{l as _,a as C}from"./messaging-DTvM5Cq9.js";function k(...s){return s.filter(Boolean).join(" ")}const p=w("MessagingRequests");function A({request:s,onApprove:i,onDeny:m,onReasonChange:x,isProcessing:n,reasonValue:o}){var c;const l=r.useMemo(()=>{if(!(s!=null&&s.created_at))return"just now";try{return R(new Date(s.created_at),{addSuffix:!0})}catch(d){return p.error("Invalid date in messaging request",d),s.created_at}},[s==null?void 0:s.created_at]);return e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Requester"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.requester_user_id})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Target"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s.target_user_id})]})]}),((c=s.metadata)==null?void 0:c.note)&&e.jsxs("div",{className:"rounded-md bg-emerald-50 border border-emerald-100 p-3 text-sm text-emerald-900",children:[e.jsx("p",{className:"font-semibold",children:"Note from requester"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.metadata.note})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{placeholder:"Optional reason (shared when denying)",value:o,onChange:d=>x(s.id,d.target.value),className:"min-h-[80px]"}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[e.jsx(y,{variant:"outline",size:"sm",disabled:n,onClick:()=>m(s.id),children:n?"Saving…":"Deny"}),e.jsx(y,{size:"sm",disabled:n,onClick:()=>i(s.id),children:n?"Saving…":"Approve"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Requested ",l]})]})]})}function M(){const s=b(),[i,m]=r.useState([]),[x,n]=r.useState(!0),[o,l]=r.useState(""),[c,d]=r.useState({}),[u,f]=r.useState({}),g=r.useCallback(async()=>{n(!0);try{const a=await _({status:"pending"});m(Array.isArray(a)?a:[]),l("")}catch(a){p.error("Failed to load messaging requests",a),l((a==null?void 0:a.message)??"Unable to load requests")}finally{n(!1)}},[]);r.useEffect(()=>{g()},[g]);const N=(a,h)=>{f(t=>({...t,[a]:h}))},j=async(a,h)=>{if(a){d(t=>({...t,[a]:!0}));try{await C({requestId:a,approve:h,reason:u[a]}),await g()}catch(t){p.error("Error saving messaging decision",t),l((t==null?void 0:t.message)??"Unable to save decision")}finally{d(t=>({...t,[a]:!1}))}}},v=(s==null?void 0:s.displayName)||(s==null?void 0:s.email)||"there";return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Hi ",v,","]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Messaging requests"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Approve or deny requests addressed to you."})]}),o&&e.jsx("div",{className:"rounded-md border border-red-100 bg-red-50 p-3 text-sm text-red-700",role:"alert",children:o}),x?e.jsx("p",{className:"text-gray-600",children:"Loading requests…"}):i.length===0?e.jsxs("div",{className:"rounded-lg border border-gray-100 bg-white p-6 shadow-sm",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"No pending requests"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You'll see new requests here when parents ask to message you."})]}):e.jsx("div",{className:k("grid gap-4",i.length>1?"md:grid-cols-2":""),children:i.map(a=>e.jsx(A,{request:a,onApprove:()=>j(a.id,!0),onDeny:()=>j(a.id,!1),onReasonChange:N,isProcessing:c[a.id],reasonValue:u[a.id]??""},a.id))})]})}export{M as default};
//# sourceMappingURL=MessagingRequests-B_p45ZOt.js.map
