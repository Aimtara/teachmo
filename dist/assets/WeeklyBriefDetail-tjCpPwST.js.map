{"version":3,"file":"WeeklyBriefDetail-tjCpPwST.js","sources":["../../src/api/base44/entities.ts","../../src/domain/weeklyBriefs.ts","../../src/pages/WeeklyBriefDetail.jsx"],"sourcesContent":["import * as generatedEntities from './entities.generated.js';\nimport { WeeklyBrief } from './legacy/entities';\n\n// Some adapters expect conversational \"thread\" entities that map to the Base44 Conversation schema.\n// Provide aliases here so the rest of the app can depend on MessageThread + MessageThreadParticipant\n// without failing to resolve during bundling.\nconst MessageThread = generatedEntities.Conversation;\nconst MessageThreadParticipant = generatedEntities.ConversationMember;\n\nexport const base44EntitiesMap = {\n  ...generatedEntities,\n  WeeklyBrief,\n  MessageThread,\n  MessageThreadParticipant\n};\n\nexport default base44EntitiesMap;\nexport { MessageThread, MessageThreadParticipant };\nexport * from './entities.generated.js';\nexport { WeeklyBrief };\n","import { base44Entities } from '@/api/base44';\nimport type { WeeklyBriefListFilters, WeeklyBriefRecord } from '@/domain/types/weeklyBrief';\n\nconst { WeeklyBrief } = base44Entities;\n\nfunction buildFilters({ weekStart }: WeeklyBriefListFilters = {}) {\n  if (!weekStart) return {};\n  return { week_start: weekStart };\n}\n\nexport const weeklyBriefsApi = {\n  entity: WeeklyBrief,\n  async list({ weekStart }: WeeklyBriefListFilters = {}): Promise<WeeklyBriefRecord[]> {\n    const filters = buildFilters({ weekStart });\n    const hasFilters = Object.keys(filters).length > 0;\n\n    if (!WeeklyBrief?.filter || !WeeklyBrief?.list) return [];\n\n    if (hasFilters) {\n      return WeeklyBrief.filter(filters, '-published_at');\n    }\n\n    return WeeklyBrief.list('-published_at');\n  },\n  async get(id: string): Promise<WeeklyBriefRecord | null> {\n    if (!WeeklyBrief?.get) return null;\n    return WeeklyBrief.get(id);\n  },\n  async logView(id: string, source = 'dashboard') {\n    if (!WeeklyBrief?.update || !WeeklyBrief?.get) return null;\n\n    const row: WeeklyBriefRecord | null = await WeeklyBrief.get(id);\n    const openCount = Number(row?.open_count || 0) + 1;\n    const openedAt = row?.opened_at || new Date().toISOString();\n\n    return WeeklyBrief.update(id, {\n      open_count: openCount,\n      opened_at: openedAt,\n      last_opened_at: new Date().toISOString(),\n      last_opened_source: source,\n    });\n  },\n};\n","import { useEffect, useState } from 'react';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\nimport { weeklyBriefsApi } from '@/domain/weeklyBriefs';\n\nfunction formatISODate(iso) {\n  try {\n    return new Date(iso).toLocaleDateString(undefined, {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric'\n    });\n  } catch {\n    return iso;\n  }\n}\n\nexport default function WeeklyBriefDetail() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [brief, setBrief] = useState(null);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    const load = async () => {\n      if (!id) {\n        navigate('/parent/dashboard', { replace: true });\n        return;\n      }\n      setLoading(true);\n      setError('');\n      try {\n        const row = await weeklyBriefsApi.get(id);\n        if (!isMounted) return;\n        setBrief(row);\n        weeklyBriefsApi.logView(id, 'dashboard').catch(() => {});\n      } catch (e) {\n        if (!isMounted) return;\n        setError(e?.message || 'Unable to load weekly brief');\n      } finally {\n        if (!isMounted) return;\n        setLoading(false);\n      }\n    };\n\n    load();\n    return () => {\n      isMounted = false;\n    };\n  }, [id, navigate]);\n\n  const content = brief?.brief_content;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <header className=\"flex items-start justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">{content?.title || 'This Week at School'}</h1>\n          <p className=\"text-gray-600\">\n            {content?.weekOf ? `Week of ${formatISODate(content.weekOf)}` : ''}\n          </p>\n        </div>\n        <Link\n          to=\"/parent/dashboard\"\n          className=\"text-sm font-medium text-indigo-600 hover:text-indigo-700\"\n        >\n          Back to dashboard\n        </Link>\n      </header>\n\n      {loading && <p className=\"text-gray-600\">Loading…</p>}\n      {!loading && error && <p className=\"text-red-600\">{error}</p>}\n\n      {!loading && !error && brief && (\n        <div className=\"bg-white shadow rounded p-6 space-y-6\">\n          <section>\n            <h2 className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">\n              What matters most\n            </h2>\n            <ul className=\"mt-3 space-y-3\">\n              {(content?.whatMattersMost || []).map((item, idx) => (\n                <li key={`${brief.id}-core-${idx}`} className=\"border-b pb-3 last:border-0 last:pb-0\">\n                  <p className=\"font-semibold\">{item.text}</p>\n                  <p className=\"text-sm text-gray-600\">\n                    {item.etaMinutes ? `~${item.etaMinutes} min` : null}\n                    {item.etaMinutes && item.why ? ' · ' : null}\n                    {item.why || null}\n                  </p>\n                </li>\n              ))}\n              {(content?.whatMattersMost || []).length === 0 && (\n                <li className=\"text-gray-500\">No core items detected for this week.</li>\n              )}\n            </ul>\n          </section>\n\n          {(content?.goodToKnow || []).length > 0 && (\n            <section>\n              <h2 className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">Good to know</h2>\n              <ul className=\"mt-3 space-y-2 text-sm text-gray-700\">\n                {(content.goodToKnow || []).map((item, idx) => (\n                  <li key={`${brief.id}-gtk-${idx}`}>• {item.text}</li>\n                ))}\n              </ul>\n            </section>\n          )}\n\n          {brief.mediation_level !== 'HIGH' && (content?.optionalIfYouHaveTime || []).length > 0 && (\n            <section>\n              <h2 className=\"text-sm font-semibold text-gray-700 uppercase tracking-wide\">\n                Optional if you have time\n              </h2>\n              <ul className=\"mt-3 space-y-2 text-sm text-gray-700\">\n                {(content.optionalIfYouHaveTime || []).map((item, idx) => (\n                  <li key={`${brief.id}-opt-${idx}`}>• {item.text}</li>\n                ))}\n              </ul>\n            </section>\n          )}\n\n          {content?.teachmoNote ? (\n            <section className=\"bg-gray-50 rounded p-4\">\n              <p className=\"text-sm text-gray-700 italic\">{content.teachmoNote}</p>\n            </section>\n          ) : null}\n\n          <section className=\"pt-2 border-t\">\n            <details>\n              <summary className=\"cursor-pointer text-sm font-medium text-gray-700\">\n                Technical details (for debugging)\n              </summary>\n              <div className=\"mt-3 text-sm text-gray-600 space-y-1\">\n                <p>\n                  Mediation: <span className=\"font-mono\">{brief.mediation_level}</span>\n                </p>\n                <p>\n                  SLS / HCS / TI:{' '}\n                  <span className=\"font-mono\">{brief.school_load_score} / {brief.home_capacity_score} / {brief.tension_index}</span>\n                </p>\n                <p>\n                  Views: <span className=\"font-mono\">{brief.view_count}</span>\n                </p>\n              </div>\n            </details>\n          </section>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["base44EntitiesMap","WeeklyBrief","base44Entities","buildFilters","weekStart","weeklyBriefsApi","filters","hasFilters","id","source","row","openCount","openedAt","formatISODate","iso","WeeklyBriefDetail","useParams","navigate","useNavigate","loading","setLoading","useState","error","setError","brief","setBrief","useEffect","isMounted","e","content","jsxs","jsx","Link","item","idx"],"mappings":"+GASO,MAAMA,EAAoB,CAAA,YAE/BC,CAGF,ECXM,CAAE,YAAAA,GAAgBC,EAExB,SAASC,EAAa,CAAE,UAAAC,CAAA,EAAsC,GAAI,CAChE,OAAKA,EACE,CAAE,WAAYA,CAAA,EADE,CAAA,CAEzB,CAEO,MAAMC,EAAkB,CAC7B,OAAQJ,EACR,MAAM,KAAK,CAAE,UAAAG,CAAA,EAAsC,GAAkC,CACnF,MAAME,EAAUH,EAAa,CAAE,UAAAC,EAAW,EACpCG,EAAa,OAAO,KAAKD,CAAO,EAAE,OAAS,EAEjD,MAAI,EAACL,GAAA,MAAAA,EAAa,SAAU,EAACA,GAAA,MAAAA,EAAa,MAAa,CAAA,EAEnDM,EACKN,EAAY,OAAOK,EAAS,eAAe,EAG7CL,EAAY,KAAK,eAAe,CACzC,EACA,MAAM,IAAIO,EAA+C,CACvD,OAAKP,GAAA,MAAAA,EAAa,IACXA,EAAY,IAAIO,CAAE,EADK,IAEhC,EACA,MAAM,QAAQA,EAAYC,EAAS,YAAa,CAC9C,GAAI,EAACR,GAAA,MAAAA,EAAa,SAAU,EAACA,GAAA,MAAAA,EAAa,KAAK,OAAO,KAEtD,MAAMS,EAAgC,MAAMT,EAAY,IAAIO,CAAE,EACxDG,EAAY,QAAOD,GAAA,YAAAA,EAAK,aAAc,CAAC,EAAI,EAC3CE,GAAWF,GAAA,YAAAA,EAAK,YAAa,IAAI,KAAA,EAAO,YAAA,EAE9C,OAAOT,EAAY,OAAOO,EAAI,CAC5B,WAAYG,EACZ,UAAWC,EACX,eAAgB,IAAI,KAAA,EAAO,YAAA,EAC3B,mBAAoBH,CAAA,CACrB,CACH,CACF,ECtCA,SAASI,EAAcC,EAAK,CAC1B,GAAI,CACF,OAAO,IAAI,KAAKA,CAAG,EAAE,mBAAmB,OAAW,CACjD,QAAS,QACT,MAAO,QACP,IAAK,SAAA,CACN,CACH,MAAQ,CACN,OAAOA,CACT,CACF,CAEA,SAAwBC,GAAoB,CAC1C,KAAM,CAAE,GAAAP,CAAA,EAAOQ,EAAA,EACTC,EAAWC,EAAA,EACX,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAI,EACrC,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAS,EAAE,EAC/B,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAS,IAAI,EAEvCK,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAY,GAuBhB,OArBa,SAAY,CACvB,GAAI,CAACnB,EAAI,CACPS,EAAS,oBAAqB,CAAE,QAAS,EAAA,CAAM,EAC/C,MACF,CACAG,EAAW,EAAI,EACfG,EAAS,EAAE,EACX,GAAI,CACF,MAAMb,EAAM,MAAML,EAAgB,IAAIG,CAAE,EACxC,GAAI,CAACmB,EAAW,OAChBF,EAASf,CAAG,EACZL,EAAgB,QAAQG,EAAI,WAAW,EAAE,MAAM,IAAM,CAAC,CAAC,CACzD,OAASoB,EAAG,CACV,GAAI,CAACD,EAAW,OAChBJ,GAASK,GAAA,YAAAA,EAAG,UAAW,6BAA6B,CACtD,QAAA,CACE,GAAI,CAACD,EAAW,OAChBP,EAAW,EAAK,CAClB,CACF,GAEA,EACO,IAAM,CACXO,EAAY,EACd,CACF,EAAG,CAACnB,EAAIS,CAAQ,CAAC,EAEjB,MAAMY,EAAUL,GAAA,YAAAA,EAAO,cAEvB,OACEM,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CAAO,UAAU,yCAChB,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,yBAA0B,UAAAF,GAAA,YAAAA,EAAS,QAAS,sBAAsB,EAChFE,EAAAA,IAAC,IAAA,CAAE,UAAU,gBACV,SAAAF,GAAA,MAAAA,EAAS,OAAS,WAAWhB,EAAcgB,EAAQ,MAAM,CAAC,GAAK,EAAA,CAClE,CAAA,EACF,EACAE,EAAAA,IAACC,EAAA,CACC,GAAG,oBACH,UAAU,4DACX,SAAA,mBAAA,CAAA,CAED,EACF,EAECb,GAAWY,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,WAAQ,EAChD,CAACZ,GAAWG,SAAU,IAAA,CAAE,UAAU,eAAgB,SAAAA,EAAM,EAExD,CAACH,GAAW,CAACG,GAASE,GACrBM,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAA,OAAC,UAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,8DAA8D,SAAA,oBAE5E,EACAD,EAAAA,KAAC,KAAA,CAAG,UAAU,iBACV,SAAA,GAAAD,GAAA,YAAAA,EAAS,kBAAmB,IAAI,IAAI,CAACI,EAAMC,IAC3CJ,EAAAA,KAAC,KAAA,CAAmC,UAAU,wCAC5C,SAAA,CAAAC,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAiB,SAAAE,EAAK,KAAK,EACxCH,EAAAA,KAAC,IAAA,CAAE,UAAU,wBACV,SAAA,CAAAG,EAAK,WAAa,IAAIA,EAAK,UAAU,OAAS,KAC9CA,EAAK,YAAcA,EAAK,IAAM,MAAQ,KACtCA,EAAK,KAAO,IAAA,CAAA,CACf,CAAA,CAAA,EANO,GAAGT,EAAM,EAAE,SAASU,CAAG,EAOhC,CACD,IACCL,GAAA,YAAAA,EAAS,kBAAmB,CAAA,GAAI,SAAW,GAC3CE,MAAC,KAAA,CAAG,UAAU,gBAAgB,SAAA,uCAAA,CAAqC,CAAA,CAAA,CAEvE,CAAA,EACF,IAEEF,GAAA,YAAAA,EAAS,aAAc,IAAI,OAAS,UACnC,UAAA,CACC,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAG,UAAU,8DAA8D,SAAA,eAAY,EACxFA,EAAAA,IAAC,KAAA,CAAG,UAAU,uCACV,UAAAF,EAAQ,YAAc,CAAA,GAAI,IAAI,CAACI,EAAMC,WACpC,KAAA,CAAkC,SAAA,CAAA,KAAGD,EAAK,IAAA,CAAA,EAAlC,GAAGT,EAAM,EAAE,QAAQU,CAAG,EAAiB,CACjD,CAAA,CACH,CAAA,EACF,EAGDV,EAAM,kBAAoB,UAAWK,GAAA,YAAAA,EAAS,wBAAyB,IAAI,OAAS,GACnFC,EAAAA,KAAC,UAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,8DAA8D,SAAA,4BAE5E,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,uCACV,UAAAF,EAAQ,uBAAyB,CAAA,GAAI,IAAI,CAACI,EAAMC,WAC/C,KAAA,CAAkC,SAAA,CAAA,KAAGD,EAAK,IAAA,CAAA,EAAlC,GAAGT,EAAM,EAAE,QAAQU,CAAG,EAAiB,CACjD,CAAA,CACH,CAAA,EACF,EAGDL,GAAA,MAAAA,EAAS,YACRE,MAAC,UAAA,CAAQ,UAAU,yBACjB,SAAAA,EAAAA,IAAC,IAAA,CAAE,UAAU,+BAAgC,SAAAF,EAAQ,WAAA,CAAY,EACnE,EACE,KAEJE,MAAC,UAAA,CAAQ,UAAU,gBACjB,gBAAC,UAAA,CACC,SAAA,CAAAA,EAAAA,IAAC,UAAA,CAAQ,UAAU,mDAAmD,SAAA,oCAEtE,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uCACb,SAAA,CAAAA,OAAC,IAAA,CAAE,SAAA,CAAA,cACUC,EAAAA,IAAC,OAAA,CAAK,UAAU,YAAa,WAAM,eAAA,CAAgB,CAAA,EAChE,SACC,IAAA,CAAE,SAAA,CAAA,kBACe,IAChBD,EAAAA,KAAC,OAAA,CAAK,UAAU,YAAa,SAAA,CAAAN,EAAM,kBAAkB,MAAIA,EAAM,oBAAoB,MAAIA,EAAM,aAAA,CAAA,CAAc,CAAA,EAC7G,SACC,IAAA,CAAE,SAAA,CAAA,UACMO,EAAAA,IAAC,OAAA,CAAK,UAAU,YAAa,WAAM,UAAA,CAAW,CAAA,CAAA,CACvD,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EAEJ,CAEJ"}