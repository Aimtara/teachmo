import{b as $,h as w,r,w as g,j as e,C as l,i as o,k as c,o as x,B as D,e as i,n as F}from"./index-CXW08ga6.js";import{u as P}from"./useMutation-mXVxaFfD.js";import{I as m}from"./input-DQ0nv64R.js";import{T as B}from"./textarea-MrBTA2MH.js";async function h(t,n={}){const a=await fetch(t,n);if(!a.ok){const u=await a.text();throw new Error(u||"Request failed")}return a.json()}function J(){var _,T,U,L,k;const{data:t}=$(),{toast:n}=w(),[a,u]=r.useState(""),[C,I]=r.useState(""),[y,R]=r.useState(""),[S,E]=r.useState(""),[N,A]=r.useState(""),d=g({queryKey:["compliance_token"],queryFn:async()=>{const s=await F.auth.getAccessToken();return{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}}}),j=g({queryKey:["retention_policy",t==null?void 0:t.districtId,t==null?void 0:t.schoolId],enabled:!!(t!=null&&t.districtId),queryFn:async()=>h(`${i}/admin/retention-policy`,{headers:d.data})}),p=g({queryKey:["dsar_exports",t==null?void 0:t.districtId,t==null?void 0:t.schoolId],enabled:!!(t!=null&&t.districtId),queryFn:async()=>h(`${i}/admin/dsar-exports`,{headers:d.data})}),f=g({queryKey:["ai-usage-compliance",t==null?void 0:t.districtId,t==null?void 0:t.schoolId],enabled:!!(t!=null&&t.districtId&&d.data),queryFn:async()=>h(`${i}/admin/ai/usage?limit=20`,{headers:d.data})}),v=P({mutationFn:async()=>h(`${i}/admin/dsar-exports`,{method:"POST",headers:d.data,body:JSON.stringify({userId:a,reason:C})}),onSuccess:s=>{n({title:"Export ready",description:`DSAR export ${(s==null?void 0:s.id)||""} is ready to download.`}),u(""),I(""),p.refetch()},onError:s=>{n({variant:"destructive",title:"Export failed",description:s instanceof Error?s.message:"Unable to create DSAR export."})}}),b=P({mutationFn:async()=>h(`${i}/admin/users/${y}/hard-delete`,{method:"POST",headers:d.data,body:JSON.stringify({reason:S})}),onSuccess:()=>{n({title:"User deleted",description:"The user record has been permanently removed."}),R(""),E(""),A("")},onError:s=>{n({variant:"destructive",title:"Deletion failed",description:s instanceof Error?s.message:"Unable to delete user."})}}),q=r.useMemo(()=>N.trim().toLowerCase()==="delete",[N]);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Compliance Center"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Handle DSAR requests, retention rules, and permanent deletion workflows for your tenant."})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(c,{children:"Retention Policy"})}),e.jsxs(x,{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Audit logs:"})," ",(_=j.data)!=null&&_.auditLogDays?`${j.data.auditLogDays} days`:"Loading…"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"DSAR exports:"})," ",(T=j.data)!=null&&T.dsarExportDays?`${j.data.dsarExportDays} days`:"Loading…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Update retention settings in Tenant Settings to change purge windows."})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(c,{children:"DSAR Exports"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"User ID"}),e.jsx(m,{value:a,onChange:s=>u(s.target.value),placeholder:"UUID"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Reason (optional)"}),e.jsx(m,{value:C,onChange:s=>I(s.target.value),placeholder:"DSAR request"})]})]}),e.jsx(D,{onClick:()=>v.mutate(),disabled:!a||v.isPending,children:v.isPending?"Requesting…":"Request export"}),e.jsxs("div",{className:"pt-2 border-t text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:"Recent exports"}),p.isLoading?e.jsx("div",{className:"text-muted-foreground",children:"Loading exports…"}):(U=p.data)!=null&&U.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-left",children:[e.jsx("th",{className:"p-2",children:"Export ID"}),e.jsx("th",{className:"p-2",children:"Subject"}),e.jsx("th",{className:"p-2",children:"Created"}),e.jsx("th",{className:"p-2",children:"Expires"}),e.jsx("th",{className:"p-2"})]})}),e.jsx("tbody",{children:p.data.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2 font-mono text-xs",children:s.id}),e.jsx("td",{className:"p-2 font-mono text-xs",children:s.subject_user_id}),e.jsx("td",{className:"p-2",children:s.created_at?new Date(s.created_at).toLocaleString():"—"}),e.jsx("td",{className:"p-2",children:s.expires_at?new Date(s.expires_at).toLocaleString():"—"}),e.jsx("td",{className:"p-2",children:e.jsx(D,{size:"sm",variant:"secondary",onClick:()=>window.open(`${i}/admin/dsar-exports/${s.id}/download`,"_blank"),children:"Download"})})]},s.id))})]})}):e.jsx("div",{className:"text-muted-foreground",children:"No exports requested yet."})]})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(c,{children:"Permanent Deletion"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"User ID"}),e.jsx(m,{value:y,onChange:s=>R(s.target.value),placeholder:"UUID"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Reason"}),e.jsx(m,{value:S,onChange:s=>E(s.target.value),placeholder:"Policy violation"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Type DELETE to confirm"}),e.jsx(m,{value:N,onChange:s=>A(s.target.value),placeholder:"DELETE"})]}),e.jsx(D,{variant:"destructive",onClick:()=>b.mutate(),disabled:!y||!q||b.isPending,children:b.isPending?"Deleting…":"Permanently delete user"})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(c,{children:"AI Usage Compliance"})}),e.jsxs(x,{className:"space-y-3 text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Recent AI usage logs are retained for compliance and audit review."}),f.isLoading?e.jsx("div",{className:"text-muted-foreground",children:"Loading AI usage…"}):(k=(L=f.data)==null?void 0:L.usage)!=null&&k.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-left",children:[e.jsx("th",{className:"p-2",children:"Timestamp"}),e.jsx("th",{className:"p-2",children:"Model"}),e.jsx("th",{className:"p-2",children:"Tokens"}),e.jsx("th",{className:"p-2",children:"Cost"}),e.jsx("th",{className:"p-2",children:"Risk"})]})}),e.jsx("tbody",{children:f.data.usage.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:s.created_at?new Date(s.created_at).toLocaleString():"—"}),e.jsx("td",{className:"p-2",children:s.model??"—"}),e.jsx("td",{className:"p-2",children:s.token_total??"—"}),e.jsxs("td",{className:"p-2",children:["$",Number(s.cost_usd||0).toFixed(2)]}),e.jsx("td",{className:"p-2",children:s.safety_risk_score??"—"})]},s.id))})]})}):e.jsx("div",{className:"text-muted-foreground",children:"No AI usage logged yet."})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(c,{children:"Compliance Documentation"})}),e.jsxs(x,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx("p",{children:"Teachmo maintains audit logs for administrative actions, impersonation sessions, and data exports to support regulatory audits."}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"DSAR exports include profile data, identities, and audit history for the subject."}),e.jsx("li",{children:"Retention policies are enforced nightly by the automated purge job."}),e.jsx("li",{children:"Permanent deletion bypasses soft delete and logs the before/after snapshot in audit logs."})]}),e.jsx(B,{value:"Need documentation for GDPR, FERPA, or CCPA? Contact compliance@teachmo.com for our latest compliance packet.",readOnly:!0,rows:3})]})]})]})}export{J as default};
//# sourceMappingURL=AdminCompliance-IgAyQVkm.js.map
