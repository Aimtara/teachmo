{"version":3,"file":"PartnerPortal-Dpoihrr_.js","sources":["../../src/pages/PartnerPortal.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { API_BASE_URL } from '@/config/api';\nimport { useUserId } from '@nhost/react';\nimport { useTenantScope } from '@/hooks/useTenantScope';\n\nexport default function PartnerPortal() {\n  const [stats, setStats] = useState({ submissions: 0, enrollments: 0, applications: 0, contracts: 0 });\n  const [activity, setActivity] = useState([]);\n  const userId = useUserId();\n  const { data: scope } = useTenantScope();\n  const partnerId = userId;\n\n  const tenantHeaders = useMemo(() => {\n    const h = {};\n    if (userId) h['x-user-id'] = userId;\n    if (scope?.districtId) h['x-district-id'] = scope.districtId;\n    if (scope?.schoolId) h['x-school-id'] = scope.schoolId;\n    return h;\n  }, [userId, scope?.districtId, scope?.schoolId]);\n\n  useEffect(() => {\n    async function load() {\n      const asArray = async (resp) => (resp.ok ? resp.json() : []);\n      const [subs, enrolls, apps, contracts, audits] = await Promise.all([\n        fetch(`${API_BASE_URL}/submissions`, { headers: tenantHeaders }).then(asArray),\n        partnerId\n          ? fetch(`${API_BASE_URL}/courses/enrollments/${partnerId}`, { headers: tenantHeaders }).then(asArray)\n          : Promise.resolve([]),\n        partnerId\n          ? fetch(`${API_BASE_URL}/incentives/applications/${partnerId}`, { headers: tenantHeaders }).then(asArray)\n          : Promise.resolve([]),\n        fetch(`${API_BASE_URL}/contracts?partnerId=${partnerId ?? ''}`, { headers: tenantHeaders }).then(asArray),\n        fetch(`${API_BASE_URL}/admin/audits`, { headers: tenantHeaders }).then(asArray),\n      ]);\n      setStats({\n        submissions: subs.length,\n        enrollments: enrolls.length,\n        applications: apps.length,\n        contracts: contracts.length\n      });\n      setActivity(audits.slice(-5).reverse());\n    }\n    load();\n  }, [partnerId, tenantHeaders]);\n\n  return (\n    <div>\n      <h1>Partner portal</h1>\n      <p>Review your submissions and activity.</p>\n\n      <div style={{ display: 'flex', gap: '1rem' }}>\n        <div><strong>{stats.submissions}</strong> submissions</div>\n        <div><strong>{stats.enrollments}</strong> enrollments</div>\n        <div><strong>{stats.applications}</strong> incentives</div>\n        <div><strong>{stats.contracts}</strong> contracts</div>\n      </div>\n\n      <h2>Recent activity</h2>\n      <ul>\n        {activity.map((a) => (\n          <li key={a.id}>{a.event_type} - {a.summary}</li>\n        ))}\n      </ul>\n\n      <div style={{ marginTop: '1rem' }}>\n        <Link to=\"/partner/submissions\">View submissions</Link>\n      </div>\n    </div>\n  );\n}\n"],"names":["PartnerPortal","stats","setStats","useState","activity","setActivity","userId","useUserId","scope","useTenantScope","partnerId","tenantHeaders","useMemo","h","useEffect","load","asArray","resp","subs","enrolls","apps","contracts","audits","API_BASE_URL","jsx","jsxs","a","Link"],"mappings":"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"}