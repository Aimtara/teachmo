table:
  name: partner_submissions
  schema: public
insert_permissions:
  - role: partner
    permission:
      check:
        partner_id:
          _eq: X-Hasura-Profile-Id
        organization_id:
          _eq: X-Hasura-Organization-Id
      set:
        partner_id: x-hasura-profile-id
        organization_id: x-hasura-organization-id
      columns:
        - type
        - title
        - description
select_permissions:
  - role: system_admin
    permission:
      columns: '*'
      filter: {}
  - role: admin
    permission:
      columns: '*'
      filter: {}
  - role: partner
    permission:
      columns: '*'
      filter:
        partner_id:
          _eq: X-Hasura-Profile-Id
update_permissions:
  - role: partner
    permission:
      columns:
        - title
        - description
      filter:
        partner_id:
          _eq: X-Hasura-Profile-Id
        status:
          _eq: pending
      check: {}


event_triggers:
  - name: partner_submission_workflow_handoff
    definition:
      enable_manual: false
      insert:
        columns: "*"
      update:
        columns:
          - status
          - updated_at
    retry_conf:
      interval_sec: 10
      num_retries: 3
      timeout_sec: 60
    webhook_from_env: PARTNER_SUBMISSION_EVENT_WEBHOOK
    headers:
      - name: x-hasura-event-secret
        value_from_env: HASURA_EVENT_WEBHOOK_SECRET
      - name: x-teachmo-event-source
        value: hasura_partner_submissions
